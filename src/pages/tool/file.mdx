# 文件单（新版）

## 1. dbf - 文件单

用户策略通过文件的形式向终端提交委托指令，同时也是通过文件的形式，获取相关的交易数据反馈。本规范分别对作为输入的文件单和作为输出的数据文件的格式规范进行描述。

### 输入文件单规范

- 文件单是用户委托指令的载体，目前掘金终端支持 **dbf** 和 **csv** 2 种文件格式。本文是描述 dbf 格式的接入规范。

- 用户的指令分成 3 类， 分别是：**委托交易**，**撤销委托**， **功能号指令**。 掘金终端， 通过文件名称后缀来区分文件格式和指令种类。具体请参考下表所示：

| 示例                                     | 后缀部分          | 文件格式 | 指令种类   |
| ---------------------------------------- | ----------------- | -------- | ---------- |
| 2020-10-15_10:48:09.072.order.dbf        | .order.dbf        | dbf      | 委托交易   |
| 2020-10-15_10:48:09.072.cancel_order.dbf | .cancel_order.dbf | dbf      | 撤销委托   |
| 2020-10-15_10:48:09.072.func_request.dbf | .func_request.dbf | dbf      | 功能号指令 |

### dbf 格式

- dbf 文件因文件格式规范要求，对字段名称的长度有限制，不能超过 11 个字节。所以字段名称适当做了简写处理。

  > 注意： 11 个字节，因字符 '\0' 作为字符串的终止符，因此字段名称最多只能是 10 个*ANSI*字符

#### 指令：委托交易

##### 文件单命名规范

- 后缀名命名方式: **\*.order.dbf**

##### 字段定义说明

| 字段参数名                | 类型   | 必填 | 说明                                                                                                                                                                                                               |
| :------------------------ | :----- | ---- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| sid                       | string | 是   | 用户策略定义的交易指令 ID, 唯一性, 不可重复使用                                                                                                                                                                    |
| account_id                | string | 是   | 掘金交易账号 ID                                                                                                                                                                                                    |
| symbol                    | string | 是   | 标的代码, 格式: 市场.代码 例如:平安银行 SZSE.000001 浦发银行 SHSE.600000                                                                                                                                           |
| volume                    | number | 是   | 委托量                                                                                                                                                                                                             |
| order_type                | string | 是   | 委托类型, 请参考下面的数据字典定义 [参见](https://www.myquant.cn/docs/subject/scanner_v2_csv_guide.html#ordertype%20%E5%A7%94%E6%89%98%E7%B1%BB%E5%9E%8B)                                                          |
| order_business(order_biz) | string | 是   | 委托业务类型, 请参考下面的数据字典定义 **注：参数名必须带括号里面的字段 ** [参见](https://www.myquant.cn/docs/subject/scanner_v2_csv_guide.html#orderbiz%20%E5%A7%94%E6%89%98%E4%B8%9A%E5%8A%A1%E7%B1%BB%E5%9E%8B) |
| price                     | number | 否   | 委托价格. 当委托类型为限价单时, 必填                                                                                                                                                                               |
| comment                   | string | 否   | 备注说明, 不需要时可给空字符串.最大 254 个*ANSI*字符                                                                                                                                                               |

#### 指令：撤销委托

##### 文件单命名规范

- 后缀名命名方式: **\*.cancel_order.dbf**

##### 字段定义说明

| 字段参数名 | 类型   | 必填 | 说明                                                 |
| :--------- | :----- | ---- | :--------------------------------------------------- |
| sid        | string | 是   | 需要撤销的交易指令 ID, 对应委托指令中的 sid 参数     |
| comment    | string | 否   | 备注说明, 不需要时可给空字符串.最大 254 个*ANSI*字符 |

#### 指令：功能号请求

##### 文件单命名规范

- 后缀名命名方式: **\*.func_request.dbf**

##### 字段定义说明

| 字段参数名 | 类型   | 必填 | 说明                                                                             |
| :--------- | :----- | ---- | :------------------------------------------------------------------------------- |
| rid        | string | 是   | 用户策略定义的功能号请求 ID, 唯一性, 不可重复使用                                |
| account_id | string | 是   | 掘金交易账号 ID                                                                  |
| func_id    | string | 是   | 功能号 ID                                                                        |
| func_args  | string | 否   | 功能号参数, **单行** json 字符串，形如`{"param1": "value1", "param2"："value2"}` |
| comment    | string | 否   | 备注说明, 不需要时可给空字符串.最大 254 个*ANSI*字符                             |

#### 指令: 算法交易委托

> 关于 **算法交易**, 请参考文档: [算法交易](https://www.myquant.cn/docs/subject/algo_trade1.html)

##### 文件单命名规范

- 后缀命名方式: **\*.algo_order.dbf**

##### 字段定义说明

| 字段参数名                | 类型   | 必填 | 说明                                                                                                                                                                                                               |
| ------------------------- | ------ | ---- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| sid                       | string | 是   | 用户策略定义的交易指令 ID, 唯一性, 不可重复使用. 在算法交易里, 为算法交易母单的 sid                                                                                                                                |
| account_id                | string | 是   | 掘金交易账号 ID                                                                                                                                                                                                    |
| symbol                    | string | 是   | 标的代码, 格式: 市场.代码 例如:平安银行 SZSE.000001 浦发银行 SHSE.600000                                                                                                                                           |
| algo_name                 | string | 是   | **算法名称**: TWAP, VWAP, ATS-SMART,ZC-POV                                                                                                                                                                         |
| algo_param                | string | 是   | 算法参数. 不同算法有不同的参数, 具体写法请参考下文的 **算法及其算法参数说明**.                                                                                                                                     |
| order_type                | string | 是   | 委托类型, 请参考下面的数据字典定义 [参见](https://www.myquant.cn/docs/subject/scanner_v2_csv_guide.html#ordertype%20%E5%A7%94%E6%89%98%E7%B1%BB%E5%9E%8B)                                                          |
| order_business(order_biz) | string | 是   | 委托业务类型, 请参考下面的数据字典定义 **注：参数名必须带括号里面的字段 ** [参见](https://www.myquant.cn/docs/subject/scanner_v2_csv_guide.html#orderbiz%20%E5%A7%94%E6%89%98%E4%B8%9A%E5%8A%A1%E7%B1%BB%E5%9E%8B) |
| volume                    | number | 是   | 委托量, 整数                                                                                                                                                                                                       |
| price                     | number | 否   | 委托价格. 当委托类型为限价单时, 必填                                                                                                                                                                               |
| comment                   | string | 否   | 备注说明, 不需要时可给空字符串.最大 254 个*ANSI*字符                                                                                                                                                               |

##### 算法及其算法参数说明

###### ATS-SMART 算法

- ATS-SMART 算法：根据用户委托交易特征，通过对市场高频数据的实时分析和处理，利用程序化分析动态选择最优算法执行用户委托。具有高完成度，高稳定性，高隐蔽性，低敞口等特点，在不同持仓风格场景下，中长期均体现出稳定超越 TWAP/VWAP 基准的效果

###### ATS-SMART 的算法参数

- **start_time** : **开始时间**, 策略开始执行的时间（剔除非交易时间段）。如果开始时间早于策略下达时间点时，则使用下达时间作为开始时间. 时间格式: HH:MM:SS, 例如: 13:50:00 下午 1 点 50 分
- **end_time_referred** : **结束参考时间**, 和结束时间一致. (不能超过 14:55:00) 时间格式同上
- **end_time** : **结束时间**, 策略停止执行的时间（剔除非交易时间段）。过了结束时间还未完成的数量，将会自动释放到指令。算法执行的区间段，时间越短，任务执行强度（委托频率和单笔委托量）越高. (不能超过 14:55:00) 时间格式同上
- **end_time_valid** : **结束时间是否有效**, 算法在结束时间是否有效,如设为无效，则以收盘时间为结束时间. 1 为有效， 0 为无效
- **stop_sell_when_dl** : **涨停时是否停止卖出**, 标的在涨停时是否需要停止卖出. 1 为是，0 为否
- **cancel_when_pl** : **跌停时是否撤单**, 标的在跌停时是否需要撤单. 1 为是，0 为否
- **min_trade_amount** : 控制子单单笔委托的最小金额, 该参数只适用于股票。A 股单位为元

###### ZC-POV 算法

- ZC-POV 算法：根据用户委托交易特征，通过追踪目标股票流动性，按照市场参与度完成用户委托交易。算法针对性解决股票交易中大金额委托造成的交易冲击、目的暴露、完成率低等问题，更加贴近客户的真实委托意愿

###### ZC-POV 的算法参数

- **参与率**：市场参与率，即每日委托总量占市场真实交易额的比例（上交易日参考标准），默认 30%，最高委托量比例限制为 45%
- **基准价格**：算法模型的参考基准价格，这里指限价。卖出时，当市场价格低于此价格就停止交易，再次高于此价格就恢复交易，并且补回前面应停止交易而少交易的量；买入时，当市场价格高于此价格就停止交易，再次低于此价格就恢复交易，并且补回前面应停止交易而少交易的量。当填入价格为 0 时，则不设置基准价。

###### algo_param 字段格式

- 格式规范 arg_name=arg_value, 之间采用 **&** 号隔开
- 参考示例:

  - ATS-SMART 算法参数示例: `start_time=13:00:00&end_time_referred=14:50:00&end_time=14:00:00&end_time_valid=1&stop_sell_when_dl=1&cancel_when_pl=1&min_trade_amount=0`

  - ZC-POV 算法参数示例:
    `participation_rate=15`

#### 指令: 算法交易控制

##### 文件单命名规范

- 后缀命名方式: **\*.handle_algo_order.dbf**

##### 字段定义说明

| 字段参数名 | 类型   | 必填 | 说明                                                                     |
| ---------- | ------ | ---- | ------------------------------------------------------------------------ |
| sid        | string | 是   | 为算法交易母单的 sid                                                     |
| type       | number | 是   | 算法交易控制指令类型: 1 - 重启 2 - 暂停 3 -暂停并撤子单 4 - 撤销母单委托 |
| comment    | string | 否   | 备注说明, 不需要时可给空字符串.最大 254 个*ANSI*字符                     |

**注意：** `ATS-SMART` 算法仅支持 `4 - 撤销母单委托` 参数

### 数据字典定义

#### order_type 委托类型

| order_type 取值 | 含义                                        |
| :-------------- | :------------------------------------------ |
| 1               | 限价                                        |
| 10              | 限价, 即时成交剩余撤销 (fill and kill)      |
| 11              | 限价, 即时全额成交或撤销 (fill or kill)     |
| 2               | 市价                                        |
| 20              | 市价, 对方最优价格 (best of counterparty)   |
| 21              | 市价, 己方最优价格 (best of party)          |
| 22              | 市价, 即时成交剩余撤销 (fill and kill)      |
| 23              | 市价, 即时全额成交或撤销 (fill or kill)     |
| 24              | 市价, 最优五档剩余撤销 (best 5 then cancel) |
| 25              | 市价, 最优五档剩余转限价(best 5 then limit) |
| 4               | 盘后定价交易 (after hour trading)           |

##### order_type 参数设置说明

| 市场         | 参数名         | 可选值 | 含义                                                 |
| ------------ | :------------- | :----- | ---------------------------------------------------- |
| **深圳市场** | **order_type** | 1      | 限价                                                 |
|              |                | 20     | 市价, 对方最优价格 (best of counterparty)            |
|              |                | 21     | 市价, 己方最优价格 (best of party)                   |
|              |                | 22     | 市价, 即时成交剩余撤销 (fill and kill)               |
|              |                | 23     | 市价, 即时全额成交或撤销 (fill or kill)              |
|              |                | 24     | 市价, 最优五档剩余撤销 (best 5 then cancel)          |
| **上海市场** | **order_type** | 1      | 限价                                                 |
|              |                | 24     | 市价, 最优五档剩余撤销 (best 5 then cancel)          |
|              |                | 25     | 市价, 最优五档剩余转限价(best 5 then limit)          |
| **大商所**   | **order_type** | 1      | 限价                                                 |
|              |                | 10     | 限价, 即时成交剩余撤销 (fill and kill)               |
|              |                | 11     | 限价, 即时全额成交或撤销 (fill or kill)              |
|              |                | 2      | 市价                                                 |
|              |                | 22     | 市价, 即时成交剩余撤销 (fill and kill)               |
|              |                | 23     | 市价, 即时全额成交或撤销 (fill or kill)              |
| **郑商所**   | **order_type** | 1      | 限价                                                 |
|              |                | 22     | 市价, 即时成交剩余撤销 (fill and kill)               |
| **上期所**   | **order_type** | 1      | 限价                                                 |
|              |                | 10     | 限价, 即时成交剩余撤销 (fill and kill)               |
|              |                | 11     | 限价, 即时全额成交或撤销 (fill or kill)              |
| **中金所**   | **order_type** | 1      | 限价                                                 |
|              |                | 10     | 限价, 即时成交剩余撤销 (fill and kill)               |
|              |                | 11     | 限价, 即时全额成交或撤销 (fill or kill)              |
|              |                | 24     | 市价，五档市价 （远期合约不支持）                    |
|              |                | 25     | 市价, 五档市价 FAK (fill and kill)（远期合约不支持） |

#### order_biz 委托业务类型

| 业务范围 | order_biz 取值 | 含义                                             |
| :------- | :------------- | :----------------------------------------------- |
| 股票     | 1              | 股票, 买入                                       |
|          | 2              | 股票, 卖出                                       |
| 期货     | 10             | 期货, 买入开仓                                   |
|          | 11             | 期货, 卖出平仓                                   |
|          | 12             | 期货, 卖出平仓, 平今仓 (上海商品期货交易所 only) |
|          | 13             | 期货, 卖出平仓, 平昨仓 (上海商品期货交易所 only) |
|          | 14             | 期货, 卖出开仓                                   |
|          | 15             | 期货, 买入平仓                                   |
|          | 16             | 期货, 买入平仓，平今仓 (上海商品期货交易所 only) |
|          | 17             | 期货, 买入平仓, 平昨仓 (上海商品期货交易所 only) |
| 新股申购 | 100            | 新股申购                                         |
| 融资融券 | 200            | 融资买入 (buying on margin)                      |
|          | 201            | 融券卖出 (short selling)                         |
|          | 202            | 买券还券 (repay share by buying share)           |
|          | 203            | 卖券还款 (repay cash by selling share)           |
|          | 204            | 直接还券 (directly repay share)                  |
|          | 207            | 担保品买入 (buying on collateral)                |
|          | 208            | 担保品卖出 (selling on collateral)               |
|          | 209            | 担保品转入 (collateral in)                       |
|          | 210            | 担保品转出 (collateral out)                      |
|          | 212            | 专项融资买入 (buying on margin for vip)          |
|          | 213            | 专项融券卖出 (short selling for vip)             |
| 逆回购   | 400            | 逆回购                                           |
| 可转债   | 402            | 可转债转股                                       |
|          | 403            | 可转债回售                                       |
|          | 404            | 可转债回售撤销                                   |

##### 补充说明

- **逆回购** 如何获取 symbol 字段对应的标的代码. 下面以 逆回购 **R-007** 为例:

  - 在 **交易工具** 页面里, 在任意一个交易监控面板页面, 通过按键精灵功能,输入需要进行逆回购的代码, 本例中为: r-007 (不区分大小写)
    ![](http://www.myquant.cn/uploads/202103/attach_166c706c9f5f223e.png)

  - 点击找到的标的记录后, 即可查看到该逆回购标的在掘金系统里的证券代码.

    ![](http://www.myquant.cn/uploads/202103/attach_166c70a7ca332c0b.png)

  - 如上图所示, 逆回购 R-007 时, **symbol** 字段填写应为对应的掘金系统证券代码: **SZSE.131801**

##### 注意事项

- `205`、`206` 为券商发起的强制平仓业务， 用户不能操作
- `400` (逆回购) 时, **volume** (委托量) 字段的取值说明:
  - 上海市场, voluem 应设置为 **10** 的整数倍
  - 深圳市场, volume 应设置为 **10** 的整数倍
- `100` (新股申购) 时, 新股是**volume** (委托量) 字段应为 **100** 的整数倍, **price** (委托价格) 字段应大于 0, 推荐填写新股发行价

### 输出数据文件规范

在文件单输出配置里面，配置并开启了指定交易账户的文件单输出后，会在文件单的输出目录下，已指定交易账户的 ID 为名称创建子目录，在此子目录下输出需要的交易反馈数据。文件名称与数据类别对应关系请看下表，文件格式和规范参考下文。

| dbf 格式文件名          | 说明                 |
| ----------------------- | -------------------- |
| cash.dbf                | 交易账户资金数据     |
| position.dbf            | 交易账户持仓数据     |
| order_status.dbf        | 日内委托数据         |
| execution_report.dbf    | 委托执行回报数据     |
| order_status_change.dbf | 委托状态变更流水记录 |
| func_response.dbf       | 功能号执行结果数据   |

### dbf 格式

#### 交易账户资金数据

- 文件名称：cash.dbf
- 刷新方式：整文件刷新

| 字段参数名 | 类型     | 说明                   |
| :--------- | :------- | :--------------------- |
| account_id | string   | 掘金交易账号 ID        |
| market_val | number   | 持仓市值               |
| nav        | number   | 总资产                 |
| pnl        | number   | 累计收益（实盘不支持） |
| fpnl       | number   | 浮动盈亏               |
| frozen     | number   | 持仓占用资金（期货）   |
| available  | number   | 可用资金               |
| balance    | number   | 资金余额               |
| created_at | datetime | 资金初始时间           |
| updated_at | datetime | 资金变更时间           |
| recv_at    | datetime | 终端接收时间           |
| ord_frozen | number   | 冻结资金               |

#### 交易账户持仓数据

- 文件名称：position.dbf
- 刷新方式：整文件刷新

| 字段参数名 | 类型     | 说明                                                                         |
| :--------- | :------- | :--------------------------------------------------------------------------- |
| account_id | string   | 掘金交易账号 ID                                                              |
| symbol     | string   | 证券代码(市场.代码)如:SZSE.000001                                            |
| side       | number   | 持仓方向 [参见](https://www.myquant.cn/docs/python/50.html#h2-positionside-) |
| volume     | number   | 总持仓量; 昨持仓量(volume-vol_today)                                         |
| vol_today  | number   | 今日持仓量                                                                   |
| vwap       | number   | 持仓均价                                                                     |
| vwap_dild  | number   | 摊薄持仓均价                                                                 |
| market_val | number   | 持仓市值                                                                     |
| price      | number   | 当前行情价格                                                                 |
| fpnl       | number   | 持仓浮动盈亏                                                                 |
| cost       | number   | 持仓成本                                                                     |
| avl_now    | number   | 当前可平仓位(根据标的的 T+N 属性计算)                                        |
| created_at | datetime | 建仓时间                                                                     |
| updated_at | datetime | 仓位变更时间                                                                 |
| recv_at    | datetime | 终端接收时间                                                                 |

#### 日内委托数据

- 文件名称：order_status.dbf
- 刷新方式：整文件刷新

| 字段名                    | 类型     | 说明                                                                                                                                                 |
| :------------------------ | :------- | :--------------------------------------------------------------------------------------------------------------------------------------------------- |
| account_id                | string   | 掘金交易账号 ID                                                                                                                                      |
| sid                       | string   | 如果该委托时由扫单服务产生的, 对应委托指令的 sid 参数. 如果该委托不是由扫单服务产生的,则为空                                                         |
| scan_name                 | string   | 表明该委托对应的扫单名称                                                                                                                             |
| cl_ord_id                 | string   | 委托客户端 ID                                                                                                                                        |
| order_id                  | string   | 委托柜台 ID                                                                                                                                          |
| symbol                    | string   | 证券代码(市场.代码)如:SZSE.000001                                                                                                                    |
| order_type                | number   | 委托类型 [参见](https://www.myquant.cn/docs/subject/scanner_v2_csv_guide.html#ordertype%20%E5%A7%94%E6%89%98%E7%B1%BB%E5%9E%8B)                      |
| order_business(order_biz) | number   | 委托业务属性 [参见](https://www.myquant.cn/docs/subject/scanner_v2_csv_guide.html#orderbiz%20%E5%A7%94%E6%89%98%E4%B8%9A%E5%8A%A1%E7%B1%BB%E5%9E%8B) |
| status                    | number   | 委托状态 [参见](https://www.myquant.cn/docs/python/50.html#h2-orderstatus-)                                                                          |
| rej_reason                | number   | 委托拒绝原因 [参见](https://www.myquant.cn/docs/python/50.html#h2-orderrejectreason-)                                                                |
| rej_detail                | string   | 委托拒绝原因描述                                                                                                                                     |
| price                     | number   | 委托价格                                                                                                                                             |
| volume                    | number   | 委托量                                                                                                                                               |
| filled_vol                | number   | 已成量                                                                                                                                               |
| created_at                | datetime | 委托创建时间                                                                                                                                         |
| updated_at                | datetime | 委托更新时间                                                                                                                                         |
| sent_at                   | datetime | 委托(终端)发送时间                                                                                                                                   |
| recv_at                   | datetime | 委托(终端)确认(状态变为已报)时间                                                                                                                     |
| filledvwap                | number   | 已成均价                                                                                                                                             |
| filled_amt                | number   | 已成金额                                                                                                                                             |

#### 委托执行回报数据

- 文件名称：execution_report.dbf
- 刷新方式：启动同步账户成交数据，新数据在文件末尾追加

| 字段名                    | 类型     | 说明                                                                                                                                                 |
| :------------------------ | :------- | :--------------------------------------------------------------------------------------------------------------------------------------------------- |
| account_id                | string   | 掘金交易账号 ID                                                                                                                                      |
| sid                       | string   | 如果该委托时由扫单服务产生的, 对应委托指令的 sid 参数. 如果该委托不是由扫单服务产生的,则为空                                                         |
| scan_name                 | string   | 表明该委托对应的扫单名称                                                                                                                             |
| cl_ord_id                 | string   | 委托客户端 ID                                                                                                                                        |
| order_id                  | string   | 委托柜台 ID                                                                                                                                          |
| exec_id                   | string   | 委托回报 ID                                                                                                                                          |
| symbol                    | string   | 证券代码(市场.代码)如:SZSE.000001                                                                                                                    |
| order_business(order_biz) | number   | 委托业务属性 [参见](https://www.myquant.cn/docs/subject/scanner_v2_csv_guide.html#orderbiz%20%E5%A7%94%E6%89%98%E4%B8%9A%E5%8A%A1%E7%B1%BB%E5%9E%8B) |
| rej_reason                | number   | 委托拒绝原因 [参见](https://www.myquant.cn/docs/python/50.html#h2-orderrejectreason-)                                                                |
| rej_detail                | string   | 委托拒绝原因描述                                                                                                                                     |
| exec_type                 | number   | 执行回报类型 [参见](https://www.myquant.cn/docs/python/50.html#h2-exectype-)                                                                         |
| price                     | number   | 委托成交价格                                                                                                                                         |
| volume                    | number   | 委托成交量                                                                                                                                           |
| created_at                | datetime | 回报创建时间                                                                                                                                         |
| recv_at                   | datetime | 终端接收时间                                                                                                                                         |
| amount                    | number   | 委托成交金额                                                                                                                                         |

#### 委托状态变更流水记录

- 文件名称：order_status_change.dbf
- 刷新方式：文件末尾追加

| 字段名                    | 类型     | 说明                                                                                                                                                 |
| :------------------------ | :------- | :--------------------------------------------------------------------------------------------------------------------------------------------------- |
| account_id                | string   | 掘金交易账号 ID                                                                                                                                      |
| sid                       | string   | 如果该委托时由扫单服务产生的, 对应委托指令的 sid 参数. 如果该委托不是由扫单服务产生的,则为空                                                         |
| scan_name                 | string   | 表明该委托对应的扫单名称                                                                                                                             |
| cl_ord_id                 | string   | 委托客户端 ID                                                                                                                                        |
| order_id                  | string   | 委托柜台 ID                                                                                                                                          |
| symbol                    | string   | 证券代码(市场.代码)如:SZSE.000001                                                                                                                    |
| order_type                | number   | 委托类型 [参见](https://www.myquant.cn/docs/subject/scanner_v2_csv_guide.html#ordertype%20%E5%A7%94%E6%89%98%E7%B1%BB%E5%9E%8B)                      |
| order_business(order_biz) | number   | 委托业务属性 [参见](https://www.myquant.cn/docs/subject/scanner_v2_csv_guide.html#orderbiz%20%E5%A7%94%E6%89%98%E4%B8%9A%E5%8A%A1%E7%B1%BB%E5%9E%8B) |
| status                    | number   | 委托状态 [参见](https://www.myquant.cn/docs/python/50.html#h2-orderstatus-)                                                                          |
| rej_reason                | number   | 委托拒绝原因 [参见](https://www.myquant.cn/docs/python/50.html#h2-orderrejectreason-)                                                                |
| rej_detail                | string   | 委托拒绝原因描述                                                                                                                                     |
| price                     | number   | 委托价格                                                                                                                                             |
| volume                    | number   | 委托量                                                                                                                                               |
| filled_vol                | number   | 已成量                                                                                                                                               |
| created_at                | datetime | 委托创建时间                                                                                                                                         |
| updated_at                | datetime | 委托更新时间                                                                                                                                         |
| sent_at                   | datetime | 委托(终端)发送时间                                                                                                                                   |
| recv_at                   | datetime | 委托(终端)确认(状态变为已报)时间                                                                                                                     |
| filledvwap                | number   | 已成均价                                                                                                                                             |
| filled_amt                | number   | 已成金额                                                                                                                                             |

#### 功能号执行结果数据

- 文件名称：func_response.dbf
- 刷新方式：文件末尾追加

| 字段名     | 类型     | 说明                                             |
| :--------- | :------- | :----------------------------------------------- |
| rid        | string   | 功能号请求 ID，与功能号交易指令中的 rid 参数对应 |
| account_id | string   | 掘金交易账号 ID                                  |
| data       | string   | 功能号扫单结果，**单行** json 字符串             |
| error_code | string   | 错误编码                                         |
| error_info | string   | 错误信息                                         |
| recv_at    | datetime | 终端接收时间                                     |

---

## 2. csv - 文件单

用户策略通过文件的形式向终端提交委托指令，同时也是通过文件的形式，获取相关的交易数据反馈。本规范分别对作为输入的文件单和作为输出的数据文件的格式规范进行描述。

### 输入文件单规范

- 文件单是用户委托指令的载体，目前掘金终端支持 **dbf** 和 **csv** 2 种文件格式。本文是描述 csv 格式的接入规范。

- 用户的指令分成 3 类， 分别是：**委托交易**，**撤销委托**， **功能号指令**。 掘金终端， 通过文件名称后缀来区分文件格式和指令种类。具体请参考下表所示：

| 示例                                     | 后缀部分          | 文件格式 | 指令种类   |
| ---------------------------------------- | ----------------- | -------- | ---------- |
| 2020-10-15_10:48:09.072.order.csv        | .order.csv        | csv      | 委托交易   |
| 2020-10-15_10:48:09.072.cancel_order.csv | .cancel_order.csv | csv      | 撤销委托   |
| 2020-10-15_10:48:09.072.func_request.csv | .func_request.csv | csv      | 功能号指令 |

### csv 格式

- 因 dbf 因格式规范限制，字段名称不能超过 10 个 ansi 字符。而我们的 SDK 文档里，字段都是使用的全称。为了方便对应，在 csv 文件里，对于那些在 dbf 里被进行了简写的字段，csv 文件中，字段的命名方式为： **全称(简称)**, 例子如下：
  - dbf 中，**order_biz** 是简写后的字段名称，在 csv 中，对应的字段名称为：**order_business(order_biz)**

#### 指令：委托交易

##### 文件单命名规范

- 后缀名命名方式: **\*.order.csv**

##### 字段定义说明

| 字段参数名                | 类型   | 必填 | 说明                                                                                                                                                                                                               |
| :------------------------ | :----- | ---- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| sid                       | string | 是   | 用户策略定义的交易指令 ID, 唯一性, 不可重复使用                                                                                                                                                                    |
| account_id                | string | 是   | 掘金交易账号 ID                                                                                                                                                                                                    |
| symbol                    | string | 是   | 标的代码, 格式: 市场.代码 例如:平安银行 SZSE.000001 浦发银行 SHSE.600000                                                                                                                                           |
| volume                    | number | 是   | 委托量, 整数                                                                                                                                                                                                       |
| order_type                | string | 是   | 委托类型, 请参考下面的数据字典定义 [参见](https://www.myquant.cn/docs/subject/scanner_v2_csv_guide.html#ordertype%20%E5%A7%94%E6%89%98%E7%B1%BB%E5%9E%8B)                                                          |
| order_business(order_biz) | string | 是   | 委托业务类型, 请参考下面的数据字典定义 **注：参数名必须带括号里面的字段 ** [参见](https://www.myquant.cn/docs/subject/scanner_v2_csv_guide.html#orderbiz%20%E5%A7%94%E6%89%98%E4%B8%9A%E5%8A%A1%E7%B1%BB%E5%9E%8B) |
| price                     | number | 否   | 委托价格. 当委托类型为限价单时, 必填                                                                                                                                                                               |
| comment                   | string | 否   | 备注说明, 不需要时可给空字符串.                                                                                                                                                                                    |

#### 指令：撤销委托

##### 文件单命名规范

- 后缀名命名方式: **\*.cancel_order.csv**

##### 字段定义说明

| 字段参数名 | 类型   | 必填 | 说明                                             |
| :--------- | :----- | ---- | :----------------------------------------------- |
| sid        | string | 是   | 需要撤销的交易指令 ID, 对应委托指令中的 sid 参数 |
| comment    | string | 否   | 备注说明, 不需要时可给空字符串.                  |

#### 指令：功能号请求

##### 文件单命名规范

- 后缀名命名方式: **\*.func_request.csv**

##### 字段定义说明

| 字段参数名 | 类型   | 必填 | 说明                                                                             |
| :--------- | :----- | ---- | :------------------------------------------------------------------------------- |
| rid        | string | 是   | 用户策略定义的功能号请求 ID, 唯一性, 不可重复使用                                |
| account_id | string | 是   | 掘金交易账号 ID                                                                  |
| func_id    | string | 是   | 功能号 ID                                                                        |
| func_args  | string | 否   | 功能号参数, **单行** json 字符串，形如`{"param1": "value1", "param2"："value2"}` |
| comment    | string | 否   | 备注说明, 不需要时可给空字符串.                                                  |

#### 指令: 算法交易委托

> 关于 **算法交易**, 请参考文档: [算法交易](https://www.myquant.cn/docs/subject/algo_trade1.html)

##### 文件单命名规范

- 后缀命名方式: **\*.algo_order.csv**

##### 字段定义说明

| 字段参数名                | 类型   | 必填 | 说明                                                                                                                                                                                                               |
| ------------------------- | ------ | ---- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| sid                       | string | 是   | 用户策略定义的交易指令 ID, 唯一性, 不可重复使用. 在算法交易里, 为算法交易母单的 sid                                                                                                                                |
| account_id                | string | 是   | 掘金交易账号 ID                                                                                                                                                                                                    |
| symbol                    | string | 是   | 标的代码, 格式: 市场.代码 例如:平安银行 SZSE.000001 浦发银行 SHSE.600000                                                                                                                                           |
| algo_name                 | string | 是   | **算法名称**: TWAP, VWAP, ATS-SMART, ZC-POV                                                                                                                                                                        |
| algo_param                | string | 是   | 算法参数. 不同算法有不同的参数, 具体写法请参考下文的 **算法及其算法参数说明**.                                                                                                                                     |
| order_type                | string | 是   | 委托类型, 请参考下面的数据字典定义 [参见](https://www.myquant.cn/docs/subject/scanner_v2_csv_guide.html#ordertype%20%E5%A7%94%E6%89%98%E7%B1%BB%E5%9E%8B)                                                          |
| order_business(order_biz) | string | 是   | 委托业务类型, 请参考下面的数据字典定义 **注：参数名必须带括号里面的字段 ** [参见](https://www.myquant.cn/docs/subject/scanner_v2_csv_guide.html#orderbiz%20%E5%A7%94%E6%89%98%E4%B8%9A%E5%8A%A1%E7%B1%BB%E5%9E%8B) |
| volume                    | number | 是   | 委托量, 整数                                                                                                                                                                                                       |
| price                     | number | 否   | 委托价格. 当委托类型为限价单时, 必填                                                                                                                                                                               |
| comment                   | string | 否   | 备注说明, 不需要时可给空字符串.                                                                                                                                                                                    |

##### 算法及其算法参数说明

###### ATS-SMART 算法

- ATS-SMART 算法：根据用户委托交易特征，通过对市场高频数据的实时分析和处理，利用程序化分析动态选择最优算法执行用户委托。具有高完成度，高稳定性，高隐蔽性，低敞口等特点，在不同持仓风格场景下，中长期均体现出稳定超越 TWAP/VWAP 基准的效果

###### ATS-SMART 的算法参数

- **start_time** : **开始时间**, 策略开始执行的时间（剔除非交易时间段）。如果开始时间早于策略下达时间点时，则使用下达时间作为开始时间. 时间格式: HH:MM:SS, 例如: 13:50:00 下午 1 点 50 分
- **end_time_referred** : **结束参考时间**, 和结束时间一致. (不能超过 14:55:00) 时间格式同上
- **end_time** : **结束时间**, 策略停止执行的时间（剔除非交易时间段）。过了结束时间还未完成的数量，将会自动释放到指令。算法执行的区间段，时间越短，任务执行强度（委托频率和单笔委托量）越高. (不能超过 14:55:00) 时间格式同上
- **end_time_valid** : **结束时间是否有效**, 算法在结束时间是否有效,如设为无效，则以收盘时间为结束时间. 1 为有效， 0 为无效
- **stop_sell_when_dl** : **涨停时是否停止卖出**, 标的在涨停时是否需要停止卖出. 1 为是，0 为否
- **cancel_when_pl** : **跌停时是否撤单**, 标的在跌停时是否需要撤单. 1 为是，0 为否
- **min_trade_amount** : 控制子单单笔委托的最小金额, 该参数只适用于股票。A 股单位为元

###### ZC-POV 算法

- ZC-POV 算法：根据用户委托交易特征，通过追踪目标股票流动性，按照市场参与度完成用户委托交易。算法针对性解决股票交易中大金额委托造成的交易冲击、目的暴露、完成率低等问题，更加贴近客户的真实委托意愿

###### ZC-POV 的算法参数

- **参与率**：市场参与率，即每日委托总量占市场真实交易额的比例（上交易日参考标准），默认 30%，最高委托量比例限制为 45%
- **基准价格**：算法模型的参考基准价格，这里指限价。卖出时，当市场价格低于此价格就停止交易，再次高于此价格就恢复交易，并且补回前面应停止交易而少交易的量；买入时，当市场价格高于此价格就停止交易，再次低于此价格就恢复交易，并且补回前面应停止交易而少交易的量。当填入价格为 0 时，则不设置基准价。

###### algo_param 字段格式

- 格式规范 arg_name=arg_value, 之间采用 **&** 号隔开
- 参考示例:
  - ATS-SMART 算法参数示例: `start_time=13:00:00&end_time_referred=14:50:00&end_time=14:00:00&end_time_valid=1&stop_sell_when_dl=1&cancel_when_pl=1&min_trade_amount=0`
  - ZC-POV 算法参数示例:
    `participation_rate=15`

#### 指令: 算法交易控制

##### 文件单命名规范

- 后缀命名方式: **\*.handle_algo_order.csv**

##### 字段定义说明

| 字段参数名 | 类型   | 必填 | 说明                                                                     |
| ---------- | ------ | ---- | ------------------------------------------------------------------------ |
| sid        | string | 是   | 为算法交易母单的 sid                                                     |
| type       | number | 是   | 算法交易控制指令类型: 1 - 重启 2 - 暂停 3 -暂停并撤子单 4 - 撤销母单委托 |
| comment    | string | 否   | 备注说明, 不需要时可给空字符串.                                          |

**注意：** `ATS-SMART` 算法仅支持 `4 - 撤销母单委托` 参数

### 数据字典定义

#### order_type 委托类型

| order_type 取值 | 含义                                        |
| :-------------- | :------------------------------------------ |
| 1               | 限价                                        |
| 10              | 限价, 即时成交剩余撤销 (fill and kill)      |
| 11              | 限价, 即时全额成交或撤销 (fill or kill)     |
| 2               | 市价                                        |
| 20              | 市价, 对方最优价格 (best of counterparty)   |
| 21              | 市价, 己方最优价格 (best of party)          |
| 22              | 市价, 即时成交剩余撤销 (fill and kill)      |
| 23              | 市价, 即时全额成交或撤销 (fill or kill)     |
| 24              | 市价, 最优五档剩余撤销 (best 5 then cancel) |
| 25              | 市价, 最优五档剩余转限价(best 5 then limit) |
| 4               | 盘后定价交易 (after hour trading)           |

##### order_type 参数设置说明

| 市场         | 参数名         | 可选值 | 含义                                                 |
| ------------ | :------------- | :----- | ---------------------------------------------------- |
| **深圳市场** | **order_type** | 1      | 限价                                                 |
|              |                | 20     | 市价, 对方最优价格 (best of counterparty)            |
|              |                | 21     | 市价, 己方最优价格 (best of party)                   |
|              |                | 22     | 市价, 即时成交剩余撤销 (fill and kill)               |
|              |                | 23     | 市价, 即时全额成交或撤销 (fill or kill)              |
|              |                | 24     | 市价, 最优五档剩余撤销 (best 5 then cancel)          |
| **上海市场** | **order_type** | 1      | 限价                                                 |
|              |                | 24     | 市价, 最优五档剩余撤销 (best 5 then cancel)          |
|              |                | 25     | 市价, 最优五档剩余转限价(best 5 then limit)          |
| **大商所**   | **order_type** | 1      | 限价                                                 |
|              |                | 10     | 限价, 即时成交剩余撤销 (fill and kill)               |
|              |                | 11     | 限价, 即时全额成交或撤销 (fill or kill)              |
|              |                | 2      | 市价                                                 |
|              |                | 22     | 市价, 即时成交剩余撤销 (fill and kill)               |
|              |                | 23     | 市价, 即时全额成交或撤销 (fill or kill)              |
| **郑商所**   | **order_type** | 1      | 限价                                                 |
|              |                | 22     | 市价, 即时成交剩余撤销 (fill and kill)               |
| **上期所**   | **order_type** | 1      | 限价                                                 |
|              |                | 10     | 限价, 即时成交剩余撤销 (fill and kill)               |
|              |                | 11     | 限价, 即时全额成交或撤销 (fill or kill)              |
| **中金所**   | **order_type** | 1      | 限价                                                 |
|              |                | 10     | 限价, 即时成交剩余撤销 (fill and kill)               |
|              |                | 11     | 限价, 即时全额成交或撤销 (fill or kill)              |
|              |                | 24     | 市价，五档市价 （远期合约不支持）                    |
|              |                | 25     | 市价, 五档市价 FAK (fill and kill)（远期合约不支持） |

#### order_biz 委托业务类型

| 业务范围 | order_biz 取值 | 含义                                             |
| :------- | :------------- | :----------------------------------------------- |
| 股票     | 1              | 股票, 买入                                       |
|          | 2              | 股票, 卖出                                       |
| 期货     | 10             | 期货, 买入开仓                                   |
|          | 11             | 期货, 卖出平仓                                   |
|          | 12             | 期货, 卖出平仓, 平今仓 (上海商品期货交易所 only) |
|          | 13             | 期货, 卖出平仓, 平昨仓 (上海商品期货交易所 only) |
|          | 14             | 期货, 卖出开仓                                   |
|          | 15             | 期货, 买入平仓                                   |
|          | 16             | 期货, 买入平仓，平今仓 (上海商品期货交易所 only) |
|          | 17             | 期货, 买入平仓, 平昨仓 (上海商品期货交易所 only) |
| 新股申购 | 100            | 新股申购                                         |
| 融资融券 | 200            | 融资买入 (buying on margin)                      |
|          | 201            | 融券卖出 (short selling)                         |
|          | 202            | 买券还券 (repay share by buying share)           |
|          | 203            | 卖券还款 (repay cash by selling share)           |
|          | 204            | 直接还券 (directly repay share)                  |
|          | 207            | 担保品买入 (buying on collateral)                |
|          | 208            | 担保品卖出 (selling on collateral)               |
|          | 209            | 担保品转入 (collateral in)                       |
|          | 210            | 担保品转出 (collateral out)                      |
|          | 212            | 专项融资买入 (buying on margin for vip)          |
|          | 213            | 专项融券卖出 (short selling for vip)             |
| 逆回购   | 400            | 逆回购                                           |
| 可转债   | 402            | 可转债转股                                       |
|          | 403            | 可转债回售                                       |
|          | 404            | 可转债回售撤销                                   |

##### 补充说明

- **逆回购** 如何获取 symbol 字段对应的标的代码. 下面以 逆回购 **R-007** 为例:

  - 在 **交易工具** 页面里, 在任意一个交易监控面板页面, 通过按键精灵功能,输入需要进行逆回购的代码, 本例中为: r-007 (不区分大小写)
    ![](http://www.myquant.cn/uploads/202103/attach_166c706c9f5f223e.png)

  - 点击找到的标的记录后, 即可查看到该逆回购标的在掘金系统里的证券代码.

    ![](http://www.myquant.cn/uploads/202103/attach_166c70a7ca332c0b.png)

  - 如上图所示, 逆回购 R-007 时, **symbol** 字段填写应为对应的掘金系统证券代码: **SZSE.131801**

##### 注意事项

- `205`、`206` 为券商发起的强制平仓业务， 用户不能操作
- `400` (逆回购) 时, **volume** (委托量) 字段的取值说明:
  - 上海市场, voluem 应设置为 **10** 的整数倍
  - 深圳市场, volume 应设置为 **10** 的整数倍
  - **order_type** (委托类型) 字段应为 **1**限价
- `100` (新股申购) 时, **volume** (委托量) 字段应为 **100** 的整数倍, **price** (委托价格) 字段应填写新股发行价，**order_type** (委托类型) 字段应为 **1**限价

### 输出数据文件规范

在文件单输出配置里面，配置并开启了指定交易账户的文件单输出后，会在文件单的输出目录下，已指定交易账户的 ID 为名称创建子目录，在此子目录下输出需要的交易反馈数据。文件名称与数据类别对应关系请看下表，文件格式和规范参考下文。

| csv 格式文件名          | 说明                 |
| ----------------------- | -------------------- |
| cash.csv                | 交易账户资金数据     |
| position.csv            | 交易账户持仓数据     |
| order_status.csv        | 日内委托数据         |
| execution_report.csv    | 委托执行回报数据     |
| order_status_change.csv | 委托状态变更流水记录 |
| func_response.csv       | 功能号执行结果数据   |

### csv 格式

#### 交易账户资金数据

- 文件名称：cash.csv
- 刷新方式：整文件刷新

| 字段参数名               | 类型     | 说明                     |
| :----------------------- | :------- | :----------------------- |
| account_id               | string   | 掘金交易账号 ID          |
| market_value(market_val) | number   | 持仓市值                 |
| nav                      | number   | 总资产                   |
| pnl                      | number   | 累计收益（实盘不支持）   |
| fpnl                     | number   | 浮动盈亏                 |
| frozen                   | number   | 持仓占用资金（期货适用） |
| available                | number   | 可用资金                 |
| balance                  | number   | 资金余额                 |
| created_at               | datetime | 资金初始时间             |
| updated_at               | datetime | 资金变更时间             |
| recv_at                  | datetime | 终端接收时间             |
| order_frozen(ord_frozen) | number   | 冻结资金                 |

#### 交易账户持仓数据

- 文件名称：position.csv
- 刷新方式：整文件刷新

| 字段参数名               | 类型     | 说明                                                                         |
| :----------------------- | :------- | :--------------------------------------------------------------------------- |
| account_id               | string   | 掘金交易账号 ID                                                              |
| symbol                   | string   | 证券代码(市场.代码)如:SZSE.000001                                            |
| side                     | number   | 持仓方向 [参见](https://www.myquant.cn/docs/python/50.html#h2-positionside-) |
| volume                   | number   | 总持仓量;                                                                    |
| volume_today(vol_today)  | number   | 今日持仓量                                                                   |
| vwap                     | number   | 持仓均价                                                                     |
| vwap_diluted(vwap_dild)  | number   | 摊薄持仓均价                                                                 |
| market_value(market_val) | number   | 持仓市值                                                                     |
| price                    | number   | 当前行情价格                                                                 |
| fpnl                     | number   | 持仓浮动盈亏                                                                 |
| cost                     | number   | 持仓成本                                                                     |
| available_now(avl_now)   | number   | 当前可平仓位(根据标的的 T+N 属性计算)                                        |
| created_at               | datetime | 建仓时间                                                                     |
| updated_at               | datetime | 仓位变更时间                                                                 |
| recv_at                  | datetime | 终端接收时间                                                                 |

#### 日内委托数据

- 文件名称：order_status.csv
- 刷新方式：整文件刷新

| 字段名                            | 类型     | 说明                                                                                                                                                 |
| :-------------------------------- | :------- | :--------------------------------------------------------------------------------------------------------------------------------------------------- |
| account_id                        | string   | 掘金交易账号 ID                                                                                                                                      |
| sid                               | string   | 如果该委托时由扫单服务产生的, 对应委托指令的 sid 参数. 如果该委托不是由扫单服务产生的,则为空                                                         |
| scan_name                         | string   | 表明该委托对应的扫单名称                                                                                                                             |
| cl_ord_id                         | string   | 委托客户端 ID                                                                                                                                        |
| order_id                          | string   | 委托柜台 ID                                                                                                                                          |
| symbol                            | string   | 证券代码(市场.代码)如:SZSE.000001                                                                                                                    |
| order_type                        | number   | 委托类型 [参见](https://www.myquant.cn/docs/subject/scanner_v2_csv_guide.html#ordertype%20%E5%A7%94%E6%89%98%E7%B1%BB%E5%9E%8B)                      |
| order_business(order_biz)         | number   | 委托业务属性 [参见](https://www.myquant.cn/docs/subject/scanner_v2_csv_guide.html#orderbiz%20%E5%A7%94%E6%89%98%E4%B8%9A%E5%8A%A1%E7%B1%BB%E5%9E%8B) |
| status                            | number   | 委托状态 [参见](https://www.myquant.cn/docs/python/50.html#h2-orderstatus-)                                                                          |
| ord_rej_reason(rej_reason)        | number   | 委托拒绝原因 [参见](https://www.myquant.cn/docs/python/50.html#h2-orderrejectreason-)                                                                |
| ord_rej_reason_detail(rej_detail) | string   | 委托拒绝原因描述                                                                                                                                     |
| price                             | number   | 委托价格                                                                                                                                             |
| volume                            | number   | 委托量                                                                                                                                               |
| filled_volume(filled_vol)         | number   | 已成量                                                                                                                                               |
| created_at                        | datetime | 委托创建时间                                                                                                                                         |
| updated_at                        | datetime | 委托更新时间                                                                                                                                         |
| sent_at                           | datetime | 委托(终端)发送时间                                                                                                                                   |
| recv_at                           | datetime | 委托(终端)确认(状态变为已报)时间                                                                                                                     |
| filled_vwap(filledvwap)           | number   | 已成交均价                                                                                                                                           |
| filled_amount(filled_amt)         | number   | 已成交金额                                                                                                                                           |

#### 委托执行回报数据

- 文件名称：execution_report.csv
- 刷新方式：文件末尾追加

| 字段名                            | 类型     | 说明                                                                                                                                                 |
| :-------------------------------- | :------- | :--------------------------------------------------------------------------------------------------------------------------------------------------- |
| account_id                        | string   | 掘金交易账号 ID                                                                                                                                      |
| sid                               | string   | 如果该委托时由扫单服务产生的, 对应委托指令的 sid 参数. 如果该委托不是由扫单服务产生的,则为空                                                         |
| scan_name                         | string   | 表明该委托对应的扫单名称                                                                                                                             |
| cl_ord_id                         | string   | 委托客户端 ID                                                                                                                                        |
| order_id                          | string   | 委托柜台 ID                                                                                                                                          |
| exec_id                           | string   | 委托回报 ID                                                                                                                                          |
| symbol                            | string   | 证券代码(市场.代码)如:SZSE.000001                                                                                                                    |
| order_business(order_biz)         | number   | 委托业务属性 [参见](https://www.myquant.cn/docs/subject/scanner_v2_csv_guide.html#orderbiz%20%E5%A7%94%E6%89%98%E4%B8%9A%E5%8A%A1%E7%B1%BB%E5%9E%8B) |
| ord_rej_reason(rej_reason)        | number   | 委托拒绝原因 [参见](https://www.myquant.cn/docs/python/50.html#h2-orderrejectreason-)                                                                |
| ord_rej_reason_detail(rej_detail) | string   | 委托拒绝原因描述                                                                                                                                     |
| exec_type                         | number   | 执行回报类型 [参见](https://www.myquant.cn/docs/python/50.html#h2-exectype-)                                                                         |
| price                             | number   | 委托成交价格                                                                                                                                         |
| volume                            | number   | 委托成交量                                                                                                                                           |
| created_at                        | datetime | 回报创建时间                                                                                                                                         |
| recv_at                           | datetime | 终端接收时间                                                                                                                                         |
| amount                            | number   | 委托成交金额                                                                                                                                         |

#### 委托状态变更流水记录

- 文件名称：order_status_change.csv
- 刷新方式：文件末尾追加

| 字段名                            | 类型     | 说明                                                                                                                                                 |
| :-------------------------------- | :------- | :--------------------------------------------------------------------------------------------------------------------------------------------------- |
| account_id                        | string   | 掘金交易账号 ID                                                                                                                                      |
| sid                               | string   | 如果该委托时由扫单服务产生的, 对应委托指令的 sid 参数. 如果该委托不是由扫单服务产生的,则为空                                                         |
| scan_name                         | string   | 表明该委托对应的扫单名称                                                                                                                             |
| cl_ord_id                         | string   | 委托客户端 ID                                                                                                                                        |
| order_id                          | string   | 委托柜台 ID                                                                                                                                          |
| symbol                            | string   | 证券代码(市场.代码)如:SZSE.000001                                                                                                                    |
| order_type                        | number   | 委托类型 [参见](https://www.myquant.cn/docs/subject/scanner_v2_csv_guide.html#ordertype%20%E5%A7%94%E6%89%98%E7%B1%BB%E5%9E%8B)                      |
| order_business(order_biz)         | number   | 委托业务属性 [参见](https://www.myquant.cn/docs/subject/scanner_v2_csv_guide.html#orderbiz%20%E5%A7%94%E6%89%98%E4%B8%9A%E5%8A%A1%E7%B1%BB%E5%9E%8B) |
| status                            | number   | 委托状态 [参见](https://www.myquant.cn/docs/python/50.html#h2-orderstatus-)                                                                          |
| ord_rej_reason(rej_reason)        | number   | 委托拒绝原因 [参见](https://www.myquant.cn/docs/python/50.html#h2-orderrejectreason-)                                                                |
| ord_rej_reason_detail(rej_detail) | string   | 委托拒绝原因描述                                                                                                                                     |
| price                             | number   | 委托价格                                                                                                                                             |
| volume                            | number   | 委托量                                                                                                                                               |
| filled_volume(filled_vol)         | number   | 已成量                                                                                                                                               |
| created_at                        | datetime | 委托创建时间                                                                                                                                         |
| updated_at                        | datetime | 委托更新时间                                                                                                                                         |
| sent_at                           | datetime | 委托(终端)发送时间                                                                                                                                   |
| recv_at                           | datetime | 委托(终端)确认(状态变为已报)时间                                                                                                                     |
| filled_vwap(filledvwap)           | number   | 已成交均价                                                                                                                                           |
| filled_amount(filled_amt)         | number   | 已成交金额                                                                                                                                           |

#### 功能号执行结果数据

- 文件名称：func_response.csv
- 刷新方式：文件末尾追加

| 字段名     | 类型     | 说明                                             |
| :--------- | :------- | :----------------------------------------------- |
| rid        | string   | 功能号请求 ID，与功能号交易指令中的 rid 参数对应 |
| account_id | string   | 掘金交易账号 ID                                  |
| data       | string   | 功能号扫单结果，**单行** json 字符串             |
| error_code | string   | 错误编码                                         |
| error_info | string   | 错误信息                                         |
| recv_at    | datetime | 终端接收时间                                     |

---

## 3. 文件单示例（Python）

### 策略文件结构

```
.
├── README.md
├── common.py
├── dbf.py
├── requirements.txt
├── scan_by_csv.py
├── scan_by_dbf.py
├── test_spend_time_by_csv.py
└── test_spend_time_by_dbf.py
```

- `README.md` 使用说明
- `common.py` 扫单公共脚本
- `dbf.py` `pip install dbf`下载安装的 dbf 库，修改注释了第`3070`行
- `requirements.txt` Python 示例策略依赖
- `scan_by_csv.py` CSV 扫单示例策略
- `scan_by_dbf.py` DBF 扫单示例策略
- `test_spend_time_by_csv.py` CSV 扫单性能测试
- `test_spend_time_by_dbf.py` DBF 扫单性能测试

### 使用教程

当前示例策略，依赖于 Python 3.6 及以上环境

1. 安装依赖
   ```
   pip install -r requirements.txt -i https://pypi.doubanio.com/simple
   ```
2. 修改参数

   打开`scan_by_csv.py`或`scan_by_dbf.py`文件，修改 `if __name__ == '__main__'`下的参数：

   ```
   # 文件单结果输入路径：登录掘金3终端 -> 手工交易 -> 文件单 -> 文件单输入 -> 新增扫单的扫单路径
   int_path = r''

   # 文件单结果输出路径：登录掘金3终端 -> 手工交易 -> 文件单 -> 文件单输出-> 输出路径
   out_path = r''

   # 仿真/实盘的账户ID
   account_id = ''
   ```

3. 运行扫单脚本

   ```
   python scan_by_csv.py // 或 python scan_by_dbf.py
   ```

### 策略下载

```html
<a
  href="https://gm3-static.oss-cn-shenzhen.aliyuncs.com/scanner2_strategy/scanner2_strategy.zip"
  class="btn btn-danger"
  style="background-color:red;color:#fff;text-decoration:none !important;border:0px !important;"
>
  <i class="fa fa-cloud-download"></i> 下载示例策略
</a>
```

### 注意事项

1. 由于`dbf`文件规范本身字段值长度(254 个字符长度)的限制，`功能号`文件单不适合使用`dbf`文件单进行扫单，建议使用`csv`.
2. `dbf`文件扫单，读写`dbf`文件时，请指定`codepage`参数为`utf8`，以避免出现中文乱码
3. 文件单支持`流式`写入委托信号，可以减少频繁开关文件影响报单性能
4. **示例程序仅供参考，请勿用于实盘交易**

---

## 4. 文件单(旧版)

### 扫单说明

用户可以在不重写原有策略的前提下，把策略生成的委托信号以 SQLite DB 文件作为中转，不需要接口，不限编程语言，不限策略平台，直接接入掘金做仿真和实盘交易。

### 工作流程

![](http://www.myquant.cn/uploads/202008/attach_16270183797c87b6.png)

① 扫单策略将数据写入到 in.db 里面
② 扫单程序按照指定扫描频率扫描 in.db 读取委托信号数据
③ 扫单程序读取到委托信号数据之后，即发起委托请求到仿真/实盘
④ 仿真柜台或实盘柜台处理委托并将结果推送到扫单程序
⑤ 扫单程序按照指定回写频率往 out.db 回写推送回来的委托、持仓、资金等相关数据
⑥ 扫单策略按照一定频率扫描读取 out.db 的数据

扫单策略与掘金扫单程序使用 sqlite 做为数据交换形式。扫单策略对 in.db 读写，对 out.db 只读；掘金扫单程序对 out.db 读写，对 in.db 只读。

### 快速上手

#### 第一步：新建扫单策略

打开掘金终端界面，我们以仿真交易为例演示创建扫单策略的过程。如果您想创建实盘扫单策略，也可以直接点击`实盘扫单`，操作过程基本是是同样的。在这里，我们点击`仿真扫单`。

![](http://www.myquant.cn/uploads/202007/attach_1626cf64e671906f.png)

#### 第二步：设置扫单参数

在弹出的界面选择策略类型为`扫单策略`，设置 扫单路径（扫单数据库文件和策略存放的位置）、扫描频率（扫描 in.db 的时间间隔）和回写频率（持仓、委托、成交、资金等数据回写到 out.db 的时间间隔），选择想要用于交易的资金账户, 填写策略名称，然后点击确认。

![](http://www.myquant.cn/uploads/202007/attach_1626cf4944343a78.png)

#### 第三步：查看策略监控界面

如果您要查看策略的运行情况，点击策略列表中新建的策略，即可进入策略监控界面。

![](http://www.myquant.cn/uploads/202007/attach_1626cf20f110d37f.png)

#### 第四步：编写策略

在策略监控界面点击`右下角`的小齿轮，在弹出界面的上方有策略目录，点击即可快速打开策略目录。

![](http://www.myquant.cn/uploads/202007/attach_1626cf38d7488ada.png)

在弹出的文件管理器界面里面有 6 个文件：

```
- in.db
- out.db
- scanner_roll.log
- 两融交易示例策略.py
- 普通交易示例策略.py
- 说明.pdf
```

其中：

1. in.db 和 out.db：是用来和掘金终端交互的数据库文件。外部策略对 in.db 只写，对 out.db 只读。外部策略写入挂单，撤单等信息到 in.db, 从 out.db 读取账户的资金，持仓，委托，成交等各种信息。

2. 两个示例策略：示例策略提供了简单的委托和撤单操作，以及从数据库读取委托、持仓、资金、成交等数据的简单示例。示例策略可以直接运行起来，但是需要注意的是，示例策略仅供参考，请勿用于实盘交易场景。用户可自行参考以实现自己的策略逻辑。

3. `说明.pdf`: 关于扫单的具体细节以及数据库的各字段的详细含义。

4. scanner_roll.log： 扫单过程中的日志记录

### 扫单性能

#### 测试环境和参数

- 掘金仿真柜台
- 操作系统：Windows 10，64 位，SSD 固态硬盘
- 掘金版本：3.11.9
- 硬件配置：4 核 8G
- 扫描频率：10ms
- 回写频率：10ms

#### 委托场景

1. 场景 1：空库，委托 1000 笔，每次一笔，收到确认后委托下一笔
1. 场景 2：库中已有 5000 笔委托，委托 1000 笔，每次一笔，收到确认后委托下一笔
1. 场景 3：库中已有 10000 笔委托，委托 1000 笔，每次一笔，收到确认后委托下一笔

#### 测试结果

各测试场景下委托耗时，时间单位为`毫秒`.

|   场景 | 最小值 | 中位数 | 平均值 |
| -----: | -----: | -----: | -----: |
| 场景 1 | 16.954 | 28.424 | 47.991 |
| 场景 2 | 20.944 | 37.899 | 57.171 |
| 场景 3 | 26.927 | 46.873 | 60.938 |

#### 测试脚本使用（附代码）

1. 登录扫单版终端
2. 新建一个全新的仿真账户
3. 新建一个扫单策略，扫单路径放在 SSD 固态硬盘
4. 将`test_spend_time.py`放到策略所在同级目录
5. 编辑该脚本，修改 `if __name__ == '__main__':`下的代码，如下：

   ```
   # 下1000笔，每笔委托间隔0秒
   perf_order(place_total=1000, place_interval=0)

   # 批量委托
   # perf_orders(place_total=1000)
   ```

6. 点击终端扫单策略上的`启动`按钮启动扫单程序
7. 在 Python3 下执行如下命令运行脚本报单脚本，测试每个报单过程

   ```
   python test_spend_time.py
   ```

   **附测试脚本**：[test_spend_time.py](https://gm3-static.oss-cn-shenzhen.aliyuncs.com/public-docs/scripts/test_spend_time.py.html)

### 最佳实践

1. 应使用 SSD 存放扫单文件。使用机械硬盘性能会下降一个数量级。
2. 应尽可能用批量方式插入委托到扫单文件，而不是逐笔的方式插入委托。尽可能减少读写库请求次数。
3. 扫单文件中的存量记录增长会影响读写性能，最好每天备份后使用新的扫单文件。
4. 设置合理的扫单频率，扫单频率最低可以设置为 10ms。

### 注意事项

1. 新建扫单策略完成之后，会在策略所在文件夹生成相关数据库文件和 Python3 的示例代码
1. 在 `策略详情` -> 右下角`设置`图标 展开可以看到当前扫单策略文件存放路径
1. 启动扫单之后，扫单程序会扫描 `in.db` 中 `一个小时内` 的委托信号，并对未执行过下单操作的委托发起委托交易请求
1. 扫单策略只能运行于仿真和实盘模式，启停、增删和量化策略一致
1. 新建扫单策略的时候，`扫描频率`和`回写频率`设定之后不可再更改
1. 尽可能将扫单策略放在 SSD 固态硬盘，相比机械硬盘，能得到一个量级以上的性能提升
1. 请勿使用如网络位置的硬盘、WSL（windows 虚拟的 linux 环境）等较为小众环境，在一定情况下会因磁盘读写不稳定造成数据丢失

### 数据库操作流程

#### 扫描 in.db 的完整流程

1. 从 out.db 读取 adim_run_info 表 scan_sorder_id, scan_scancel_order_id 字段, 做为扫描开始的 id

1. 读取 in.db 的 in_place_order 表, 限制参数为 id > scan_sorder_id(步骤 1 读取的值)且 ctime > (当前时间 - preSeconds(默认为 3600s))的订单, 也就是说在当前时间一个小时之前的单不会被扫描到. 把扫描的订单集合做为一个整体下单. 注意: 这里不管下单是否成功. 完成下单会更新 out.db 的 admin_order_map 表, 记录外部策略的订单与掘金系统的订单之前的关系, 其中 ctime 记录读取时间, send_time 记录发送给终端服务的时间

1. 读取 in.db 的 in_cancel_order 表, 限制参数为 id > scan_scancel_order_id(步骤 1 读取的值)且 ctime > (当前时间 - preSeconds(默认为 3600s))的订单,
   也就是说在当前时间一个小时之前的单不会被扫描到. 把扫描的订单一条条的执行撤单操作. 注意: 这里不管撤单是否成功

1. 更新 admin_run_info 表的 scan_sorder_id, scan_scancel_order_id 字段值

1. 如果 b,c 阶段有订单被执行, 则立即转入步骤 b 操作. 反之,则扫单程序暂停扫单频率设置的时间, 然后继续执行步骤 b

#### out.db 写入的完整流程

扫单程序接收终端服务推送过来的资金、持仓、委托流水、成交流水、账户状态变化等数据信息, 然后以指定的`回写频率`以队列的形式先后写入 out.db

### in.db 数据库说明

in.db 是用户的策略写入下单/撤单信息的数据库, 这个库由用户策略负责写入, 扫单程序只是读取

###### in_place_order 表

下单表, 用户策略对这个表只能是增加记录,写就是只能 insert, 不能 update 跟 delete

| 字段名          | 类型     | 说明                                                                                                                                                         |
| :-------------- | :------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------- |
| id              | int      | 自增,主键 (用户策略不需要提供这个值)                                                                                                                         |
| sid             | text     | 用户自行维护的下单表示，唯一索引，不能重复                                                                                                                   |
| account_id      | text     | 账号 id。默认为空，表示使用默认的账号来下单，否则使用指定的 account_id 账号下单                                                                              |
| symbol          | text     | 证券代码(市场.代码)如:SZSE.000001                                                                                                                            |
| volume          | int      | 委托量                                                                                                                                                       |
| price           | float64  | 委托价格                                                                                                                                                     |
| side            | int      | 买卖方向 [参见](https://www.myquant.cn/docs/python/python_enum_constant.html#h2-orderside-)                                                                  |
| position_effect | int      | 开平标志 [参见](https://www.myquant.cn/docs/python/python_enum_constant.html#h2-positioneffect-)                                                             |
| position_src    | int      | 头寸来源： 0，unknown；1，普通券；2，专项券                                                                                                                  |
| order_type      | int      | 委托类型 [参见](https://www.myquant.cn/docs/python/python_enum_constant.html#h2-ordertype-)                                                                  |
| order_duration  | int      | 委托时间属性 [参见](https://www.myquant.cn/docs/python/python_enum_constant.html#h2-orderduration-)                                                          |
| order_qualifier | int      | 委托成交属性 [参见](https://www.myquant.cn/docs/python/python_enum_constant.html#h2-orderqualifier-)                                                         |
| order_business  | int      | 委托业务属性 [参见](https://www.myquant.cn/docs/python/python_enum_constant.html#OrderBusiness%20-%20%E5%A7%94%E6%89%98%E4%B8%9A%E5%8A%A1%E5%B1%9E%E6%80%A7) |
| ctime           | datetime | 创建时间.utc 时间 (用户策略不需要提供这个值)                                                                                                                 |

###### in_cancel_order 表

撤单表, 外部策略对这个表只能是增加记录,写就是只能 insert, 不能 update 跟 delete

| 字段名 | 类型     | 说明                                         |
| :----- | :------- | :------------------------------------------- |
| id     | int      | 自增,主键 (外部策略不需要提供这个值)         |
| sid    | text     | 用户策略维护的 orderId                       |
| ctime  | datetime | 创建时间.utc 时间 (外部策略不需要提供这个值) |

####### in_raw_func 表

功能号数据表，外部策略对这个表只能是增加记录,写就是只能 insert, 不能执行 update 和 delete 操作。

| 字段名     | 类型     | 说明                                                                                                              |
| :--------- | :------- | :---------------------------------------------------------------------------------------------------------------- |
| id         | int      | 自增,主键，系统生成。 (外部策略不需要提供这个值)                                                                  |
| rid        | text     | request id，即请求 ID，用于与返回结果(位于 out_raw_func 表)数据进行关联。用户需要维护的功能码请求标识。每个值唯一 |
| account_id | text     | 资金账户 id                                                                                                       |
| func_id    | text     | 功能号 ID                                                                                                         |
| func_args  | longtext | 功能号参数 json 字符串，形如`{"param1": "value1", "param2"："value2"}`                                            |
| ctime      | datetime | 创建时间.utc 时间，系统生成。(外部策略不需要提供这个值)                                                           |

### out.db 数据库说明

out.db 是扫单程序把从掘金系统返回的资金/成本回报/持仓等流水信息写入, 用户策略负责读取

###### admin_order_map 表

维护用户的 orderId 与掘金系统的 clOrdId 的关系.

| 字段名    | 类型     | 说明                                                                                 |
| :-------- | :------- | :----------------------------------------------------------------------------------- |
| id        | int      | 自增,主键                                                                            |
| sid       | text     | 用户策略维护的 orderId                                                               |
| cl_ord_id | text     | 掘金系统维护的 orderId                                                               |
| ctime     | datetime | 创建时间. utc 时间(也是读取 in.db 里 in_place_order 表 记录的时间)                   |
| send_time | datetime | 发送 in.db 里 in_place_order 表下单记录及 in_cancel_order 表撤单记录的时间. utc 时间 |

###### admin_run_info 表

扫描程序运行时信息表

| 字段名                | 类型 | 说明                                        |
| :-------------------- | :--- | :------------------------------------------ |
| id                    | int  | 自增,主键                                   |
| scan_sorder_id        | int  | 对 in.db 的 sorder 表扫描的最大 id          |
| scan_scancel_order_id | int  | 对 in.db 的 scancel_order 表扫描的最大 id   |
| scan_sraw_func_id     | int  | 对 in.db 的 sraw_func 表上次扫描的最大的 id |

###### out_account_status 表

资金帐号状态变化流水表

| 字段名       | 类型     | 说明                                                                 |
| :----------- | :------- | :------------------------------------------------------------------- |
| id           | int      | 自增,主键                                                            |
| octime       | datetime | 记录入库时间                                                         |
| account_id   | text     | 账号 ID                                                              |
| account_name | text     | 账户登录名                                                           |
| status       | int      | [参见](https://www.myquant.cn/docs/python/50.html#h2-accountstatus-) |

###### out_cash 表

资金表, 记录当前策略关联帐号的资金信息

| 字段名          | 类型     | 说明                                                                                         |
| :-------------- | :------- | :------------------------------------------------------------------------------------------- |
| id              | int      | 自增,主键                                                                                    |
| octime          | datetime | 记录入库时间.utc 时间                                                                        |
| account_id      | text     | 账号 ID                                                                                      |
| account_name    | text     | 账户登录名                                                                                   |
| currency        | int      | 币种                                                                                         |
| market_value    | real     | 市值                                                                                         |
| nav             | real     | 净值(cum_inout + cum_pnl + fpnl - cum_commission)                                            |
| pnl             | real     | 净收益(nav-cum_inout)                                                                        |
| fpnl            | real     | 浮动盈亏(sum(each position fpnl))                                                            |
| frozen          | real     | 持仓占用资金                                                                                 |
| order_frozen    | real     | 挂单冻结资金                                                                                 |
| available       | real     | 可用资金                                                                                     |
| balance         | real     | 资金余额                                                                                     |
| cum_inout       | real     | 累计出入金                                                                                   |
| cum_trade       | real     | 累计交易额                                                                                   |
| cum_pnl         | real     | 累计平仓收益(没扣除手续费)                                                                   |
| cum_commission  | real     | 累计手续费                                                                                   |
| last_trade      | real     | 上一次交易额                                                                                 |
| last_pnl        | real     | 上一次收益                                                                                   |
| last_commission | real     | 上一次手续费                                                                                 |
| last_inout      | real     | 上一次出入金                                                                                 |
| change_reason   | int      | 资金变更原因 [参见](https://www.myquant.cn/docs/python/50.html#h2-cashpositionchangereason-) |
| change_event_id | text     | 触发资金变更事件的 ID                                                                        |
| created_at      | datetime | 资金初始时间                                                                                 |
| update_at       | datetime | 资金变更时间                                                                                 |

###### out_execrpt 表

执行回报 变化流水表

| 字段名                | 类型     | 说明                                                                                                                                                         |
| :-------------------- | :------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------- |
| id                    | int      | 自增,主键                                                                                                                                                    |
| octime                | datetime | 记录入库时间.utc 时间                                                                                                                                        |
| strategy_id           | text     | 策略 ID                                                                                                                                                      |
| account_id            | text     | 账号 ID                                                                                                                                                      |
| account_name          | text     | 账户登录名                                                                                                                                                   |
| sid                   | text     | 用户策略维护的 orderId                                                                                                                                       |
| cl_ord_id             | text     | 委托客户端 ID                                                                                                                                                |
| order_id              | text     | 委托柜台 ID                                                                                                                                                  |
| exec_id               | text     | 委托回报 ID                                                                                                                                                  |
| symbol                | text     | 证券代码(市场.代码)如:SZSE.000001                                                                                                                            |
| order_business        | int      | 委托业务属性 [参见](https://www.myquant.cn/docs/python/python_enum_constant.html#OrderBusiness%20-%20%E5%A7%94%E6%89%98%E4%B8%9A%E5%8A%A1%E5%B1%9E%E6%80%A7) |
| position_effect       | int      | 开平标志 [参见](https://www.myquant.cn/docs/python/50.html#h2-positioneffect-)                                                                               |
| side                  | int      | 买卖方向 [参见](https://www.myquant.cn/docs/python/50.html#h2-orderside-)                                                                                    |
| ord_rej_reason        | int      | 委托拒绝原因 [参见](https://www.myquant.cn/docs/python/50.html#h2-orderrejectreason-)                                                                        |
| ord_rej_reason_detail | text     | 委托拒绝原因描述                                                                                                                                             |
| exec_type             | int      | 执行回报类型 [参见](https://www.myquant.cn/docs/python/50.html#h2-exectype-)                                                                                 |
| price                 | real     | 委托成交价格                                                                                                                                                 |
| volume                | int      | 委托成交量                                                                                                                                                   |
| amount                | real     | 委托成交金额                                                                                                                                                 |
| commission            | real     | 委托成交手续费                                                                                                                                               |
| cost                  | real     | 委托成交成本金额                                                                                                                                             |
| created_at            | datetime | 回报创建时间                                                                                                                                                 |

###### out_order 表

order 状态变化流水表

| 字段名                | 类型     | 说明                                                                                                                                                         |
| :-------------------- | :------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------- |
| id                    | int      | 自增,主键                                                                                                                                                    |
| octime                | datetime | 记录入库时间.utc 时间                                                                                                                                        |
| sid                   | text     | 用户策略维护的 orderId                                                                                                                                       |
| strategy_id           | text     | 策略 ID                                                                                                                                                      |
| account_id            | text     | 账号 ID                                                                                                                                                      |
| algo_order_id         | text     | 算法单 ID                                                                                                                                                    |
| account_name          | text     | 账户登录名                                                                                                                                                   |
| cl_ord_id             | text     | 委托客户端 ID                                                                                                                                                |
| order_id              | text     | 委托柜台 ID                                                                                                                                                  |
| ex_ord_id             | text     | 委托交易所 ID                                                                                                                                                |
| symbol                | text     | 证券代码(市场.代码)如:SZSE.000001                                                                                                                            |
| side                  | int      | 买卖方向 [参见](https://www.myquant.cn/docs/python/50.html#h2-orderside-)                                                                                    |
| position_effect       | int      | 开平标志 [参见](https://www.myquant.cn/docs/python/50.html#h2-positioneffect-)                                                                               |
| position_side         | int      | 持仓方向 [参见](https://www.myquant.cn/docs/python/50.html#h2-positionside-)                                                                                 |
| position_src          | int      | 头寸来源： 0，unknown；1，普通券；2，专项券                                                                                                                  |
| order_type            | int      | 委托类型 [参见](https://www.myquant.cn/docs/python/50.html#h2-ordertype-)                                                                                    |
| order_duration        | int      | 委托时间属性 [参见](https://www.myquant.cn/docs/python/50.html#h2-orderduration-)                                                                            |
| order_qualifier       | int      | 委托成交属性 [参见](https://www.myquant.cn/docs/python/50.html#h2-orderqualifier-)                                                                           |
| order_business        | int      | 委托业务属性 [参见](https://www.myquant.cn/docs/python/python_enum_constant.html#OrderBusiness%20-%20%E5%A7%94%E6%89%98%E4%B8%9A%E5%8A%A1%E5%B1%9E%E6%80%A7) |
| order_src             | int      | 委托来源 [参见](https://www.myquant.cn/docs/python/50.html#h2-ordersrc-)                                                                                     |
| status                | int      | 委托状态 [参见](https://www.myquant.cn/docs/python/50.html#h2-orderstatus-)                                                                                  |
| ord_rej_reason        | int      | 委托拒绝原因 [参见](https://www.myquant.cn/docs/python/50.html#h2-orderrejectreason-)                                                                        |
| ord_rej_reason_detail | text     | 委托拒绝原因描述                                                                                                                                             |
| price                 | real     | 委托价格                                                                                                                                                     |
| stop_price            | real     | 委托止损/止盈触发价格                                                                                                                                        |
| order_style           | int      | 委托风格 [参见](https://www.myquant.cn/docs/python/50.html#h2-orderstyle-)                                                                                   |
| volume                | real     | 委托量                                                                                                                                                       |
| value                 | real     | 委托额                                                                                                                                                       |
| percent               | real     | 委托百分比                                                                                                                                                   |
| target_volume         | int      | 委托目标量                                                                                                                                                   |
| target_value          | real     | 委托目标额                                                                                                                                                   |
| target_percent        | real     | 委托目标百分比                                                                                                                                               |
| filled_volume         | int      | 已成量                                                                                                                                                       |
| filled_vwap           | real     | 已成均价                                                                                                                                                     |
| filled_amount         | real     | 已成金额                                                                                                                                                     |
| filled_commission     | real     | 已成手续费                                                                                                                                                   |
| created_at            | datetime | 委托创建时间                                                                                                                                                 |
| updated_at            | datetime | 委托更新时间                                                                                                                                                 |

###### out_position 表

持仓表, 记录当前策略的持仓信息. 其中 `account_id`, `symbol`, `side` 联合做为主键

| 字段名             | 类型     | 说明                                                                                         |
| :----------------- | :------- | :------------------------------------------------------------------------------------------- |
| id                 | int      | 自增,主键                                                                                    |
| octime             | datetime | 记录入库时间. utc 时间                                                                       |
| account_id         | text     | 账号 ID                                                                                      |
| account_name       | text     | 账户登录名                                                                                   |
| symbol             | text     | 证券代码(市场.代码)如:SZSE.000001                                                            |
| side               | int      | 持仓方向 [参见](https://www.myquant.cn/docs/python/50.html#h2-positionside-)                 |
| volume             | real     | 总持仓量; 昨持仓量(volume-volume_today)                                                      |
| volume_today       | real     | 今日持仓量                                                                                   |
| vwap               | real     | 持仓均价                                                                                     |
| vwap_diluted       | real     | 摊薄持仓均价                                                                                 |
| amount             | real     | 持仓额(volume\*vwap\*multiplier)                                                             |
| market_value       | real     | 持仓市值                                                                                     |
| price              | real     | 当前行情价格                                                                                 |
| fpnl               | real     | 持仓浮动盈亏((price-vwap)\*volume\*multiplier)                                               |
| cost               | real     | 持仓成本(vwap\*volume\*multiplier\*margin_ratio)                                             |
| order_frozen       | int      | 挂单冻结仓位                                                                                 |
| order_frozen_today | int      | 挂单冻结今仓仓位                                                                             |
| available          | int      | 可平总仓位(volume-order_frozen); 可平昨仓位(available-available_today)                       |
| available_today    | int      | 可平今仓位(volume_today-order_frozen_today)                                                  |
| available_now      | int      | 当前可平仓位(根据标的的 T+N 属性计算)                                                        |
| last_price         | real     | 上一次成交价                                                                                 |
| last_volume        | int      | 上一次成交量                                                                                 |
| last_inout         | int      | 上一次出入持仓量                                                                             |
| change_reason      | int      | 仓位变更原因 [参见](https://www.myquant.cn/docs/python/50.html#h2-cashpositionchangereason-) |
| change_event_id    | text     | 触发资金变更事件的 ID                                                                        |
| has_dividend       | int      | 是否除权除息                                                                                 |
| created_at         | datetime | 建仓时间                                                                                     |
| update_at          | datetime | 仓位变更时间                                                                                 |

###### out_raw_func 表

功能号扫单结果数据表

| 字段名       | 类型     | 说明                                      |
| :----------- | :------- | :---------------------------------------- |
| id           | int      | 自增,主键                                 |
| rid          | text     | 请求 ID，与`in_raw_func`表中的`rid`对应。 |
| account_id   | text     | 资金账户 ID                               |
| account_name | text     | 资金账户名                                |
| data         | longtext | 功能号扫单结果，json 字符串               |
| error_code   | text     | 错误编码                                  |
| error_info   | text     | 错误信息                                  |
| octime       | datetime | 创建时间                                  |
