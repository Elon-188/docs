# API 介绍

## 1. 基本函数

### init - 初始化策略

初始化策略, 策略启动时自动执行。可以在这里初始化策略配置参数。

**函数原型:**

```
init(context)
```

**参数：**

| 参数名  | 类型                                                                     | 说明                         |
| :------ | :----------------------------------------------------------------------- | :--------------------------- |
| context | [context](python_concept.md#context - 上下文对象 "Context - 上下文对象") | 上下文，全局变量可存储在这里 |

**示例：**

```python
def init(context):
    # 订阅bar
    subscribe(symbols='SHSE.600000,SHSE.600004', frequency='30s', count=5, wait_group=True, wait_group_timeout='5s')
	# 增加对象属性，如:设置一个股票资金占用百分比
	context.percentage_stock = 0.8
```

**注意：**
`回测模式下init函数里不支持交易操作，仿真模式和实盘模式支持`

### schedule - 定时任务配置

在指定时间自动执行策略算法, 通常用于选股类型策略

**函数原型:**

```
schedule(schedule_func, date_rule, time_rule)
```

**参数：**

| 参数名        | 类型     | 说明                                           |
| :------------ | :------- | :--------------------------------------------- |
| schedule_func | function | 策略定时执行算法                               |
| date_rule     | str      | n + 时间单位， 可选'd/w/m' 表示 n 天/n 周/n 月 |
| time_rule     | str      | 执行算法的具体时间 (%H:%M:%S 格式)             |

**返回值:**

`None`

**示例：**

```python
def init(context):
    #每天的19:06:20执行策略algo_1
    schedule(schedule_func=algo_1, date_rule='1d', time_rule='19:06:20')
	#每月的第一个交易日的09:40:00执行策略algo_2
	schedule(schedule_func=algo_2, date_rule='1m', time_rule='9:40:00')

def algo_1(context):
    print(context.symbols)

def algo_2(context):
    order_volume(symbol='SHSE.600000', volume=200, side=OrderSide_Buy, order_type=OrderType_Market, position_effect=PositionEffect_Open)




```

**注意：**

1.time_rule 的时,分,秒均不可以只输入个位数，例:`'9:40:0'`或`'14:5:0'`

2.目前暂时支持`1d`、`1w`、`1m`，其中`1w`、`1m`仅用于回测

### run - 运行策略

**函数原型:**

```python
run(strategy_id='', filename='', mode=MODE_UNKNOWN, token='', backtest_start_time='',
    backtest_end_time='', backtest_initial_cash=1000000,
    backtest_transaction_ratio=1, backtest_commission_ratio=0,
    backtest_slippage_ratio=0, backtest_adjust=ADJUST_NONE, backtest_check_cache=1,
    serv_addr='', backtest_match_mode=0)
```

**参数：**

| 参数名                     | 类型   | 说明                                                                                                                                              |
| :------------------------- | :----- | :------------------------------------------------------------------------------------------------------------------------------------------------ |
| strategy_id                | str    | 策略 id                                                                                                                                           |
| filename                   | str    | 策略文件名称                                                                                                                                      |
| mode                       | int    | 策略模式<br />MODE_LIVE(实时)=1<br />MODE_BACKTEST(回测) =2                                                                                       |
| token                      | str    | 用户标识                                                                                                                                          |
| backtest_start_time        | str    | 回测开始时间<br />(%Y-%m-%d %H:%M:%S 格式)                                                                                                        |
| backtest_end_time          | str    | 回测结束时间<br />(%Y-%m-%d %H:%M:%S 格式)                                                                                                        |
| backtest_initial_cash      | double | 回测初始资金, 默认 1000000                                                                                                                        |
| backtest_transaction_ratio | double | 回测成交比例, 默认 1.0, 即下单 100%成交                                                                                                           |
| backtest_commission_ratio  | double | 回测佣金比例, 默认 0                                                                                                                              |
| backtest_slippage_ratio    | double | 回测滑点比例, 默认 0                                                                                                                              |
| backtest_adjust            | int    | 回测复权方式(默认不复权)<br />ADJUST_NONE(不复权)=0<br />ADJUST_PREV(前复权)=1<br />ADJUST_POST(后复权)=2<br />                                   |
| backtest_check_cache       | int    | 回测是否使用缓存：1 - 使用， 0 - 不使用；默认使用                                                                                                 |
| serv_addr                  | str    | 终端服务地址, 默认本地地址, 可不填，若需指定应输入 ip+端口号，如"127.0.0.1:7001"                                                                  |
| backtest_match_mode        | int    | 回测市价撮合模式： 1-实时撮合：在当前 bar 的收盘价/当前 tick 的 price 撮合，0-延时撮合：在下个 bar 的开盘价/下个 tick 的 price 撮合，默认是模式 0 |

**返回值:**

`None`

**示例：**

```python
run(strategy_id='strategy_1', filename='main.py', mode=MODE_BACKTEST, token='token_id',
    backtest_start_time='2016-06-17 13:00:00', backtest_end_time='2017-08-21 15:00:00')
```

**注意：**
**1.**run 函数中，`mode=1`也可改为`mode=MODE_LIVE`，两者等价，`backtest_adjust`同理

**2.**backtest_start_time 和 backtest_end_time 中月,日,时,分,秒均可以只输入个位数，例:`'2016-6-7 9:55:0'`或`'2017-8-1 14:6:0'`,但若对应位置为零，则 0 不可被省略,比如不能输入`"2017-8-1 14:6: "`

**3.** filename 指运行的 py 文件名字，如该策略文件名为 Strategy.py,则此处应填"Strategy.py"

### stop - 停止策略

停止策略，退出策略进程

**函数原型:**

```
stop()
```

**返回值:**

`None`

**示例：**

```python
#若订阅过的代码集合为空，停止策略
if not context.symbols:
   stop()
```

---

## 2. 数据订阅

### subscribe - 行情订阅

订阅行情, 可以指定 symbol, 数据滑窗大小, 以及是否需要等待全部代码的数据到齐再触发事件。

**函数原型:**

```
subscribe(symbols, frequency='1d', count=1, unsubscribe_previous=False)
```

**参数：**

| 参数名               | 类型        | 说明                                                                                                                                                                                                                                                                                  |
| :------------------- | :---------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| symbols              | str or list | 订阅[标的代码](python_concept.md/#symbol '标的代码'), 支持字串格式，如有多个代码, 中间用 `,` (英文逗号) 隔开, 也支持 `['symbol1', 'symbol2']` 这种列表格式                                                                                                                            |
| frequency            | str         | 频率, 支持 'tick', '60s', '300s', '900s' 等, 默认'1d', 详情见[股票行情数据](https://www.myquant.cn/docs/l3333/912.html.html)和[期货行情数据](https://www.myquant.cn/docs/l3333/919.html.html), [实时行情支持的频率](https://www.myquant.cn/docs/l3333/912.html.html#ea60e306f3db9d6c) |
| count                | int         | 订阅数据滑窗大小, 默认`1` ,详情见[数据滑窗](python_concept.md#context.data - 数据滑窗 "context.data - 数据滑窗")                                                                                                                                                                      |
| unsubscribe_previous | bool        | 是否取消过去订阅的 symbols, 默认`False`不取消, 输入`True`则取消所有原来的订阅。                                                                                                                                                                                                       |

**返回值:**

`None`

**示例：**

```python
subscribe(symbols='SHSE.600000,SHSE.600004', frequency='60s', count=5, unsubscribe_previous=True)
```

**注意：**

1. subscribe 支持多次调用，并可以重复订阅同一代码。订阅后的数据储存在本地，需要通过 context.data 接口调用或是直接在 on_tick 或 on_bar 中获取。

2. 在实时模式下，最新返回的数据是**不复权**的。

### unsubscribe - 取消订阅

取消行情订阅, 默认取消所有已订阅行情

**函数原型:**

```
unsubscribe(symbols='*', frequency='60s')
```

**参数：**

| 参数名    | 类型        | 说明                                                                                                                                                                                                                                                                                  |
| :-------- | :---------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| symbols   | str or list | [标的代码](python_concept.md/#symbol '标的代码'), 支持字串格式，如果有多个代码, 中间用 `,` (英文逗号) 隔开；`* `表示所有, 默认退订所有代码 <br /> 也支持 `['symbol1', 'symbol2']` 这种列表格式的参数                                                                                  |
| frequency | str         | 频率, 支持 'tick', '60s', '300s', '900s' 等, 默认'1d', 详情见[股票行情数据](https://www.myquant.cn/docs/l3333/912.html.html)和[期货行情数据](https://www.myquant.cn/docs/l3333/919.html.html), [实时行情支持的频率](https://www.myquant.cn/docs/l3333/912.html.html#ea60e306f3db9d6c) |

**返回值:**

`None`

**示例：**

```python
unsubscribe(symbols='SHSE.600000,SHSE.600004', frequency='60s')
```

**注意：**
如示例所示代码，取消`SHSE.600000,SHSE.600004`两只代码`60s`行情的订阅，若`SHSE.600000`同时还订阅了`"300s"`频度的行情，该代码不会取消该标的此频度的订阅

---

## 3. 数据事件

**数据事件是阻塞回调事件函数，通过 subscribe 函数订阅， 主动推送**

### on_tick - tick 数据推送事件

接收 tick 分笔数据， 通过 subscribe 订阅 tick 行情，行情服务主动推送 tick 数据

**函数原型:**

```
on_tick(context, tick)
```

**参数：**

| 参数名  | 类型                                                                          | 说明              |
| :------ | :---------------------------------------------------------------------------- | :---------------- |
| context | [context 对象](python_concept.md#context - 上下文对象 "context---上下文对象") | 上下文            |
| tick    | [tick 对象](python_object_data.md/#Tick - Tick 对象 "Tick---Tick 对象")       | 当前被推送的 tick |

**示例：**

```python
def on_tick(context, tick):
    print(tick)
```

**输出：**

```
{'symbol': 'SHSE.600519', 'created_at': datetime.datetime(2020, 9, 2, 14, 7, 23, 620000, tzinfo=tzfile('PRC')), 'price': 1798.8800048828125, 'open': 1825.0, 'high': 1828.0, 'low': 1770.0, 'cum_volume': 2651191, 'cum_amount': 4760586491.0, 'cum_position': 0, 'last_amount': 179888.0, 'last_volume': 100, 'trade_type': 0, 'receive_local_time': 1602751345.262745}
```

### on_bar - bar 数据推送事件

接收固定周期 bar 数据， 通过 subscribe 订阅 bar 行情，行情服务主动推送 bar 数据

**函数原型:**

```
on_bar(context, bars)
```

**参数：**

| 参数名  | 类型                                                                          | 说明                  |
| :------ | :---------------------------------------------------------------------------- | :-------------------- |
| context | [context 对象](python_concept.md#context - 上下文对象 "context---上下文对象") | 上下文对象            |
| bars    | list([bar](python_object_data.md/#Bar - Bar 对象 "Bar - Bar 对象"))           | 当前被推送的 bar 列表 |

**示例：**

```python
def on_bar(context, bars):
    for bar in bars:
        print(bar)
```

**输出：**

```
{'symbol': 'SHSE.600519', 'eob': datetime.datetime(2020, 9, 30, 15, 15, 1, tzinfo=tzfile('PRC')), 'bob': datetime.datetime(2020, 9, 30, 0, 0, tzinfo=tzfile('PRC')), 'open': 1660.0, 'close': 1668.5, 'high': 1691.9000244140625, 'low': 1660.0, 'volume': 2708781, 'amount': 4536012540.0, 'pre_close': 1652.2999267578125, 'position': 0, 'frequency': '1d', 'receive_local_time': 1602751647.923199}
```

**注意：**

**1.**若在 subscribe 函数中订阅了多个标的的 bar，但[wait_group](python_subscribe.md 'wait_group')参数值为 False,则多次触发 On_bar,每次返回只包含单个标的 list 长度为 1 的 bars;若参数值为 True,则只会触发一次 On_bar,返回包含多个标的的 bars。

**2.**bar 在本周期结束时间后才会推送，标的在这个周期内无交易则不推送 bar。

### on_l2transaction - 逐笔成交事件

接收逐笔成交数据（L2 行情时有效）
仅特定券商版本可用
**函数原型:**

```python
on_l2transaction(context, transaction)
```

**参数：**

| 参数名      | 类型                                                                                              | 说明               |
| :---------- | :------------------------------------------------------------------------------------------------ | :----------------- |
| context     | [context 对象](python_concept.md#context - 上下文对象 "context---上下文对象")                     | 上下文对象         |
| transaction | [L2Transaction 对象](https://www.myquant.cn/docs/python/python_object_data.html#a90085acbae9eb26) | 收到的逐笔成交行情 |

**示例：**

```python
def on_l2transaction(context, transaction):
    print(transaction)
```

**输出：**

```
{'symbol': 'SZSE.300003', 'volume': 300, 'created_at': datetime.datetime(2020, 11, 24, 9, 38, 16, 50, tzinfo=tzfile('PRC')), 'exec_type': '4', 'side': '', 'price': 0.0}

```

### on_l2order - 逐笔委托事件

接收逐笔委托数据（深交所 L2 行情时有效）
仅特定券商版本可用
**函数原型:**

```python
on_l2order(context, l2order)
```

**参数：**

| 参数名  | 类型                                                                                        | 说明               |
| :------ | :------------------------------------------------------------------------------------------ | :----------------- |
| context | [context 对象](python_concept.md#context - 上下文对象 "context---上下文对象")               | 上下文对象         |
| l2order | [L2Order 对象](https://www.myquant.cn/docs/python/python_object_data.html#00bf69bbd318a4b4) | 收到的逐笔委托行情 |

**示例：**

```python
def on_l2order(context, l2order):
    print(l2order)
```

**输出：**

```
{'symbol': 'SZSE.300003', 'side': '1', 'price': 29.350000381469727, 'volume': 2400, 'created_at': datetime.datetime(2020, 11, 24, 9, 38, 16, 80, tzinfo=tzfile('PRC')), 'order_type': '2'}

```

### on_l2order_queue - 委托队列事件

接收委托队列, L2 行情时有效，最优价最大 50 笔委托量
仅特定券商版本可用

**函数原型:**

```python
on_l2order_queue(context, l2order_queue)
```

**参数：**

| 参数名        | 类型                                                                                             | 说明               |
| :------------ | :----------------------------------------------------------------------------------------------- | :----------------- |
| context       | [context 对象](python_concept.md#context - 上下文对象 "context---上下文对象")                    | 上下文对象         |
| l2order_queue | [L2OrderQueue 对象](https://www.myquant.cn/docs/python/python_object_data.html#d4749d8d6bc15b5d) | 收到的委托队列行情 |

```python
def on_l2order_queue(context, l2order_queue):
    print(l2order_queue)
```

**输出：**

```
{'symbol': 'SHSE.600000', 'price': 9.90999984741211, 'total_orders': 155, 'queue_orders': 50, 'queue_volumes': [52452, 600, 1200, 3200, 10000, 1800, 1000, 300, 10000, 2000, 500, 500, 2000, 1000, 2000, 300, 1200, 1400, 1000, 200, 1000, 100, 500, 1000, 500, 2380
0, 25400, 1000, 2000, 200, 500, 1200, 5000, 2000, 17600, 5000, 1000, 1300, 1000, 1200, 1000, 3000, 1000, 1000, 15000, 400, 15000, 5000, 2000, 10000], 'created_at': datetime.datetime(2020, 11, 23, 14, 0, 1, tzinfo=tzfile('PRC')), 'side': '', 'volume': 0}

```

---

## 4. 数据查询函数

### current - 查询当前行情快照

查询当前行情快照，返回 tick 数据。实时模式，返回当前最新 tick 数据，回测模式，返回回测当前时间点的最近一分钟的收盘价

**函数原型:**

```python
current(symbols, fields='')
```

**参数：**

| 参数名  | 类型        | 说明                                                                                                                                                          |
| :------ | :---------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| symbols | str or list | 查询代码，如有多个代码, 中间用 `,` (英文逗号) 隔开, <br />也支持 `['symbol1', 'symbol2']` 这种列表格式 ，使用参考[symbol](python_concept.md#164243e2ef567f4d) |
| fields  | str         | 查询字段, 默认所有字段<br />具体字段见:[Tick](python_object_data.md#Tick - Tick 对象)                                                                         |

**返回值:**
`list[dict]`

**示例：**

```python
current_data = current(symbols='SZSE.000001')
```

**输出：**

```python
[{'symbol': 'SZSE.000001', 'open': 16.200000762939453, 'high': 16.920000076293945, 'low': 16.149999618530273, 'price': 16.559999465942383, 'quotes': [{'bid_p': 16.549999237060547, 'bid_v': 209200, 'ask_p': 16.559999465942383, 'ask_v': 296455}, {'bid_p': 16.540000915527344, 'bid_v': 188900, 'ask_p': 16.56999969482422, 'ask_v': 374405}, {'bid_p': 16.530000686645508, 'bid_v': 44900, 'ask_p': 16.579999923706055, 'ask_v': 187220}, {'bid_p': 16.520000457763672, 'bid_v': 20800, 'ask_p': 16.59000015258789, 'ask_v': 102622}, {'bid_p': 16.510000228881836, 'bid_v': 37700, 'ask_p': 16.600000381469727, 'ask_v': 337002}], 'cum_volume': 160006232, 'cum_amount': 2654379585.66, 'last_amount': 14153832.0, 'last_volume': 854700, 'trade_type': 7, 'created_at': datetime.datetime(2020, 10, 15, 15, 0, 3, tzinfo=tzfile('PRC'))}]
```

**注意：**

**1.** 若输入包含无效标的代码，则返回的列表只包含有效标的代码对应的`dict`

**2.** 若输入代码正确，但查询字段中包括错误字段，返回的列表仍包含对应数量的`dict`，但每个`dict`中除有效字段外，其他字段的值均为`空字符串/0`

**3.** 回测只返回 symbol、price 和 created_at 字段，实时模式返回全部字段

**4.** 实时模式无法获取集合竞价的数据，可使用 history_n

### history - 查询历史行情

**函数原型:**

```python
history(symbol, frequency, start_time, end_time, fields=None, skip_suspended=True,
        fill_missing=None, adjust=ADJUST_NONE, adjust_end_time='', df=True)
```

**参数：**

| 参数名          | 类型                     | 说明                                                                                                                                                                                                                                                     |
| :-------------- | :----------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| symbol          | str or list              | 标的代码, 如有多个代码, 中间用 `,` (英文逗号) 隔开, <br />也支持 `['symbol1', 'symbol2']` 这种列表格式 ，使用参考[symbol](python_concept.md#164243e2ef567f4d)                                                                                            |
| frequency       | str                      | 频率, 支持 'tick', '1d', '60s' 等, 默认 '1d', 详情见[股票行情数据](https://www.myquant.cn/docs/l3333/912.html.html.html)和[期货行情数据](https://www.myquant.cn/docs/l3333/919.html.html.html)                                                           |
| start_time      | str or datetime.datetime | 开始时间 (%Y-%m-%d %H:%M:%S 格式), 也支持 datetime.datetime 格式                                                                                                                                                                                         |
| end_time        | str or datetime.datetime | 结束时间 (%Y-%m-%d %H:%M:%S 格式), 也支持 datetime.datetime 格式                                                                                                                                                                                         |
| fields          | str                      | 指定返回对象字段, 如有多个字段, 中间用, 隔开, 默认所有,<br />具体字段见:[股票字段](https://www.myquant.cn/docs/python/python_object_data.html#29852bf1b0fd29bb) ,[期货字段](https://www.myquant.cn/docs/python/python_object_data.html#29852bf1b0fd29bb) |
| skip_suspended  | bool                     | 是否跳过停牌, 默认跳过                                                                                                                                                                                                                                   |
| fill_missing    | str or None              | 填充方式, `None` - 不填充, `'NaN'` - 用空值填充, `'Last'` - 用上一个值填充, 默认 None                                                                                                                                                                    |
| adjust          | int                      | ` ADJUST_NONE or 0: 不复权`, `ADJUST_PREV or 1: 前复权`, `ADJUST_POST or 2: 后复权` 默认不复权 , 目前只支持股票                                                                                                                                          |
| adjust_end_time | str                      | 复权基点时间, 默认当前时间                                                                                                                                                                                                                               |
| df              | bool                     | 是否返回 dataframe 格式,<br />默认 `False`, 返回 list[dict]                                                                                                                                                                                              |

**返回值:参考[Tick 对象](python_object_data.md#Tick - Tick 对象)或者[Bar 对象](python_object_data.md#Bar - Bar 对象)。**

当 df = True 时， 返回

| 类型      | 说明                                    |
| :-------- | :-------------------------------------- |
| dataframe | tick 的 dataframe 或者 bar 的 dataframe |

**示例：**

```python
history_data = history(symbol='SHSE.000300', frequency='1d', start_time='2010-07-28',  end_time='2017-07-30', fields='open, close, low, high, eob', adjust=ADJUST_PREV, df= True)
```

**输出：**

```python
          open      close        low       high                       eob
0     2796.4829  2863.7241  2784.1550  2866.4041 2010-07-28 00:00:00+08:00
1     2866.7720  2877.9761  2851.9961  2888.5991 2010-07-29 00:00:00+08:00
2     2871.4810  2868.8459  2844.6819  2876.1360 2010-07-30 00:00:00+08:00
3     2868.2791  2917.2749  2867.4500  2922.6121 2010-08-02 00:00:00+08:00
4     2925.2539  2865.9709  2865.7610  2929.6140 2010-08-03 00:00:00+08:00

```

当 df = False 时， 返回

| 类型 | 说明                    |
| :--- | :---------------------- |
| list | tick 列表 或者 bar 列表 |

**注意：**

```python
history_data = history(symbol='SHSE.000300', frequency='1d', start_time='2017-07-30',  end_time='2017-07-31', fields='open, close, low, high, eob', adjust=ADJUST_PREV, df=False)
```

**输出：**

```python
[{'open': 3722.42822265625, 'close': 3737.873291015625, 'low': 3713.655029296875, 'high': 3746.520751953125, 'eob': datetime.datetime(2017, 7, 31, 0, 0, tzinfo=tzfile('PRC'))}]

```

**1.**返回的`list/DataFrame`是以参数`eob/bob`的升序来排序的，若要获取多标的的数据，通常需进一步的数据处理来分别提取出每只标的的历史数据

**2.**start_time 和 end_time 中月,日,时,分,秒均可以只输入个位数,例:`'2010-7-8 9:40:0'`或`'2017-7-30 12:3:0'`,但若对应位置为零，则`0`不可被省略,如不可输入`'2017-7-30 12:3: '`
获取数据目前采用前后闭区间的方式，即会获取前后两个时间节点的数据，使用时务必注意这点

**3.**若输入无效标的代码，返回`空列表/空DataFrame`

**4.**若输入代码正确，但查询字段包含无效字段，返回的列表、DataFrame 只包含<br />`eob、symbol`和输入的其他有效字段

**5.** skip_suspended 和 fill_missing 参数暂不支持

**6.** 单次返回数据量最大返回 33000, 超出部分不返回

**7.** start_time 和 end_time 输入不存在日期时，会报错 details = "failed to parse datetime"

### history_n - 查询历史行情最新 n 条

**函数原型:**

```python
history_n(symbol, frequency, count, end_time=None, fields=None, skip_suspended=True,
          fill_missing=None, adjust=ADJUST_NONE, adjust_end_time='', df=False)
```

**参数：**

| 参数名          | 类型                     | 说明                                                                                                                                                                                                                                                       |
| :-------------- | :----------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| symbol          | str                      | 标的代码(只允许单个标的的代码字符串)，使用时参考[symbol](python_concept.md#164243e2ef567f4d)                                                                                                                                                               |
| frequency       | str                      | 频率, 支持 'tick', '1d', '60s'等,详情见[股票行情数据](https://www.myquant.cn/docs/l3333/912.html.html.html)和[期货行情数据](https://www.myquant.cn/docs/l3333/919.html.html.html)                                                                          |
| count           | int                      | 数量(正整数)                                                                                                                                                                                                                                               |
| end_time        | str or datetime.datetime | 结束时间 (%Y-%m-%d %H:%M:%S 格式), 也支持 datetime.datetime 格式，默认 None 时，用了实际当前时间，非回测当前时间                                                                                                                                           |
| fields          | str                      | 指定返回对象字段, 如有多个字段, 中间用`,` 隔开, 默认所有,<br />具体字段见:[股票字段](https://www.myquant.cn/docs/python/python_object_data.html#29852bf1b0fd29bb) ,[期货字段](https://www.myquant.cn/docs/python/python_object_data.html#29852bf1b0fd29bb) |
| skip_suspended  | bool                     | 是否跳过停牌, 默认跳过                                                                                                                                                                                                                                     |
| fill_missing    | str or None              | 填充方式, `None` - 不填充, `'NaN'` - 用空值填充, `'Last'` - 用上一个值填充, 默认 `None`                                                                                                                                                                    |
| adjust          | int                      | ` ADJUST_NONE or 0: 不复权`, `ADJUST_PREV or 1: 前复权`, `ADJUST_POST or 2: 后复权` 默认不复权 , 目前只支持股票                                                                                                                                            |
| adjust_end_time | str                      | 复权基点时间, 默认当前时间                                                                                                                                                                                                                                 |
| df              | bool                     | 是否返回 dataframe 格式, 默认 False, 返回 list[dict]                                                                                                                                                                                                       |

**返回值:参考[Tick 对象](python_object_data.md#Tick - Tick 对象)或者[Bar 对象](python_object_data.md#Bar - Bar 对象)。**

当 df = True 时，返回

| 类型      | 说明                                    |
| :-------- | :-------------------------------------- |
| dataframe | tick 的 dataframe 或者 bar 的 dataframe |

**示例：**

```python
history_n_data = history_n(symbol='SHSE.600519', frequency='1d', count=100, end_time='2020-10-20 15:30:00', fields='symbol, open, close, low, high, eob', adjust=ADJUST_PREV, df=True)
```

**输出：**

```python
 symbol       open  ...       high                       eob
0   SHSE.600519  1350.2278  ...  1350.3265 2020-05-22 00:00:00+08:00
1   SHSE.600519  1314.6434  ...  1350.8010 2020-05-25 00:00:00+08:00
2   SHSE.600519  1354.0629  ...  1354.1321 2020-05-26 00:00:00+08:00
3   SHSE.600519  1343.3086  ...  1344.2970 2020-05-27 00:00:00+08:00
4   SHSE.600519  1322.5214  ...  1331.3878 2020-05-28 00:00:00+08:00
```

当 df = False 时， 返回

| 类型 | 说明                    |
| :--- | :---------------------- |
| list | tick 列表 或者 bar 列表 |

**示例：**

```python
history_n_data = history_n(symbol='SHSE.600519', frequency='1d', count=2, end_time='2020-10-20 15:30:00', fields='symbol, open, close, low, high, eob', adjust=ADJUST_PREV, df=False)
```

**输出：**

```python
[{'symbol': 'SHSE.600519', 'open': 1725.0, 'close': 1699.0, 'low': 1691.9000244140625, 'high': 1733.97998046875, 'eob': datetime.datetime(2020, 10, 19, 0, 0, tzinfo=tzfile('PRC'))}, {'symbol': 'SHSE.600519', 'open': 1699.989990234375, 'close': 1734.0, 'low': 1695.0, 'high': 1734.969970703125, 'eob': datetime.datetime(2020, 10, 20, 0, 0, tzinfo=tzfile('PRC'))}]

```

**注意：**

**1.**返回的`list/DataFrame`是以参数`eob/bob`的升序来排序的

**2.**若输入无效标的代码，返回`空列表/空DataFrame`

**3.**若输入代码正确，但查询字段包含无效字段，返回的列表、DataFrame 只包含<br />`eob、symbol`和输入的其他有效字段

**4.**end_time 中月,日,时,分,秒均可以只输入个位数,例:`'2017-7-30 20:0:20'`,但若对应位置为零，则`0`不可被省略,如不可输入`'2017-7-30 20: :20'`

**5.** skip_suspended 和 fill_missing 参数暂不支持

**6.** 单次返回数据量最大返回 33000, 超出部分不返回

**7.** end_time 输入不存在日期时，会报错 details = "Can't parse string as time: 2020-10-40 15:30:00"

### context.data - 查询订阅数据

**函数原型:**

```python
context.data(symbol, frequency, count)
```

**参数：**

| 参数名    | 类型 | 说明                                                                                                                                                                                                                                                       |
| :-------- | :--- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| symbol    | str  | 标的代码(只允许单个标的的代码字符串)，使用时参考[symbol](python_concept.md#164243e2ef567f4d)                                                                                                                                                               |
| frequency | str  | 频率, 支持 'tick', '1d', '60s'等,需和 subscribe 函数中指定的频率保持一致。详情见[股票行情数据](https://www.myquant.cn/docs/l3333/912.html.html.html)和[期货行情数据](https://www.myquant.cn/docs/l3333/919.html.html.html)                                 |
| count     | int  | 滑窗大小(正整数)，需小于等于 subscribe 函数中 count 值                                                                                                                                                                                                     |
| fields    | str  | 指定返回对象字段, 如有多个字段, 中间用`,` 隔开, 默认所有,<br />具体字段见:[股票字段](https://www.myquant.cn/docs/python/python_object_data.html#29852bf1b0fd29bb) ,[期货字段](https://www.myquant.cn/docs/python/python_object_data.html#29852bf1b0fd29bb) |

**返回值:参考[Tick 对象](python_object_data.md#Tick - Tick 对象)或者[Bar 对象](python_object_data.md#Bar - Bar 对象)。**

| 类型      | 说明                                    |
| :-------- | :-------------------------------------- |
| dataframe | tick 的 dataframe 或者 bar 的 dataframe |

**示例：**

```python
def init(context):
    subscribe(symbols='SHSE.600519', frequency='60s', count=2)

def on_bar(context,bars):
    data = context.data(symbol='SHSE.600519', frequency='60s', count=1)
```

**输出：**

```python
        symbol	         eob	                           bob	          open	 close	 high	     low	     amount    pre_close	position	frequency	volume
0	SHSE.600519	2020-12-21 09:31:00+08:00	2020-12-21 09:30:00+08:00	1840	1845.5	1845.5	1838.199951	210503484	  0	        0	      60s	  114365
```

**注意：**

**1.** 只有在**订阅**后，此接口才能取到数据，如未订阅数据，则返回值为空。
**2.** symbols 参数只支持输入**一个**标的。
**3.** count 参数必须**小于或等于**订阅函数里面的 count 值

### get_history_l2ticks - 查询历史 L2 Tick 行情

**仅特定券商版本可用**

**函数原型:**

```python
 get_history_l2ticks(symbols, start_time, end_time, fields=None,skip_suspended=True, fill_missing=None,adjust=ADJUST_NONE, adjust_end_time='', df=False)
```

**参数：**

| 参数名          | 类型        | 说明                                                                                           |
| :-------------- | :---------- | :--------------------------------------------------------------------------------------------- |
| symbols         | str         | 标的代码，使用时参考[symbol](python_concept.md#164243e2ef567f4d)                               |
| start_time      | str         | 开始时间 (%Y-%m-%d %H:%M:%S 格式)                                                              |
| end_time        | str         | 结束时间 (%Y-%m-%d %H:%M:%S 格式)                                                              |
| fields          | str         | 指定返回对象字段, 如有多个字段, 中间用, 隔开, 默认所有                                         |
| skip_suspended  | bool        | 是否跳过停牌, 默认跳过                                                                         |
| fill_missing    | str or None | 填充方式, `None` - 不填充, `'NaN'` - 用空值填充, `'Last'` - 用上一个值填充, 默认 None          |
| adjust          | int         | ` ADJUST_NONE or 0: 不复权`, `ADJUST_PREV or 1: 前复权`, `ADJUST_POST or 2: 后复权` 默认不复权 |
| adjust_end_time | str         | 复权基点时间, 默认当前时间                                                                     |
| df              | bool        | 是否返回 dataframe 格式,<br />默认 `False`                                                     |

**返回值:参考[Tick 对象](python_object_data.md#Tick - Tick 对象)**

当 df = True 时， 返回`dataframe`

当 df = Falst， 返回`list`
**示例：**

```python
history_l2tick=get_history_l2ticks('SHSE.600519', '2020-11-23 14:00:00', '2020-11-23 15:00:00', fields=None,
                        skip_suspended=True, fill_missing=None,
                        adjust=ADJUST_NONE, adjust_end_time='', df=False)
print(history_l2tick[0])
```

**输出：**

```python
{'symbol': 'SHSE.600519', 'open': 1771.010009765625, 'high': 1809.9000244140625, 'low': 1771.010009765625, 'price': 1791.0999755859375, 'quotes': [{'bid_p': 1790.8800048828125, 'bid_v': 100, 'ask_p': 1794.760009765625, 'ask_v': 200}, {'bid_p': 1790.80004882812
5, 'bid_v': 123, 'ask_p': 1794.800048828125, 'ask_v': 100}, {'bid_p': 1790.699951171875, 'bid_v': 100, 'ask_p': 1794.8800048828125, 'ask_v': 416}, {'bid_p': 1790.68994140625, 'bid_v': 200, 'ask_p': 1794.8900146484375, 'ask_v': 300}, {'bid_p': 1790.630004882812
5, 'bid_v': 300, 'ask_p': 1794.9000244140625, 'ask_v': 1000}, {'bid_p': 1790.6199951171875, 'bid_v': 500, 'ask_p': 1794.949951171875, 'ask_v': 300}, {'bid_p': 1790.6099853515625, 'bid_v': 300, 'ask_p': 1794.9599609375, 'ask_v': 300}, {'bid_p': 1790.59997558593
75, 'bid_v': 200, 'ask_p': 1794.97998046875, 'ask_v': 100}, {'bid_p': 1790.510009765625, 'bid_v': 314, 'ask_p': 1794.989990234375, 'ask_v': 200}, {'bid_p': 1790.5, 'bid_v': 4200, 'ask_p': 1795.0, 'ask_v': 9700}], 'cum_volume': 5866796, 'cum_amount': 1049949547
1.0, 'last_amount': 1973854.0, 'last_volume': 1100, 'created_at': datetime.datetime(2020, 11, 23, 14, 0, 2, tzinfo=tzfile('PRC')), 'cum_position': 0, 'trade_type': 0}
```

**注意：**
1、`get_history_l2ticks`接口每次只能提取一天的数据, 如果取数时间超过一天，则返回按照结束时间的最近有一个交易日数据， 如果取数时间段超过 1 个自然月（31）天，则获取不到数据

### get_history_l2bars - 查询历史 L2 Bar 行情

**仅特定券商版本可用**

**函数原型:**

```python
 get_history_l2bars(symbols, frequency, start_time, end_time, fields=None,skip_suspended=True, fill_missing=None,adjust=ADJUST_NONE, adjust_end_time='', df=False)
```

**参数：**

| 参数名          | 类型        | 说明                                                                                           |
| :-------------- | :---------- | :--------------------------------------------------------------------------------------------- |
| symbols         | str         | 标的代码，使用时参考[symbol](python_concept.md#164243e2ef567f4d)                               |
| frequency       | str         | 频率, 支持 '1d', '60s'等                                                                       |
| start_time      | str         | 开始时间 (%Y-%m-%d %H:%M:%S 格式)                                                              |
| end_time        | str         | 结束时间 (%Y-%m-%d %H:%M:%S 格式)                                                              |
| fields          | str         | 指定返回对象字段, 如有多个字段, 中间用, 隔开, 默认所有                                         |
| skip_suspended  | bool        | 是否跳过停牌, 默认跳过                                                                         |
| fill_missing    | str or None | 填充方式, `None` - 不填充, `'NaN'` - 用空值填充, `'Last'` - 用上一个值填充, 默认 None          |
| adjust          | int         | ` ADJUST_NONE or 0: 不复权`, `ADJUST_PREV or 1: 前复权`, `ADJUST_POST or 2: 后复权` 默认不复权 |
| adjust_end_time | str         | 复权基点时间, 默认当前时间                                                                     |
| df              | bool        | 是否返回 dataframe 格式,<br />默认 `False`                                                     |

**返回值:参考[Bar 对象](python_object_data.md#Bar - Bar 对象)。**

当 df = True 时， 返回`dataframe`

当 df = Falst， 返回`list`

**示例：**

```python
history_l2bar=get_history_l2bars('SHSE.600000', '60s', '2020-11-23 14:00:00', '2020-11-23 15:00:00', fields=None,
								skip_suspended=True, fill_missing=None,
								adjust=ADJUST_NONE, adjust_end_time='', df=False)
print(history_l2bar[0])

```

**输出：**

```python
{'symbol': 'SHSE.600000', 'frequency': '60s', 'open': 9.90999984741211, 'high': 9.90999984741211, 'low': 9.890000343322754, 'close': 9.899999618530273, 'volume': 1270526, 'amount': 12574276.0, 'bob': datetime.datetime(2020, 11, 23, 14, 0, tzinfo=tzfile('PRC'))
, 'eob': datetime.datetime(2020, 11, 23, 14, 1, tzinfo=tzfile('PRC')), 'position': 0, 'pre_close': 0.0}
```

**注意：**
1、`get_history_l2bars`接口每次最多可提取 1 个自然月（31）天的数据如：2015.1.1-2015.1.31
错误设置：（2015.1.1-2015.2.1）超出 31 天则获取不到任何数据

### get_history_l2transactions - 查询历史 L2 逐笔成交

仅特定券商版本可用

**函数原型:**

```
 get_history_l2transactions(symbols, start_time, end_time, fields=None, df=False)
```

**参数：**

| 参数名     | 类型 | 说明                                                             |
| :--------- | :--- | :--------------------------------------------------------------- |
| symbols    | str  | 标的代码，使用时参考[symbol](python_concept.md#164243e2ef567f4d) |
| start_time | str  | 开始时间 (%Y-%m-%d %H:%M:%S 格式)                                |
| end_time   | str  | 结束时间 (%Y-%m-%d %H:%M:%S 格式)                                |
| fields     | str  | 指定返回对象字段, 如有多个字段, 中间用, 隔开, 默认所有           |
| df         | bool | 是否返回 dataframe 格式,<br />默认 `False`                       |

**返回值:参考[level2 逐笔成交数据](python_object_data.md#L2OrderQueue - Level2 委托队列)**

当 df = True 时， 返回`dataframe`

当 df = Falst， 返回`list`

**示例：**

```python
history_transactions=get_history_l2transactions('SHSE.600000', '2020-11-23 14:00:00', '2020-11-23 15:00:00', fields=None, df=False)
print(history_transactions[0])
```

**输出：**

```python
{'symbol': 'SHSE.600000', 'side': 'B', 'price': 9.90999984741211, 'volume': 100, 'created_at': datetime.datetime(2020, 11, 23, 14, 0, 0, 820000, tzinfo=tzfile('PRC')), 'exec_type': ''}
```

**注意：**
1、`get_history_l2transactions`接口每次只能提取一天的数据, 如果取数时间超过一天，则返回按照开始时间的最近有一个交易日数据

### get_history_l2orders -查询历史 L2 逐笔委托

仅特定券商版本可用
**注意：**仅深市标的可用

**函数原型:**

```
 get_history_l2orders(symbols, start_time, end_time, fields=None, df=False)
```

**参数：**

| 参数名     | 类型 | 说明                                                             |
| :--------- | :--- | :--------------------------------------------------------------- |
| symbols    | str  | 标的代码，使用时参考[symbol](python_concept.md#164243e2ef567f4d) |
| start_time | str  | 开始时间 (%Y-%m-%d %H:%M:%S 格式)                                |
| end_time   | str  | 结束时间 (%Y-%m-%d %H:%M:%S 格式)                                |
| fields     | str  | 指定返回对象字段, 如有多个字段, 中间用, 隔开, 默认所有           |
| df         | bool | 是否返回 dataframe 格式,<br />默认 `False`                       |

**返回值:参考[level2 逐笔委托数据](python_object_data.md#L2Order - Level2 逐笔委托)**

当 df = True 时， 返回`dataframe`

当 df = Falst， 返回`list`

**示例：**

```python
history_order=get_history_l2orders('SZSE.000001', '2020-11-23 14:00:00', '2020-11-23 15:00:00', fields=None, df=False)
print(history_order[0])
```

**输出：**

```python
{'symbol': 'SZSE.000001', 'side': '1', 'price': 19.520000457763672, 'volume': 200, 'created_at': datetime.datetime(2020, 11, 23, 14, 0, 0, 110000, tzinfo=tzfile('PRC')), 'order_type': '2'}
```

**注意：**
1、`get_history_l2orders`接口每次只能提取一天的数据, 如果取数时间超过一天，则返回按照开始时间的最近有一个交易日数据

### get_history_l2orders_queue -查询历史 L2 委托队列

仅特定券商版本可用

**函数原型:**

```python
 get_history_l2orders_queue(symbols, start_time, end_time, fields=None, df=False)
```

**参数：**

| 参数名     | 类型 | 说明                                                             |
| :--------- | :--- | :--------------------------------------------------------------- |
| symbols    | str  | 标的代码，使用时参考[symbol](python_concept.md#164243e2ef567f4d) |
| start_time | str  | 开始时间 (%Y-%m-%d %H:%M:%S 格式)                                |
| end_time   | str  | 结束时间 (%Y-%m-%d %H:%M:%S 格式)                                |
| fields     | str  | 指定返回对象字段, 如有多个字段, 中间用, 隔开, 默认所有           |
| df         | bool | 是否返回 dataframe 格式,<br />默认 `False`                       |

**返回值:参考[level2 委托队列据](python_object_data.md#L2OrderQueue - Level2 委托队列)**

当 df = True 时， 返回`dataframe`

当 df = Falst， 返回`list`

**示例：**

```python
history_order_queue=get_history_l2orders_queue('SHSE.600000', '2020-11-23 14:00:00', '2020-11-23 15:00:00', fields=None, df=False)
print(history_order_queue[0])
```

**输出：**

```python
{'symbol': 'SHSE.600000', 'price': 9.90999984741211, 'total_orders': 155, 'queue_orders': 50, 'queue_volumes': [52452, 600, 1200, 3200, 10000, 1800, 1000, 300, 10000, 2000, 500, 500, 2000, 1000, 2000, 300, 1200, 1400, 1000, 200, 1000, 100, 500, 1000, 500, 2380
0, 25400, 1000, 2000, 200, 500, 1200, 5000, 2000, 17600, 5000, 1000, 1300, 1000, 1200, 1000, 3000, 1000, 1000, 15000, 400, 15000, 5000, 2000, 10000], 'created_at': datetime.datetime(2020, 11, 23, 14, 0, 1, tzinfo=tzfile('PRC')), 'side': '', 'volume': 0}
```

**注意：**
1、`get_history_l2orders_queue`接口每次只能提取一天的数据, 如果取数时间超过一天，则返回按照开始时间的最近有一个交易日数据

### get_fundamentals - 查询基本面数据

**函数原型:**

```python
get_fundamentals(table, symbols, start_date, end_date, fields=None, filter=None, order_by=None, limit=1000, df=False)
```

**参数：**

| 参数名     | 类型        | 说明                                                                                                                                                                                        |
| :--------- | :---------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| table      | str         | 表名，只支持单表查询. 具体表名及 fields 字段名及 filter 可过滤的字段参考 [财务数据文档](https://www.myquant.cn/docs/l3333/913.html#865888265be1685f)                                        |
| symbols    | str or list | 标的代码, 多个代码可用 `,`(英文逗号)分割, 也支持 `['symbol1', 'symbol2']` 这种列表格式，使用时参考[symbol](python_concept.md#164243e2ef567f4d) ，免费版本只支持单个标的，多标的只返回第一个 |
| start_date | str         | 开始时间, (%Y-%m-%d 格式)                                                                                                                                                                   |
| end_date   | str         | 结束时间, (%Y-%m-%d 格式)                                                                                                                                                                   |
| fields     | str         | 查询字段 (必填)                                                                                                                                                                             |
| filter     | str         | 查询过滤,使用方法参考例 3、例 4                                                                                                                                                             |
| order_by   | str or None | 排序方式, 默认 `None`. `TCLOSE` 表示按 `TCLOSE` 升序排序. `-TCLOSE` 表示按 `TCLOSE` 降序排序. `TCLOSE, -NEGOTIABLEMV` 表示按 `TCLOSE` 升序, `NEGOTIABLEMV` 降序综合排序                     |
| limit      | int         | 数量. 默认是`1000`, 为保护服务器, 单次查询最多返回 `40000` 条记录                                                                                                                           |
| df         | bool        | 是否返回 dataframe 格式, 默认 False, 返回 list[dict]                                                                                                                                        |

**返回值:**

| key      | value 类型        | 说明                                                                                                                          |
| :------- | :---------------- | :---------------------------------------------------------------------------------------------------------------------------- |
| symbol   | str               | 标的代码                                                                                                                      |
| pub_date | datetime.datetime | 公司发布财报的日期.                                                                                                           |
| end_date | datetime.datetime | 财报统计的季度的最后一天.                                                                                                     |
| fields   | dict              | 相应指定查询 `fields` 字段的值. 字典 key 值请参考 [财务数据文档](https://www.myquant.cn/docs/l3333/913.html#865888265be1685f) |

**示例：**

例 1: 取股票代码 `SHSE.600000, SZSE.000001`, 离 `2017-01-01` 最近一个交易日的 股票交易财务衍生表 的 `TCLOSE,NEGOTIABLEMV,TOTMKTCAP,TURNRATE,PELFY,PETTM,PEMRQ,PELFYNPAAEI,PETTMNPAAEI` 字段的值

```python
get_fundamentals(table='trading_derivative_indicator', symbols='SHSE.600000, SZSE.000001', start_date='2017-01-01', end_date='2017-01-01',             fields='TCLOSE,NEGOTIABLEMV,TOTMKTCAP,TURNRATE,PELFY,PETTM,PEMRQ,PELFYNPAAEI,PETTMNPAAEI', df=True)
```

**输出：**

```python
  symbol       pub_date             end_date             NEGOTIABLEMV  PEMRQ    PELFYNPAAEI    PETTMNPAAEI  PELFY    TURNRATE    PETTM    TOTMKTCAP    TCLOSE
SHSE.600000  2016-12-30 00:00:00  2016-12-30 00:00:00     3.3261e+11    6.4605         7.0707         6.6184   6.925       0.0598   6.4746  3.50432e+11     16.21
SZSE.000001  2016-12-30 00:00:00  2016-12-30 00:00:00     1.33144e+11   6.2604         7.1341         6.2644   7.1462      0.2068   6.8399  1.56251e+11      9.1
```

例 2: 取股票代码 `SHSE.600000, SZSE.000001`, 指定时间段 `2016-01-01 -- 2017-01-01` 股票交易财务衍生表 的 `TCLOSE,NEGOTIABLEMV,TOTMKTCAP,TURNRATE,PELFY,PETTM,PEMRQ,PELFYNPAAEI,PETTMNPAAEI` 字段的值

```python
get_fundamentals(table='trading_derivative_indicator', symbols='SHSE.600000, SZSE.000001', start_date='2016-01-01', end_date='2017-01-01',
fields='TCLOSE,NEGOTIABLEMV,TOTMKTCAP,TURNRATE,PELFY,PETTM,PEMRQ,PELFYNPAAEI,PETTMNPAAEI', df=True)
```

例 3: 取指定股票 `SHSE.600000, SHSE.600001, SHSE.600002` 离 `2017-01-01` 最近一个交易日, 且满足条件 `PCTTM > 0 and PCTTM < 10` 股票交易财务衍生表 的 `TCLOSE,NEGOTIABLEMV,TOTMKTCAP,TURNRATE,PELFY,PETTM,PEMRQ,PELFYNPAAEI,PETTMNPAAEI` 字段的值

```python
get_fundamentals(table='trading_derivative_indicator', symbols='SHSE.600000, SHSE.600001, SHSE.600002', start_date='2017-01-01', end_date='2017-01-01', filter='PCTTM > 0 and PCTTM < 10',
fields='TCLOSE,NEGOTIABLEMV,TOTMKTCAP,TURNRATE,PELFY,PETTM,PEMRQ,PELFYNPAAEI,PETTMNPAAEI', df=True)
# 或者这样写
my_symbols = ['SHSE.600000', 'SHSE.600001', 'SHSE.600002']
get_fundamentals(table='trading_derivative_indicator', start_date='2017-01-01', end_date='2017-01-01', filter='PCTTM > 0 and PCTTM < 10', symbols=my_symbols,
fields='TCLOSE,NEGOTIABLEMV,TOTMKTCAP,TURNRATE,PELFY,PETTM,PEMRQ,PELFYNPAAEI,PETTMNPAAEI', df=True)
```

例 4: 取指定股票 `SHSE.600000, SZSE.000001` 离 `2016-01-20` 最近一个财报, 同时满足条件 `CURFDS > 0 and TOTLIABSHAREQUI > 0` 的 资产负债 的数据

```python
get_fundamentals(table='balance_sheet', start_date='2016-01-20', end_date='2016-01-20',
                fields='CURFDS, SETTRESEDEPO, PLAC, TRADFINASSET, ',
                symbols='SHSE.600000, SZSE.000001',
                filter='CURFDS > 0 and TOTLIABSHAREQUI > 0',
                df=True)
# 或者这样写
my_symbols = ['SHSE.600000', 'SZSE.000001']
get_fundamentals(table='balance_sheet',  start_date='2016-01-20', end_date='2016-01-20',
                fields='CURFDS, SETTRESEDEPO, PLAC, TRADFINASSET, ',
                symbols=my_symbols,
                filter='CURFDS > 0 and TOTLIABSHAREQUI > 0',
                df=True)
```

**注意:**

**1.**当 `start_date` == `end_date` 时, 取所举每个股票离 `end_date` 最近业务日期(交易日期或报告日期) 一条数据,当 `start_date` < `end_date` 时, 取指定时间段的数据,当 `start_date` > `end_date` 时, 返回`空list/空DataFrame`

**2.**当不指定排序方式时,返回的`list/DataFrame`以参数`pub_date/end_date`来排序

**3.**start_date 和 end_date 中月,日均可以只输入个位数,例:`'2010-7-8'`或`'2017-7-30'`

**4.**若输入包含无效标的代码，则返回的`list/DataFrame`只包含有效标的代码对应的数据

**5.**在该函数中，table 参数只支持输入一个表名，若表名输入错误或以`'table1,table2'`方式输入多个表名，函数返回`空list/空DataFrame`

**6.**若表名输入正确，但查询字段中出现非指定字符串，则**程序直接报错**

### get_fundamentals_n - 查询基本面数据最新 n 条

取指定股票的最近 `end_date` 的 `count` 条记录

**函数原型:**

```
get_fundamentals_n(table, symbols, end_date, fields=None, filter=None, order_by=None, count=1, df=False)
```

**参数：**

| 参数名   | 类型 | 说明                                                                                                                                                                                       |
| :------- | :--- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| table    | str  | 表名. 具体表名及 fields 字段名及 filter 可过滤的字段参考 [财务数据文档](https://www.myquant.cn/docs/l3333/913.html#865888265be1685f)                                                       |
| symbols  | str  | 标的代码, 多个代码可用 `,`(英文逗号)分割, 也支持 `['symbol1', 'symbol2']` 这种列表格式，使用时参考[symbol](python_concept.md#164243e2ef567f4d)，免费版本只支持单个标的，多标的只返回第一个 |
| end_date | str  | 结束时间, (%Y-%m-%d 格式)                                                                                                                                                                  |
| fields   | str  | 查询字段 (必填)                                                                                                                                                                            |
| filter   | str  | 查询过滤,,使用方法参考`get_fundamentals`的例 3、例 4                                                                                                                                       |
| count    | int  | 每个股票取最近的数量(正整数)                                                                                                                                                               |
| df       | bool | 是否返回 dataframe 格式, 默认 False, 返回 list[dict]                                                                                                                                       |

**返回值:**

| key      | value 类型        | 说明                                                                                                                          |
| :------- | :---------------- | :---------------------------------------------------------------------------------------------------------------------------- |
| symbol   | str               | 标的代码                                                                                                                      |
| pub_date | datetime.datetime | 公司发布财报的日期.                                                                                                           |
| end_date | datetime.datetime | 财报统计的季度的最后一天.                                                                                                     |
| fields   | dict              | 相应指定查询 `fields` 字段的值. 字典 key 值请参考 [财务数据文档](https://www.myquant.cn/docs/l3333/913.html#865888265be1685f) |

**示例：**

例 1: 取股票代码 `SHSE.600000, SZSE.000001`, 离 `2017-01-01` 最近 3 条(每个股票都有 3 条) 股票交易财务衍生表 的 `TCLOSE,NEGOTIABLEMV,TOTMKTCAP,TURNRATE,PELFY,PETTM,PEMRQ,PELFYNPAAEI,PETTMNPAAEI` 字段的值

```python
get_fundamentals_n(table='trading_derivative_indicator', symbols='SHSE.600000, SZSE.000001', end_date='2017-01-01', count=3,           fields='TCLOSE,NEGOTIABLEMV,TOTMKTCAP,TURNRATE,PELFY,PETTM,PEMRQ,PELFYNPAAEI,PETTMNPAAEI',df=True)
```

**输出：**

```
   symbol        pub_date             end_date           TCLOSE   TOTMKTCAP    PETTM      TURNRATE     PETTMNPAAEI  PELFY    PELFYNPAAEI    NEGOTIABLEMV    PEMRQ
SZSE.000001  2016-12-30 00:00:00  2016-12-30 00:00:00      9.1   1.56251e+11   6.8399      0.2068         6.2644   7.1462         7.1341     1.33144e+11   6.2604
SZSE.000001  2016-12-29 00:00:00  2016-12-29 00:00:00      9.08  1.55907e+11   6.8249      0.2315         6.2506   7.1305         7.1184     1.32851e+11   6.2466
SZSE.000001  2016-12-28 00:00:00  2016-12-28 00:00:00      9.06  1.55564e+11   6.8098      0.2297         6.2369   7.1147         7.1027     1.32558e+11   6.2329
SHSE.600000  2016-12-30 00:00:00  2016-12-30 00:00:00     16.21  3.50432e+11   6.4746      0.0598         6.6184   6.925          7.0707     3.3261e+11    6.4605
SHSE.600000  2016-12-29 00:00:00  2016-12-29 00:00:00     16.07  3.47406e+11   6.4187      0.0578         6.5613   6.8652         7.0097     3.29737e+11   6.4047
SHSE.600000  2016-12-28 00:00:00  2016-12-28 00:00:00     16.09  3.47838e+11   6.4267      0.0704         6.5694   6.8737         7.0184     3.30148e+11   6.4126
```

**注意:**

**1.**对每个标的,返回的`list/DataFrame`以参数`pub_date/end_date`的倒序来排序

**2.**end_date 中月,日均可以只输入个位数,例:`'2010-7-8'`或`'2017-7-30'`

**3.**若输入包含无效标的代码，则返回的`list/DataFrame`只包含有效标的代码对应的数据

**4.**在该函数中，table 参数只支持输入一个表名，若表名输入错误或以`'table1,table2'`方式输入多个表名，函数返回`空list/空DataFrame`

**5.**若表名输入正确，但查询字段中出现非指定字符串，则**程序直接报错**

### get_instruments - 查询最新交易标的信息

查询最新交易标的信息,有基本数据及最新日频数据

**函数原型:**

```
get_instruments(symbols=None, exchanges=None, sec_types=None, names=None, skip_suspended=True, skip_st=True, fields=None, df=False)
```

**参数：**

| 参数名         | 类型                | 说明                                                                                                                                                                       |
| :------------- | :------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| symbols        | str or list or None | 标的代码 多个代码可用 `,`(英文逗号)分割, 也支持 `['symbol1', 'symbol2']` 这种列表格式,默认 None 表示所有，使用时参考[symbol](python_concept.md#164243e2ef567f4d)           |
| exchanges      | str or list or None | 见[交易所代码](python_concept.md#交易所代码 '交易所代码'), <br />多个交易所代码可用 `,`(英文逗号)分割, 也支持 `['exchange1', 'exchange2']` 这种列表格式,默认 None 表示所有 |
| sec_types      | list                | 指定类别, 默认所有, 其他类型见[sec_type 类型](python_enum_constant.md#SecType - 标的类别 "sec_type 类型")                                                                  |
| names          | str or None         | 查询代码, 默认 None 表示所有                                                                                                                                               |
| skip_suspended | bool                | 是否跳过停牌, 默认 True 跳过停牌                                                                                                                                           |
| skip_st        | bool                | 是否跳过 ST, 默认 True 跳过 ST                                                                                                                                             |
| fields         | str or None         | 查询字段 默认 None 表示所有,参考返回值。                                                                                                                                   |
| df             | bool                | 是否返回 dataframe 格式, 默认 False, 返回 list[dict]                                                                                                                       |

**返回值:**

| key                   | 类型              | 说明                                                                                                                                                                                                                                                                                                                        |
| :-------------------- | :---------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| symbol                | str               | 标的代码                                                                                                                                                                                                                                                                                                                    |
| sec_type              | int               | 1: 股票, 2: 基金, 3: 指数, 4: 期货, 5: 期权, 8:可转债，10: 虚拟合约                                                                                                                                                                                                                                                         |
| exchange              | str               | 见[交易所代码](python_concept.md#交易所代码 '交易所代码')                                                                                                                                                                                                                                                                   |
| sec_id                | str               | 代码                                                                                                                                                                                                                                                                                                                        |
| sec_name              | str               | 名称                                                                                                                                                                                                                                                                                                                        |
| sec_abbr              | str               | 拼音简称                                                                                                                                                                                                                                                                                                                    |
| price_tick            | float             | 最小变动单位                                                                                                                                                                                                                                                                                                                |
| listed_date           | datetime.datetime | 上市日期                                                                                                                                                                                                                                                                                                                    |
| delisted_date         | datetime.datetime | 退市日期                                                                                                                                                                                                                                                                                                                    |
| trade_date            | datetime.datetime | 交易日期                                                                                                                                                                                                                                                                                                                    |
| sec_level             | int               | 1-正常,2-ST 股票,3-\*ST 股票,4-股份转让,5-处于退市整理期的证券,6-上市开放基金 LOF,7-交易型开放式指数基金(ETF),8-非交易型开放式基金(暂不交易,仅揭示基金净值及开放申购赎回业务),9-仅提供净值揭示服务的开放式基金;,10-仅在协议交易平台挂牌交易的证券,11-仅在固定收益平台挂牌交易的证券,12-风险警示产品,13-退市整理产品,99-其它 |
| is_suspended          | int               | 是否停牌. 1: 是, 0: 否                                                                                                                                                                                                                                                                                                      |
| multiplier            | float             | 合约乘数                                                                                                                                                                                                                                                                                                                    |
| margin_ratio          | float             | 保证金比率                                                                                                                                                                                                                                                                                                                  |
| settle_price          | float             | 结算价                                                                                                                                                                                                                                                                                                                      |
| position              | int               | 持仓量                                                                                                                                                                                                                                                                                                                      |
| pre_close             | float             | 昨收价                                                                                                                                                                                                                                                                                                                      |
| upper_limit           | float             | 涨停价 （可转债没有涨停价）                                                                                                                                                                                                                                                                                                 |
| lower_limit           | float             | 跌停价 （可转债没有跌停价）                                                                                                                                                                                                                                                                                                 |
| adj_factor            | float             | 复权因子.基金跟股票才有                                                                                                                                                                                                                                                                                                     |
| conversion_price      | float             | 可转债转股价                                                                                                                                                                                                                                                                                                                |
| conversion_start_date | datetime.datetime | 可转债开始转股时间                                                                                                                                                                                                                                                                                                          |
| underlying_symbol     | str               | 可转债正股标的                                                                                                                                                                                                                                                                                                              |

**示例：**

```python
get_instruments(exchanges='SZSE', df=True)
```

**输出:**

```python
  adj_factor    is_st    upper_limit  sec_name      pre_close  symbol         price_tick  delisted_date        exchange    listed_date            sec_type    settle_price    lower_limit    multiplier  sec_abbr      position  trade_date               sec_id    is_suspended    margin_ratio
   115.338          0          12.38  平安银行             11.25  SZSE.000001          0.01  2038-01-01 00:00:00  SZSE        1991-04-03 00:00:00           1               0          10.13             1  payx               0   2017-09-19 00:00:00    000001               0               1
   127.812          0          30.84  万科A                28.04  SZSE.000002          0.01  2038-01-01 00:00:00  SZSE        1991-01-29 00:00:00           1               0          25.24             1  wkA                0   2017-09-19  00:00:00   000002               0               1
   7.44538          0          27.24  国农科技             24.76  SZSE.000004          0.01  2038-01-01 00:00:00  SZSE        1991-01-14 00:00:00           1               0          22.28             1  gnkj               0   2017-09-19 00:00:00    000004               0               1
   ······
```

**注意：**

**1.**停牌时且股票发生除权除息, 涨停价和跌停价可能有误差

**2.**预上市股票以 1900-01-01 为虚拟发布日期，未退市股票以 2038-01-01 为虚拟退市日期。

**3.**对于检索所需标的信息的 4 种手段`symbols,exchanges,sec_types,names`,若输入参数之间出现任何矛盾（换句话说，所有的参数限制出满足要求的交集为空),则返回
`空list/空DataFrame`
例如`get_instruments(exchanges='SZSE',sec_types=[4])`返回的是空值
**4.**获取全 A 股票代码示例`get_instruments(exchanges='SZSE,SHSE', sec_types=1, fields='symbol',df=1)['symbol'].tolist()`
**5.**若查询字段包含无效字段，返回的`列表/DataFrame`只包含有效字段数据
**6.**关于可转债的到期日(退市日期)为`delisted_date`，转股价值为`转股价值 = 转股数*股价=（100/可转债转股价）*股价`

### get_history_instruments - 查询交易标的历史信息数据

返回指定 symbols 的标的日频历史数据

**函数原型:**

```python
get_history_instruments(symbols, fields=None, start_date=None, end_date=None, df=False)
```

**参数：**

| 参数名     | 类型        | 说明                                                                                                                                                      |
| :--------- | :---------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------- |
| symbols    | str or list | 标的代码, 多个代码可用 `,`(英文逗号)分割,也支持 `['symbol1', 'symbol2']` 这种列表格式, 是必填参数，使用时参考[symbol](python_concept.md#164243e2ef567f4d) |
| fields     | str or None | 查询字段. 默认 `None` 表示所有                                                                                                                            |
| start_date | str or None | 开始时间. (%Y-%m-%d 格式) 默认 `None` 表示当前时间                                                                                                        |
| end_date   | str or None | 结束时间. (%Y-%m-%d 格式) 默认 `None` 表示当前时间                                                                                                        |
| df         | bool        | 是否返回 dataframe 格式, 默认 False, 返回 `list[dict]`, 列表每项的 dict 的 key 值为参数指定的 `fields`                                                    |

**返回值:**

| key          | 类型              | 说明                                                                                                                                                                                                                                                                                                                        |
| :----------- | :---------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| symbol       | str               | 标的代码                                                                                                                                                                                                                                                                                                                    |
| trade_date   | datetime.datetime | 交易日期                                                                                                                                                                                                                                                                                                                    |
| sec_level    | int               | 1-正常,2-ST 股票,3-\*ST 股票,4-股份转让,5-处于退市整理期的证券,6-上市开放基金 LOF,7-交易型开放式指数基金(ETF),8-非交易型开放式基金(暂不交易,仅揭示基金净值及开放申购赎回业务),9-仅提供净值揭示服务的开放式基金;,10-仅在协议交易平台挂牌交易的证券,11-仅在固定收益平台挂牌交易的证券,12-风险警示产品,13-退市整理产品,99-其它 |
| is_suspended | int               | 是否停牌. 1: 是, 0: 否                                                                                                                                                                                                                                                                                                      |
| multiplier   | float             | 合约乘数                                                                                                                                                                                                                                                                                                                    |
| margin_ratio | float             | 保证金比率                                                                                                                                                                                                                                                                                                                  |
| settle_price | float             | 结算价                                                                                                                                                                                                                                                                                                                      |
| pre_settle   | float             | 昨结价                                                                                                                                                                                                                                                                                                                      |
| position     | int               | 持仓量                                                                                                                                                                                                                                                                                                                      |
| pre_close    | float             | 昨收价                                                                                                                                                                                                                                                                                                                      |
| upper_limit  | float             | 涨停价 （可转债没有涨停价）                                                                                                                                                                                                                                                                                                 |
| lower_limit  | float             | 跌停价 （可转债没有跌停价）                                                                                                                                                                                                                                                                                                 |
| adj_factor   | float             | 复权因子.基金跟股票才有                                                                                                                                                                                                                                                                                                     |

**示例：**

```python
get_history_instruments(symbols='SZSE.000001,SZSE.000002', start_date='2017-09-19', end_date='2017-09-19', df=True)
```

**输出: **

```python
  adj_factor    is_st       settle_price   upper_limit  symbol        pre_close    lower_limit       is_suspended    multiplier    position      trade_date             margin_ratio
     115.338        0               0          12.38  SZSE.000001        11.25          10.13               0             1           0    2017-09-19 00:00:00               1
     127.812        0               0          30.84  SZSE.000002        28.04          25.24               0             1           0    2017-09-19 00:00:00               1
```

**注意：**

**1.**停牌时且股票发生除权除息, 涨停价和跌停价可能有误差

**2.**为保护服务器, 单次查询最多返回 **33000** 条记录

**3.**对每个标的，数据根据参数`trade_date`的升序进行排序

**4.**start_date 和 end_date 中月,日均可以只输入个位数,例:`'2010-7-8'`或`'2017-7-30'`

**5.**若查询字段中出现非指定字符串，则**程序直接报错**

**6.**若输入包含无效标的代码，则返回的`list/DataFrame`只包含有效标的代码对应的数据

### get_instrumentinfos - 查询交易标的基本信息

获取到交易标的基本信息, 与时间无关.

**函数原型:**

```python
get_instrumentinfos(symbols=None, exchanges=None, sec_types=None, names=None, fields=None, df=False)
```

**参数：**

| 参数名    | 类型                | 说明                                                                                                                                                                             |
| :-------- | :------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| symbols   | str or list or None | 标的代码, 多个代码可用 `,`(英文逗号)分割,也支持 `['symbol1', 'symbol2']` 这种列表格式, 默认 `None` 表示所有，使用时参考[symbol](python_concept.md#164243e2ef567f4d)              |
| exchanges | str or list or None | 见[交易市场代码](python_concept.md#交易所代码 '交易市场代码'),<br />多个交易所代码可用 `,`(英文逗号)分割, 也支持 `['exchange1', 'exchange2']` 这种列表格式, 默认 `None` 表示所有 |
| sec_types | list                | 指定类别, 默认所有, 其他类型见[sec_type 类型](python_enum_constant.md#SecType - 标的类别 "sec_type 类型")                                                                        |
| names     | str or None         | 查询代码, 默认 `None` 表示所有                                                                                                                                                   |
| fields    | str or None         | 查询字段 默认 `None` 表示所有                                                                                                                                                    |
| df        | bool                | 是否返回 dataframe 格式, 默认 False, 返回字典格式，返回 `list[dict]`, 列表每项的 dict 的 key 值为参数指定的 `fields`                                                             |

**返回值:**

| key               | 类型              | 说明                                                                  |
| :---------------- | :---------------- | :-------------------------------------------------------------------- |
| symbol            | str               | 标的代码                                                              |
| sec_type          | int               | 1: 股票, 2: 基金, 3: 指数, 4: 期货, 5: 期权, 8：可转债， 10: 虚拟合约 |
| exchange          | str               | 见[交易市场代码](python_concept.md#交易所代码 '交易市场代码').        |
| sec_id            | str               | 代码                                                                  |
| sec_name          | str               | 名称                                                                  |
| sec_abbr          | str               | 拼音简称                                                              |
| price_tick        | float             | 最小变动单位                                                          |
| listed_date       | datetime.datetime | 上市日期                                                              |
| delisted_date     | datetime.datetime | 退市日期                                                              |
| conversion_price  | float             | 可转债转股价                                                          |
| underlying_symbol | str               | 可转债正股标的                                                        |

**示例：**

```python
get_instrumentinfos(symbols=['SHSE.000001','SHSE.000002'],df=True)
```

**输出: **

```python
sec_name      symbol         price_tick  delisted_date          sec_type  sec_abbr   sec_id       listed_date     exchange
上证指数     SHSE.000001            0  2038-01-01 00:00:00           3    szzs          000001    1991-07-15 00:00:00  SHSE
A股指数      SHSE.000002            0  2038-01-01 00:00:00           3    Agzs          000002    1992-02-21 00:00:00  SHSE

```

**注意：**

**1.**对于检索所需标的信息的 4 种手段`symbols,exchanges,sec_types,names`,若输入参数之间出现任何矛盾（换句话说，所有的参数限制出满足要求的交集为空),则返回
`空list/空DataFrame`
例如`get_instrumentinfos(exchanges='SZSE',sec_types=[4])`返回的是空值

**2.**若查询字段包含无效字段，返回的`列表/DataFrame`只包含有效字段数据

### get_constituents - 查询指数最新成份股

**函数原型:**

```
get_constituents(index, fields=None, df=False)
```

**参数：**

| 参数名 | 类型        | 说明                                                        |
| :----- | :---------- | :---------------------------------------------------------- |
| index  | str         | [指数代码](https://www.myquant.cn/docs/l3333/928.html.html) |
| fields | str or None | 若要有返回权重字段, 可以设置为 'symbol, weight'             |
| df     | bool        | 是否返回 dataframe 格式, 默认 False, 返回 list[dict]        |

**返回值:**

1. 参数 fields 为 None 时, 返回 `list[str]` , 成分股列表

2. 参数 fields 指定为 `'symbol, weight'`, 返回 `list[dict]`, dict 包含 key 值:

| 参数名 | 类型  | 说明        |
| :----- | :---- | :---------- |
| symbol | str   | 股票 symbol |
| weight | float | 权重        |

当 df = True 时，返回

| 类型      | 说明      |
| :-------- | :-------- |
| dataframe | dataframe |

**示例 1：**

```python
get_constituents(index='SHSE.000001', fields='symbol, weight', df=True)
```

**输出: **

```
  symbol        weight
SHSE.603966      0.01
SHSE.603960      0.01
···
```

当 df = False 时，返回

| 类型         | 说明         |
| :----------- | :----------- |
| list[dict()] | 列表镶嵌字典 |

**示例 2：**

```python
get_constituents(index='SHSE.000001', fields='symbol, weight', df=False)
```

**输出: **

```
[{'symbol': 'SHSE.603681', 'weight': 0.009999999776482582}, {'symbol': 'SHSE.601518', 'weight': 0.009999999776482582}, {'symbol': 'SHSE.600010', 'weight': 0.12999999523162842}···]
```

**示例 3：**
只输出 [symbol](python_concept.md#44e233ec21d880c2 'symbol - 代码标识') 列表

```python
get_constituents(index='SHSE.000001')
```

**输出: **

```
['SHSE.603966', 'SHSE.603960', 'SHSE.603218',···]
```

**注意：**

**1.**在该函数中，index 参数只支持输入一个指数代码，若代码输入错误或以`'index1,inedx2'`方式输入多个代码，函数返回`空list/空DataFrame`

### get_history_constituents - 查询指数成份股的历史数据

**函数原型:**

```
get_history_constituents(index, start_date=None, end_date=None)
```

**参数：**

| 参数名     | 类型                             | 说明                                                        |
| :--------- | :------------------------------- | :---------------------------------------------------------- |
| index      | str                              | [指数代码](https://www.myquant.cn/docs/l3333/928.html.html) |
| start_date | str or datetime.datetime or None | 开始时间 (%Y-%m-%d 格式) 默认 `None` 表示当前日期           |
| end_date   | str or datetime.datetime or None | 结束时间 (%Y-%m-%d 格式) 默认 `None` 表示当前日期           |

**返回值:**

`list[constituent]`<br />`constituent` 为 dict,包含 key 值`constituents`和`trade_date`:

| 参数名       | 类型              | 说明                                          |
| :----------- | :---------------- | :-------------------------------------------- |
| constituents | dict              | 股票代码作为 key, 所占权重作为 value 的键值对 |
| trade_date   | datetime.datetime | 交易日期                                      |

**示例：**

```python
get_history_constituents(index='SHSE.000001', start_date='2017-07-10')
```

**输出: **

```
                            constituents                                                    trade_date
{'SHSE.600527': 0.009999999776482582, 'SHSE.600461': 0.019999999552965164,···}     2017-07-31 00:00:00
{'SHSE.603966': 0.009999999776482582, 'SHSE.603960': 0.009999999776482582,···}     2017-08-31 00:00:00
···
```

**注意：**

**1.**函数返回的数据每月发布一次，故返回的数据是月频数据，`trade_date`为各月最后一天

**2.**在该函数中，index 参数只支持输入一个指数代码，若代码输入错误或以`'index1,inedx2'`方式输入多个代码，函数返回`空list`

**3.**start_date 和 end_date 中月,日均可以只输入个位数,例:`'2010-7-8'`或`'2017-7-30'`,但若对应位置为零，则`0`不可被省略

### get_continuous_contracts - 获取主力合约

**函数原型:**
获取主力合约和次主力合约

```
get_continuous_contracts(csymbol, start_date=None, end_date=None)
```

**参数：**

| 参数名     | 类型 | 说明                                                                                                                 |
| :--------- | :--- | :------------------------------------------------------------------------------------------------------------------- |
| csymbol    | str  | [查询代码](../l3333/920.html#主力连续合约完整的合约代码) 比如获取主力合约，输入 SHFE.AG;获取连续合约，输入 SHFE.AG00 |
| start_date | str  | 开始时间 (%Y-%m-%d 格式)                                                                                             |
| end_date   | str  | 结束时间 (%Y-%m-%d 格式)                                                                                             |

**返回值:**

返回 `list[dict]`, dict 包含 key 值:

| key        | value 类型        | 说明            |
| :--------- | :---------------- | :-------------- |
| symbol     | str               | 真实合约 symbol |
| trade_date | datetime.datetime | 交易日期        |

**示例：**

```python
get_continuous_contracts(csymbol='SHFE.AG', start_date='2017-07-01', end_date='2017-08-01')
```

**输出: **

```
[{'symbol': 'SHFE.ag2012', 'trade_date': datetime.datetime(2020, 7, 1, 0, 0, tzinfo=tzfile('PRC'))}, {'symbol': 'SHFE.ag2012', 'trade_date': datetime.datetime(2020, 7, 2, 0, 0, tzinfo=tzfile('PRC'))}, {'symbol': 'SHFE.ag2012', 'trade_date': datetime.datetime(2020, 7, 3, 0, 0, tzinfo=tzfile('PRC'))}, {'symbol': 'SHFE.ag2012', 'trade_date': datetime.datetime(2020, 7, 4, 0, 0, tzinfo=tzfile('PRC'))}, {'symbol': 'SHFE.ag2012', 'trade_date': datetime.datetime(2020, 7, 5, 0, 0, tzinfo=tzfile('PRC'))}, {'symbol': 'SHFE.ag2012', 'trade_date': datetime.datetime(2020, 7, 6, 0, 0, tzinfo=tzfile('PRC'))}, {'symbol': 'SHFE.ag2012', 'trade_date': datetime.datetime(2020, 7, 7, 0, 0, tzinfo=tzfile('PRC'))}, {'symbol': 'SHFE.ag2012', 'trade_date': datetime.datetime(2020, 7, 8, 0, 0, tzinfo=tzfile('PRC'))}, {'symbol': 'SHFE.ag2012', 'trade_date': datetime.datetime(2020, 7, 9, 0, 0, tzinfo=tzfile('PRC'))}, {'symbol': 'SHFE.ag2012', 'trade_date': datetime.datetime(2020, 7, 10, 0, 0, tzinfo=tzfile('PRC'))}]

```

**注意:**

**1.**在该函数中，csymbol 参数只支持输入一个标的代码，若代码输入错误或以`'csymbol1,csymbol2'`方式输入多个代码，函数返回`空list`

**2.**`start_date`和`end_date`中月,日均可以只输入个位数,<br />例:`'2017-7-1'`或`'2017-8-1'`

### get_industry - 查询行业股票列表

**函数原型:**

```
get_industry(code)
```

**参数：**

| 参数名 | 类型 | 说明                                                                                 |
| :----- | :--- | :----------------------------------------------------------------------------------- |
| code   | str  | [行业代码](https://www.myquant.cn/docs/l3333/914.html#b1f1808ae05fd4c6) 不区分大小写 |

**返回值:**

`list`返回指定行业的成份股 symbol 列表

**示例：**

```python
#返回所有以J6开头的行业代码对应的成分股(包括:J66,J67,J68,J69的成分股)
get_industry(code='j6')
```

**输出: **

```
['SHSE.600000', 'SHSE.600016', 'SHSE.600030',···]
```

**注意：**

**1.**在该函数中，code 参数只支持输入一个行业代码，若代码输入错误或以`'code1,code2'`方式输入多个代码，函数返回`空list`

### get_dividend - 查询分红送配

**函数原型:**

```
get_dividend(symbol, start_date, end_date=None)
```

**参数：**

| 参数名     | 类型 | 说明                                                                            |
| :--------- | :--- | :------------------------------------------------------------------------------ |
| symbol     | str  | 标的代码, (必填)，使用时参考[symbol](python_concept.md#164243e2ef567f4d)        |
| start_date | str  | 开始时间 (%Y-%m-%d 格式)                                                        |
| end_date   | str  | 结束时间 (%Y-%m-%d 格式)                                                        |
| df         | bool | 是否返回 dataframe 格式, 默认 False, 返回返回`list[dividend]`，dividend 为 dict |

**返回值:**

| key               | value 类型        | 说明         |
| :---------------- | :---------------- | :----------- |
| symbol            | str               | 标的代码     |
| cash_div          | float             | 每股派现     |
| allotment_ratio   | float             | 每股配股比例 |
| allotment_price   | float             | 配股价       |
| share_div_ratio   | float             | 每股送股比例 |
| share_trans_ratio | float             | 每股转增比例 |
| created_at        | datetime.datetime | 创建时间     |

**示例：**

```python
get_dividend(symbol='SHSE.600000',start_date='2000-01-01', end_date='2017-12-31', df=True)
```

**输出: **

```
  share_trans_ratio  symbol         cash_div    allotment_ratio    allotment_price    share_div_ratio
       0            SHSE.600000        0.15                  0                  0                  0
       0.5          SHSE.600000         0.2                  0                  0                  0
                ···
```

**注意:**

**1.**在该函数中，symbol 参数只支持输入一个标的代码，若代码输入错误或以`'symbol1,symbol2'`方式输入多个代码，函数返回`空list/空DataFrame`

**2.**`start_date`和`end_date`中月,日均可以只输入个位数,<br />例:`'2010-7-8'`或`'2017-7-30'`

### get_trading_dates - 查询交易日列表

**函数原型:**

```
get_trading_dates(exchange, start_date, end_date)
```

**参数：**

| 参数名     | 类型 | 说明                                                          |
| :--------- | :--- | :------------------------------------------------------------ |
| exchange   | str  | 见[交易市场代码](python_concept.md#交易所代码 '交易市场代码') |
| start_date | str  | 开始时间 (%Y-%m-%d 格式)                                      |
| end_date   | str  | 结束时间 (%Y-%m-%d 格式)                                      |

**返回值:**

交易日期字符串(%Y-%m-%d 格式)列表,

**示例：**

```python
get_trading_dates(exchange='SZSE', start_date='2017-01-01', end_date='2017-01-30')
```

**输出: **

```
['2017-01-03', '2017-01-04', '2017-01-05', '2017-01-06', ...]
```

**注意：**

**1.**`exchange`参数仅支持输入单个交易所代码,若代码错误，返回`空list`

**2.**`start_date`和`end_date`中月,日均可以只输入个位数,<br />例:`'2010-7-8'`或`'2017-7-30'`

### get_previous_trading_date - 返回指定日期的上一个交易日

**函数原型:**

```
get_previous_trading_date(exchange, date)
```

**参数：**

| 参数名   | 类型 | 说明                                                          |
| :------- | :--- | :------------------------------------------------------------ |
| exchange | str  | 见[交易市场代码](python_concept.md#交易所代码 '交易市场代码') |
| date     | str  | 时间 (%Y-%m-%d 格式)                                          |

**返回值:**

`str`返回指定日期的上一个交易日字符串(%Y-%m-%d 格式)

**示例：**

```python
get_previous_trading_date(exchange='SZSE', date='2017-05-01')
```

**输出: **

```
'2017-04-28'
```

**注意：**

**1.**`exchange`参数仅支持输入单个交易所代码,若代码错误，返回`空list`

**2.**`date`中月,日均可以只输入个位数,<br />例:`'2010-7-8'`或`'2017-7-30'`

### get_next_trading_date - 返回指定日期的下一个交易日

**函数原型:**

```
get_next_trading_date(exchange, date)
```

**参数：**

| 参数名   | 类型 | 说明                                                          |
| :------- | :--- | :------------------------------------------------------------ |
| exchange | str  | 见[交易市场代码](python_concept.md#交易所代码 '交易市场代码') |
| date     | str  | 时间 (%Y-%m-%d 格式)                                          |

**返回值:**

`str`返回指定日期的下一个交易日字符串 (%Y-%m-%d 格式)

**示例：**

```python
get_next_trading_date(exchange='SZSE', date='2017-05-01')
```

**输出: **

```
'2017-05-02'
```

**注意：**

**1.**`exchange`参数仅支持输入单个交易所代码,若代码错误，返回`空list`

**2.**`date`中月,日均可以只输入个位数,<br />例:`'2010-7-8'`或`'2017-7-30'`

---

## 5. 股票与指数数据函数

python 股票与指数数据 API 包含在 gm3.0.145 版本及以上版本，不需要引入新库

### stk_get_index_constituents - 查询指数最新成分股

查询指定指数在最新交易日的成分股和权重

**函数原型:**

```python
stk_get_index_constituents(index)
```

**参数：**

| 参数名 | 类型 | 中文名称 | 必填 | 默认值 | 参数用法说明                                |
| :----- | :--- | :------- | :--- | :----- | :------------------------------------------ |
| index  | str  | 指数代码 | Y    | 无     | 必填，只能输入一个指数，如：`'SHSE.000905'` |

**返回值:**`dataframe`

| 字段名     | 类型              | 中文名称   | 说明                         |
| :--------- | :---------------- | :--------- | :--------------------------- |
| index      | str               | 指数代码   | 查询成分股的指数代码         |
| symbol     | str               | 成分股代码 | exchange.sec_id              |
| weight     | float             | 成分股权重 | 成分股 symbol 对应的指数权重 |
| trade_date | datetime.datetime | 交易日期   | 最新交易日，%Y-%m-%d 格式    |

**示例：**

```python
stk_get_index_constituents(index='SHSE.000905')
```

**输出：**

```python
           index       symbol  weight        date
0    SHSE.000905  SZSE.000009  0.0060  2022-09-07
1    SHSE.000905  SZSE.000012  0.0015  2022-09-07
2    SHSE.000905  SZSE.000021  0.0018  2022-09-07
3    SHSE.000905  SZSE.000027  0.0020  2022-09-07
4    SHSE.000905  SZSE.000028  0.0007  2022-09-07
..           ...          ...     ...         ...
495  SHSE.000905  SHSE.688390  0.0032  2022-09-07
496  SHSE.000905  SHSE.688521  0.0020  2022-09-07
497  SHSE.000905  SHSE.688777  0.0035  2022-09-07
498  SHSE.000905  SHSE.688819  0.0008  2022-09-07
499  SHSE.000905  SHSE.689009  0.0025  2022-09-07
[500 rows x 4 columns]
```

**注意：**

**1.** 数据日频更新，当日更新前返回前一交易日的成分数据，约在交易日 20 点左右更新当日数据。

---

## 6. 期货数据函数

python 期货数据 API 包含在 gm3.0.145 版本及以上版本，不需要引入新库

---

### fut_get_continuous_contracts - 查询连续合约对应的真实合约

查询指定时间段连续合约在每个交易日上对应的真实合约

**函数原型:**

```python
fut_get_continuous_contracts(csymbol, start_date="", end_date="")
```

**参数：**

| 参数名     | 类型 | 中文名称     | 必填 | 默认值 | 参数用法说明                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| :--------- | :--- | :----------- | :--- | :----- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| csymbol    | str  | 连续合约代码 | Y    | 无     | 必填，使用时参考[查询代码](https://www.myquant.cn/api/data/edit/1211.html#主力连续合约完整的合约代码)，<br />支持主力合约、次主力、前 5 个月份连续合约代码，如：<br />1000 股指期货主力连续合约：CFFEX.IM，<br />1000 股指期货次主力连续合约：CFFEX.IM22，<br />1000 股指期货当月连续合约：CFFEX.IM00，<br />1000 股指期货下月连续合约：CFFEX.IM01，<br />1000 股指期货下季连续合约：CFFEX.IM02，<br />1000 股指期货隔季连续合约：CFFEX.IM03 |
| start_date | str  | 开始时间     | N    | ""     | 开始时间日期，%Y-%m-%d 格式，默认`""`表示最新时间                                                                                                                                                                                                                                                                                                                                                                                            |
| end_date   | str  | 结束时间     | N    | ""     | 结束时间日期，%Y-%m-%d 格式，默认`""`表示最新时间                                                                                                                                                                                                                                                                                                                                                                                            |

**返回值:**`list[dict]`

| 字段名     | 类型              | 中文名称 | 说明                   |
| :--------- | :---------------- | :------- | :--------------------- |
| symbol     | str               | 标的代码 | exchange.sec_id        |
| trade_date | datetime.datetime | 交易日期 | 具体合约对应的交易日期 |

**示例：**

```python
fut_get_continuous_contracts(csymbol='SHFE.NI', start_date="2022-09-01", end_date="2022-09-15")
```

**输出：**

```python
[{'symbol': 'SHFE.ni2210', 'trade_date': '2022-09-01'}, {'symbol': 'SHFE.ni2210', 'trade_date': '2022-09-02'}, {'symbol': 'SHFE.ni2210', 'trade_date': '2022-09-05'}, {'symbol': 'SHFE.ni2210', 'trade_date': '2022-09-06'}, {'symbol': 'SHFE.ni2210', 'trade_date': '2022-09-07'}, {'symbol': 'SHFE.ni2210', 'trade_date': '2022-09-08'}, {'symbol': 'SHFE.ni2210', 'trade_date': '2022-09-09'}, {'symbol': 'SHFE.ni2210', 'trade_date': '2022-09-13'}, {'symbol': 'SHFE.ni2210', 'trade_date': '2022-09-14'}, {'symbol': 'SHFE.ni2210', 'trade_date': '2022-09-15'}]

```

**注意：**

**1.** 具体合约（真实合约）：`交易所.品种名到期月份`对应期货具体合约 symbol，如 CFFEX.IF2206
**2.** 主力连续合约（虚拟合约，由真实合约拼接）：`交易所.品种名`对应主力连续合约 symbol，如 CFFEX.IF，CFFEX.IC

- 主力连续合约切换规则
  1、每个品种只选出唯一一个主力合约。
  2、日成交量和持仓量都为最大的合约，确定为新的主力合约，每日收盘结算后判断，于下一交易日进行指向切换，日内不会进行主力合约的切换。
  3、按照第二条规定产生新的主力合约之前，维持原来的主力合约不变。
  4、若出现当前主力合约的成交量和持仓量都不是最大的情况，当前指向合约在下一个交易日必须让出主力合约身份，金融期货新主力指向成交量最大的合约（中金所），商品期货新主力指向持仓量最大的合约（上期所、大商所、郑商所、上期能源）。

**3.** 次主力连续合约（虚拟合约，由真实合约拼接）：`交易所.品种名 22`对应次主力连续合约 symbol，如 CFFEX.IF22，CFFEX.IC22

- 次主力连续合约切换规则
  1、每个品种只选出唯一一个次主力合约。
  2、金融期货日成交量第二大、或商品期货日持仓量第二大的合约，确定为新的次主力合约，每日收盘结算后判断，于下一交易日进行指向切换，日内不会进行次主力合约的切换。
  3、按照第二条规定产生新的次主力合约之前，维持原来的次主力合约不变。
  4、若金融期货出现当前次主力合约的成交量、或商品期货出现当前次主力合约持仓量不是第二大的情况，当前指向合约在下一个交易日必须让出次主力合约身份，金融期货新主力指向成交量第二大的合约（中金所），商品期货新主力指向持仓量第二大的合约（上期所、大商所、郑商所、上期能源）。

**4.** 月份连续合约（虚拟合约，由真实合约拼接）：`交易所.品种名 月份排序`对应月份连续合约 symbol，如 SHFE.RB00，SHFE.RB01，...，SHFE.RB04（同一品种最多有最近 5 个月的月份连续合约）

- 月份连续合约的切换规则
  1、该品种上市合约按交割月份排序
  2、00 对应最近月份合约，01 对应其后一个合约，02 对应再后一个合约，依次类推
  3、合约最后交易日盘后切换。

**5.** 当`start_date <= end_date`时取指定时间段的数据,当`start_date > end_date`时返回`空list`

---

## 7. 交易函数

### order_volume - 按指定量委托

**函数原型:**

```
order_volume(symbol, volume, side, order_type,position_effect, price=0,order_duration=OrderDuration_Unknown, order_qualifier=OrderQualifier_Unknown,account='')
```

**参数：**

| 参数名          | 类型                               | 说明                                                                                                       |
| :-------------- | :--------------------------------- | :--------------------------------------------------------------------------------------------------------- |
| symbol          | str                                | 标的代码                                                                                                   |
| volume          | int                                | 数量(指股数)                                                                                               |
| side            | int                                | 参见[订单委托方向](python_enum_constant.md#OrderSide - 委托方向 "orderside---委托方向")                    |
| order_type      | int                                | 参见[订单委托类型](python_enum_constant.md#OrderType - 委托类型 "ordertype---委托类型")                    |
| position_effect | int                                | 参见[开平仓类型](python_enum_constant.md#PositionEffect - 开平仓类型 "positioneffect---开平仓类型")        |
| price           | float                              | 价格（限价下单和科创板市价保护价是必填字段）                                                               |
| order_duration  | int                                | 参见[ 委托时间属性](python_enum_constant.md#OrderDuration - 委托时间属性 "orderduration---委托时间属性")   |
| order_qualifier | int                                | 参见[ 委托成交属性](python_enum_constant.md#OrderQualifier - 委托成交属性 "orderqualifier---委托成交属性") |
| account         | account id or account name or None | 帐户                                                                                                       |

**返回值:**

| 类型          | 说明                                                                                 |
| :------------ | :----------------------------------------------------------------------------------- |
| list\[order\] | 委托对象列表，参见[委托](python_object_trade.md#Order - 委托对象 "Order---委托对象") |

**示例：**

```python
order_volume(symbol='SHSE.600000', volume=10000, side=OrderSide_Buy, order_type=OrderType_Limit, position_effect=PositionEffect_Open, price=11)
```

**返回：**

```
[{'strategy_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'account_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'cl_ord_id': '000000000', 'symbol': 'SHSE.600000', 'side': 1, 'position_effect': 1, 'position_side': 1, 'order_type': 1, 'status': 3, 'price': 11.0, 'order_style': 1, 'volume': 10000, 'value': 110000.0, 'percent': 5.5e-05, 'target_volume': 10000, 'target_value': 110000.0, 'target_percent': 5.5e-05, 'filled_volume': 10000, 'filled_vwap': 11.0011, 'filled_amount': 110010.99999999999, 'created_at': datetime.datetime(2020, 9, 1, 9, 40, tzinfo=tzfile('PRC')), 'updated_at': datetime.datetime(2020, 9, 1, 9, 40, tzinfo=tzfile('PRC')), 'filled_commission': 11.0011, 'account_name': '', 'order_id': '', 'ex_ord_id': '', 'algo_order_id': '', 'order_business': 0, 'order_duration': 0, 'order_qualifier': 0, 'order_src': 0, 'position_src': 0, 'ord_rej_reason': 0, 'ord_rej_reason_detail': '', 'stop_price': 0.0}]
```

**注意：**

**1.**仅支持一个标的代码，若交易代码输入有误，终端会拒绝此单，并显示`委托代码不正确`。

**2.**若下单数量输入有误，终端会拒绝此单，并显示`委托量不正确`。股票买入最小单位为`100`，卖出最小单位为`1`,如存在不足 100 股的持仓一次性卖出;期货买卖最小单位为`1`，`向下取整`。

**3.**若仓位不足，终端会拒绝此单，显示`仓位不足`。平仓时股票默认`平昨仓`，期货默认`平今仓`。应研究需要，`股票也支持卖空操作`。

**4.**Order_type 优先级高于 price,若指定 OrderType_Market 下市价单，使用价格为最新一个 tick 中的最新价，price 参数失效。则 price 参数失效。若 OrderTpye_Limit 限价单，仿真模式价格错误，终端拒绝此单，显示委托价格错误，`回测模式下对价格无限制`。

**5.**输入无效参数报`NameError`错误，缺少参数报`TypeError`错误。

**6.**关于`side`与`position_effect`字段的使用说明

做多（买开）：`side=OrderSide_Buy ，position_effect=PositionEffect_Open `
平仓（卖平）：`side=OrderSide_Sell ，position_effect=PositionEffect_Close`

做空（卖开）：`side=OrderSide_Sell ，position_effect=PositionEffect_Open`
平仓（买平）：`side= OrderSide_Buy ，position_effect=PositionEffect_Close`

### order_value - 按指定价值委托

**函数原型:**

```
order_value(symbol, value, side,order_type, position_effect, price=0, order_duration=OrderDuration_Unknown, order_qualifier=OrderQualifier_Unknown,account='')
```

**参数：**

| 参数名          | 类型                               | 说明                                                                                                        |
| :-------------- | :--------------------------------- | :---------------------------------------------------------------------------------------------------------- |
| symbol          | str                                | 标的代码                                                                                                    |
| value           | int                                | 股票价值                                                                                                    |
| side            | int                                | 参见[订单委托方向](python_enum_constant.md#OrderSide - 委托方向 "orderside---委托方向")                     |
| order_type      | int                                | 参见 [订单委托类型](python_enum_constant.md#OrderType - 委托类型 "ordertype---委托类型")                    |
| position_effect | int                                | 参见 [开平仓类型](python_enum_constant.md#PositionEffect - 开平仓类型 "positioneffect---开平仓类型")        |
| price           | float                              | 价格（限价下单和科创板市价保护价是必填字段）                                                                |
| order_duration  | int                                | 参见 [ 委托时间属性](python_enum_constant.md#OrderDuration - 委托时间属性 "OrderDuration - 委托时间属性")   |
| order_qualifier | int                                | 参见 [ 委托成交属性](python_enum_constant.md#OrderQualifier - 委托成交属性 "OrderQualifier - 委托成交属性") |
| account         | account id or account name or None | 帐户                                                                                                        |

**返回值:**

| 类型          | 说明                                                                                 |
| :------------ | :----------------------------------------------------------------------------------- |
| list\[order\] | 委托对象列表，参见[委托](python_object_trade.md#Order - 委托对象 "Order---委托对象") |

**示例：**

下限价单，以 11 元每股的价格买入价值为 100000 的 SHSE.600000,根据 volume = value / price,计算并取整得到 volume = 9000

```python
order_value(symbol='SHSE.600000', value=100000, price=11, side=OrderSide_Buy, order_type=OrderType_Limit, position_effect=PositionEffect_Open)
```

**返回：**

```
[{'strategy_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'account_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'cl_ord_id': '000000000', 'symbol': 'SHSE.600000', 'side': 1, 'position_effect': 1, 'position_side': 1, 'order_type': 1, 'status': 3, 'price': 11.0, 'order_style': 1, 'volume': 9000, 'value': 100000.0, 'percent': 5e-05, 'target_volume': 9000, 'target_value': 99000.0, 'target_percent': 4.95e-05, 'filled_volume': 9000, 'filled_vwap': 11.0011, 'filled_amount': 99009.9, 'created_at': datetime.datetime(2020, 9, 1, 9, 40, tzinfo=tzfile('PRC')), 'updated_at': datetime.datetime(2020, 9, 1, 9, 40, tzinfo=tzfile('PRC')), 'filled_commission': 9.90099, 'account_name': '', 'order_id': '', 'ex_ord_id': '', 'algo_order_id': '', 'order_business': 0, 'order_duration': 0, 'order_qualifier': 0, 'order_src': 0, 'position_src': 0, 'ord_rej_reason': 0, 'ord_rej_reason_detail': '', 'stop_price': 0.0}]
```

**注意：**

**1.**仅支持一个标的代码，若交易代码输入有误，终端会拒绝此单，并显示`委托代码不正确`。

**2.**根据指定价值计算购买标的数量，即`value/price`。股票买卖最小单位为`100`，不足 100 部分`向下取整`，如存在不足 100 的持仓一次性卖出;期货买卖最小单位为`1`，`向下取整`。

**3.**若仓位不足，终端会拒绝此单，显示`仓位不足`。平仓时股票默认`平昨仓`，期货默认`平今仓`。应研究需要，`股票也支持卖空操作`。

**4.**Order_type 优先级高于 price,若指定 OrderType_Market 下市价单,计算使用价格为最新一个 tick 中的最新价，price 参数失效。若 OrderTpye_Limit 限价单，仿真模式价格错误，终端拒绝此单，显示委托价格错误，`回测模式下对价格无限制`。

**5.**输入无效参数报 NameError 错误，缺少参数报 TypeError 错误。

### order_percent - 按总资产指定比例委托

**函数原型:**

```
order_percent(symbol, percent, side,order_type, position_effect, price=0, order_duration=OrderDuration_Unknown, order_qualifier=OrderQualifier_Unknown, account='')
```

**参数：**

| 参数名          | 类型                               | 说明                                                                                                        |
| :-------------- | :--------------------------------- | :---------------------------------------------------------------------------------------------------------- |
| symbol          | str                                | 标的代码                                                                                                    |
| percent         | double                             | 委托占总资产比例                                                                                            |
| side            | int                                | 参见 [订单委托方向](python_enum_constant.md#OrderSide - 委托方向 "orderside---委托方向")                    |
| order_type      | int                                | 参见 [订单委托类型](python_enum_constant.md#OrderType - 委托类型 "ordertype---委托类型")                    |
| position_effect | int                                | 参见 [开平仓类型](python_enum_constant.md#PositionEffect - 开平仓类型 "positioneffect---开平仓类型")        |
| price           | float                              | 价格（限价下单和科创板市价保护价是必填字段）                                                                |
| order_duration  | int                                | 参见 [ 委托时间属性](python_enum_constant.md#OrderDuration - 委托时间属性 "orderduration---委托时间属性")   |
| order_qualifier | int                                | 参见 [ 委托成交属性](python_enum_constant.md#OrderQualifier - 委托成交属性 "orderqualifier---委托成交属性") |
| account         | account id or account name or None | 帐户                                                                                                        |

**返回值:**

| 类型          | 说明                                                                                 |
| :------------ | :----------------------------------------------------------------------------------- |
| list\[order\] | 委托对象列表，参见[委托](python_object_trade.md#Order - 委托对象 "Order---委托对象") |

**示例：**

当前总资产为 1000000。下限价单，以 11 元每股的价格买入 SHSE.600000,期望买入比例占总资产的 10%，根据 volume = nav \* precent / price 计算取整得出 volume = 9000

```python
order_percent(symbol='SHSE.600000', percent=0.1, side=OrderSide_Buy, order_type=OrderType_Limit, position_effect=PositionEffect_Open, price=11)
```

**返回：**

```
[{'strategy_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'account_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'cl_ord_id': '000000000', 'symbol': 'SHSE.600000', 'side': 1, 'position_effect': 1, 'position_side': 1, 'order_type': 1, 'status': 3, 'price': 11.0, 'order_style': 1, 'volume': 18181800, 'value': 200000000.0, 'percent': 0.1, 'target_volume': 18181800, 'target_value': 199999800.0, 'target_percent': 0.0999999, 'filled_volume': 18181800, 'filled_vwap': 11.0011, 'filled_amount': 200019799.98, 'created_at': datetime.datetime(2020, 9, 1, 9, 40, tzinfo=tzfile('PRC')), 'updated_at': datetime.datetime(2020, 9, 1, 9, 40, tzinfo=tzfile('PRC')), 'filled_commission': 20001.979998, 'account_name': '', 'order_id': '', 'ex_ord_id': '', 'algo_order_id': '', 'order_business': 0, 'order_duration': 0, 'order_qualifier': 0, 'order_src': 0, 'position_src': 0, 'ord_rej_reason': 0, 'ord_rej_reason_detail': '', 'stop_price': 0.0}]
```

**注意：**

**1.**仅支持一个标的代码，若交易代码输入有误，终端会拒绝此单，并显示`委托代码不正确`。

**2.**根据指定比例计算购买标的数量,即`(nav*precent)/price`,股票买卖最小单位为`100`，不足 100 部分`向下取整`，如存在不足 100 的持仓一次性卖出;期货买卖最小单位为`1`，`向下取整`。

**3.**若仓位不足，终端会拒绝此单，显示`仓位不足`。平仓时股票默认`平昨仓`，期货默认`平今仓`。应研究需要，`股票也支持卖空操作`。

**4.**Order_type 优先级高于 price,若指定 OrderType_Market 下市价单，计算使用价格为最新一个 tick 中的最新价，price 参数失效。若 OrderTpye_Limit 限价单，仿真模式价格错误，终端拒绝此单，显示委托价格错误，`回测模式下对价格无限制`。

**5.**输入无效参数报 NameError 错误，缺少参数报 TypeError 错误。

**6.**期货实盘时，percent 是以合约上市的初始保证金比例计算得到的，并非实时保证金比例。

### order_target_volume - 调仓到目标持仓量

**函数原型:**

```
order_target_volume(symbol, volume, position_side, order_type, price=0, order_duration=OrderDuration_Unknown, order_qualifier=OrderQualifier_Unknown, account='')
```

**参数：**

| 参数名          | 类型                               | 说明                                                                                                                         |
| :-------------- | :--------------------------------- | :--------------------------------------------------------------------------------------------------------------------------- |
| symbol          | str                                | 标的代码                                                                                                                     |
| volume          | int                                | 期望的最终数量                                                                                                               |
| position_side   | int                                | 表示将多仓还是空仓调到目标持仓量，参见 [持仓方向](python_enum_constant.md#PositionSide - 持仓方向 "positionside---持仓方向") |
| order_type      | int                                | 参见 [订单类型](python_enum_constant.md#OrderType - 委托类型 "ordertype---委托类型")                                         |
| price           | float                              | 价格（限价下单和科创板市价保护价是必填字段）                                                                                 |
| order_duration  | int                                | 参见 [ 委托时间属性](python_enum_constant.md#OrderDuration - 委托时间属性 "orderduration---委托时间属性")                    |
| order_qualifier | int                                | 参见 [ 委托成交属性](python_enum_constant.md#OrderQualifier - 委托成交属性 "orderqualifier---委托成交属性")                  |
| account         | account id or account name or None | 帐户                                                                                                                         |

**返回值:**

| 类型          | 说明                                                                                 |
| :------------ | :----------------------------------------------------------------------------------- |
| list\[order\] | 委托对象列表，参见[委托](python_object_trade.md#Order - 委托对象 "Order---委托对象") |

**示例：**

当前 SHSE.600000 多方向持仓量为 0，期望持仓量为 10000，下单量为期望持仓量 - 当前持仓量 = 10000

```python
order_target_volume(symbol='SHSE.600000', volume=10000, position_side=PositionSide_Long, order_type=OrderType_Limit, price=13)
```

**返回：**

```
[{'strategy_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'account_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'cl_ord_id': '000000000', 'symbol': 'SHSE.600000', 'side': 1, 'position_effect': 1, 'position_side': 1, 'order_type': 1, 'status': 3, 'price': 13.0, 'order_style': 1, 'volume': 10000, 'value': 130000.0, 'percent': 6.5e-05, 'target_volume': 10000, 'target_value': 130000.0, 'target_percent': 6.5e-05, 'filled_volume': 10000, 'filled_vwap': 13.0013, 'filled_amount': 130013.0, 'created_at': datetime.datetime(2020, 9, 1, 9, 40, tzinfo=tzfile('PRC')), 'updated_at': datetime.datetime(2020, 9, 1, 9, 40, tzinfo=tzfile('PRC')), 'filled_commission': 13.0013, 'account_name': '', 'order_id': '', 'ex_ord_id': '', 'algo_order_id': '', 'order_business': 0, 'order_duration': 0, 'order_qualifier': 0, 'order_src': 0, 'position_src': 0, 'ord_rej_reason': 0, 'ord_rej_reason_detail': '', 'stop_price': 0.0}]
```

**注意：**

**1.**仅支持一个标的代码，若交易代码输入有误，订单会被拒绝，`终端无显示，无回报`。回测模式可参看 order_reject_reason。

**2.**根据目标数量计算下单数量，系统判断开平仓类型。若下单数量有误，终端拒绝此单，并显示`委托量不正确`。若实际需要买入数量为 0，则订单会被拒绝，`终端无显示，无回报`。股票买卖最小单位为`100`，不足 100 部分`向下取整`，如存在不足 100 的持仓一次性卖出;期货买卖最小单位为`1`，`向下取整`。

**3.**若仓位不足，终端拒绝此单，显示`仓位不足`。平仓时股票默认`平昨仓`，期货默认`平今仓`,上期所昨仓不能平掉。应研究需要，股票也支持卖空操作。

**4.**Order_type 优先级高于 price,若指定 OrderTpye_Market 下市价单，使用价格为最新一个 tick 中的最新价，price 参数失效。若 OrderTpye_Limit 限价单价格错误，终端拒绝此单，显示委托价格错误。`回测模式下对价格无限制`。

**5.**输入无效参数报 NameError 错误，缺少参数报 Typeerror 错误。

### order_target_value - 调仓到目标持仓额

**函数原型:**

```
order_target_value(symbol, value, position_side, order_type, price=0, order_duration=OrderDuration_Unknown, order_qualifier=OrderQualifier_Unknown, account='')
```

**参数：**

| 参数名          | 类型                               | 说明                                                                                                                        |
| :-------------- | :--------------------------------- | :-------------------------------------------------------------------------------------------------------------------------- |
| symbol          | str                                | 标的代码                                                                                                                    |
| value           | int                                | 期望的股票最终价值                                                                                                          |
| position_side   | int                                | 表示将多仓还是空仓调到目标持仓额，参见[持仓方向](python_enum_constant.md#PositionSide - 持仓方向 "positionside---持仓方向") |
| order_type      | int                                | 参见[订单类型](python_enum_constant.md#OrderType - 委托类型 "ordertype---委托类型")                                         |
| price           | float                              | 价格（限价下单和科创板市价保护价是必填字段）                                                                                |
| order_duration  | int                                | 参见[ 委托时间属性](python_enum_constant.md#OrderDuration - 委托时间属性 "orderduration---委托时间属性")                    |
| order_qualifier | int                                | 参见[ 委托成交属性](python_enum_constant.md#OrderQualifier - 委托成交属性 "orderqualifier---委托成交属性")                  |
| account         | account id or account name or None | 帐户                                                                                                                        |

**返回值:**

| 类型          | 说明                                                                                 |
| :------------ | :----------------------------------------------------------------------------------- |
| list\[order\] | 委托对象列表，参见[委托](python_object_trade.md#Order - 委托对象 "Order---委托对象") |

**示例：**

当前 SHSE.600000 多方向当前持仓量为 0，目标持有价值为 100000 的该股票，根据 value / price 计算取整得出目标持仓量 volume 为 9000，目标持仓量 - 当前持仓量 = 下单量为 9000

```python
order_target_value(symbol='SHSE.600000', value=100000, position_side=PositionSide_Long, order_type=OrderType_Limit, price=11)
```

**返回：**

```
[{'strategy_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'account_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'cl_ord_id': '000000000', 'symbol': 'SHSE.600000', 'side': 1, 'position_effect': 1, 'position_side': 1, 'order_type': 1, 'status': 3, 'price': 11.0, 'order_style': 1, 'volume': 9000, 'value': 100000.0, 'percent': 5e-05, 'target_volume': 9000, 'target_value': 100000.0, 'target_percent': 5e-05, 'filled_volume': 9000, 'filled_vwap': 11.0011, 'filled_amount': 99009.9, 'created_at': datetime.datetime(2020, 9, 1, 9, 40, tzinfo=tzfile('PRC')), 'updated_at': datetime.datetime(2020, 9, 1, 9, 40, tzinfo=tzfile('PRC')), 'filled_commission': 9.90099, 'account_name': '', 'order_id': '', 'ex_ord_id': '', 'algo_order_id': '', 'order_business': 0, 'order_duration': 0, 'order_qualifier': 0, 'order_src': 0, 'position_src': 0, 'ord_rej_reason': 0, 'ord_rej_reason_detail': '', 'stop_price': 0.0}]
```

**注意：**

**1.**仅支持一个标的代码，若交易代码输入有误，订单会被拒绝，`终端无显示，无回报`。回测模式可参看 order_reject_reason。

**2.**根据目标价值计算下单数量，系统判断开平仓类型。若下单数量有误，终端拒绝此单，并显示`委托量不正确`。若实际需要买入数量为 0，则本地拒绝此单，`终端无显示，无回报`。股票买卖最小单位为`100`，不足 100 部分`向下取整`，如存在不足 100 的持仓一次性卖出;期货买卖最小单位为`1`，`向下取整`。

**3.**若仓位不足，终端拒绝此单，显示`仓位不足`。平仓时股票默认`平昨仓`，期货默认`平今仓`，目前不可修改。应研究需要，`股票也支持卖空操作`。

**4.**Order_type 优先级高于 price,若指定 OrderType_Market 下市价单，计算使用价格为最新一个 tick 中的最新价，price 参数失效。若 OrderTpye_Limit 限价单价格错误，终端拒绝此单，显示委托价格错误。`回测模式下对价格无限制`。

**5.**输入无效参数报 NameError 错误，缺少参数报 Typeerror 错误。

### order_target_percent - 调仓到目标持仓比例（总资产的比例）

**函数原型:**

```
order_target_percent(symbol, percent, position_side, order_type, price=0, order_duration=OrderDuration_Unknown, order_qualifier=OrderQualifier_Unknown, account='')
```

**参数：**

| 参数名          | 类型                               | 说明                                                                                                                          |
| :-------------- | :--------------------------------- | :---------------------------------------------------------------------------------------------------------------------------- |
| symbol          | str                                | 标的代码                                                                                                                      |
| percent         | double                             | 期望的最终占总资产比例                                                                                                        |
| position_side   | int                                | 表示将多仓还是空仓调到目标持仓比例，参见[持仓方向](python_enum_constant.md#PositionSide - 持仓方向 "positionside---持仓方向") |
| order_type      | int                                | 参见[订单类型](python_enum_constant.md#OrderType - 委托类型 "ordertype---委托类型")                                           |
| order_duration  | int                                | 参见[ 委托时间属性](python_enum_constant.md#OrderDuration - 委托时间属性 "orderduration---委托时间属性")                      |
| order_qualifier | int                                | 参见[ 委托成交属性](python_enum_constant.md#OrderQualifier - 委托成交属性 "orderqualifier---委托成交属性")                    |
| price           | float                              | 价格（限价下单和科创板市价保护价是必填字段）                                                                                  |
| account         | account id or account name or None | 帐户                                                                                                                          |

**返回值:**

| 类型          | 说明                                                                                 |
| :------------ | :----------------------------------------------------------------------------------- |
| list\[order\] | 委托对象列表，参见[委托](python_object_trade.md#Order - 委托对象 "Order---委托对象") |

**示例：**

当前总资产价值为 1000000，目标为以 11 元每股的价格买入 SHSE.600000 的价值占总资产的 10%，根据 volume = nav \* percent / price 计算取整得出应持有 9000 股。当前该股持仓量为零，因此买入量为 9000

```python
order_target_percent(symbol='SHSE.600000', percent=0.1, position_side=PositionSide_Long, order_type=OrderType_Limit, price=11)
```

**返回：**

```
[{'strategy_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'account_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'cl_ord_id': '000000000', 'symbol': 'SHSE.600000', 'side': 1, 'position_effect': 1, 'position_side': 1, 'order_type': 1, 'status': 3, 'price': 11.0, 'order_style': 1, 'volume': 18181800, 'value': 200000000.0, 'percent': 0.1, 'target_volume': 18181800, 'target_value': 199999800.0, 'target_percent': 0.1, 'filled_volume': 18181800, 'filled_vwap': 11.0011, 'filled_amount': 200019799.98, 'created_at': datetime.datetime(2020, 9, 1, 9, 40, tzinfo=tzfile('PRC')), 'updated_at': datetime.datetime(2020, 9, 1, 9, 40, tzinfo=tzfile('PRC')), 'filled_commission': 20001.979998, 'account_name': '', 'order_id': '', 'ex_ord_id': '', 'algo_order_id': '', 'order_business': 0, 'order_duration': 0, 'order_qualifier': 0, 'order_src': 0, 'position_src': 0, 'ord_rej_reason': 0, 'ord_rej_reason_detail': '', 'stop_price': 0.0}]
```

**注意：**

**1.**仅支持一个标的代码，若交易代码输入有误，订单会被拒绝，`终端无显示，无回报`。回测模式可参看 order_reject_reason。

**2.**根据目标比例计算下单数量，为占`总资产(nav）`比例，系统判断开平仓类型。若下单数量有误，终端拒绝此单，并显示`委托量不正确`。若实际需要买入数量为 0，则本地拒绝此单，`终端无显示，无回报`。股票买卖最小单位为`100`，不足 100 部分`向下取整`，如存在不足 100 的持仓一次性卖出;期货买卖最小单位为`1`，`向下取整`。

**3.**若仓位不足，终端拒绝此单，`显示仓位不足`。平仓时股票默认`平昨仓`，期货默认`平今仓`，目前不可修改。应研究需要，`股票也支持卖空操作`。

**4.**Order_type 优先级高于 price,若指定 OrderType_Market 下市价单，计算使用价格为最新一个 tick 中的最新价，price 参数失效。若 OrderTpye_Limit 限价单价格错误，终端拒绝此单，显示委托价格错误。`回测模式下对价格无限制`。

**5.**输入无效参数报 NameError 错误，缺少参数报 Typeerror 错误。

**6.**期货实盘时，percent 是以合约上市的初始保证金比例计算得到的，并非实时保证金比例。

### order_batch - 批量委托接口

**函数原型:**

```
order_batch(orders, combine=False, account='')
```

**参数：**

| 参数名  | 类型                               | 说明                                                                                                                   |
| :------ | :--------------------------------- | :--------------------------------------------------------------------------------------------------------------------- |
| orders  | list\[order\]                      | 委托对象列表，其中委托至少包含交易接口的必选参数，参见[委托](python_object_trade.md#Order - 委托对象 "Order 委托对象") |
| combine | bool                               | 是否是组合单, 默认不是（预留字段，目前无效）                                                                           |
| account | account id or account name or None | 帐户                                                                                                                   |

**返回值:**

| 类型          | 说明                                                                                 |
| :------------ | :----------------------------------------------------------------------------------- |
| list\[order\] | 委托对象列表，参见[委托](python_object_trade.md#Order - 委托对象 "Order---委托对象") |

**示例：**

```python
    order_1 = {'symbol': 'SHSE.600000', 'volume': 100, 'price': 11, 'side': 1,
               'order_type': 2, 'position_effect':1}
    order_2 = {'symbol': 'SHSE.600004', 'volume': 100, 'price': 11, 'side': 1,
               'order_type': 2, 'position_effect':1}
    orders = [order_1, order_2]
    batch_orders = order_batch(orders, combine=True)
    for order in batch_orders:
        print(order)
```

**返回：**

```json
{'strategy_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'account_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'cl_ord_id': '000000000', 'symbol': 'SHSE.600000', 'side': 1, 'position_effect': 1, 'order_type': 2, 'status': 3, 'price': 10.280000686645508, 'order_style': 1, 'volume': 100, 'filled_volume': 100, 'filled_vwap': 10.281028686714173, 'filled_amount': 1028.1028686714174, 'created_at': datetime.datetime(2020, 9, 1, 9, 40, tzinfo=tzfile('PRC')), 'updated_at': datetime.datetime(2020, 9, 1, 9, 40, tzinfo=tzfile('PRC')), 'filled_commission': 0.10281028686714173, 'account_name': '', 'order_id': '', 'ex_ord_id': '', 'algo_order_id': '', 'position_side': 0, 'order_business': 0, 'order_duration': 0, 'order_qualifier': 0, 'order_src': 0, 'position_src': 0, 'ord_rej_reason': 0, 'ord_rej_reason_detail': '', 'stop_price': 0.0, 'value': 0.0, 'percent': 0.0, 'target_volume': 0, 'target_value': 0.0, 'target_percent': 0.0}
{'strategy_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'account_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'cl_ord_id': '000000001', 'symbol': 'SHSE.600004', 'side': 1, 'position_effect': 1, 'order_type': 2, 'status': 3, 'price': 15.050000190734863, 'order_style': 1, 'volume': 100, 'filled_volume': 100, 'filled_vwap': 15.051505190753936, 'filled_amount': 1505.1505190753935, 'created_at': datetime.datetime(2020, 9, 1, 9, 40, tzinfo=tzfile('PRC')), 'updated_at': datetime.datetime(2020, 9, 1, 9, 40, tzinfo=tzfile('PRC')), 'filled_commission': 0.15051505190753936, 'account_name': '', 'order_id': '', 'ex_ord_id': '', 'algo_order_id': '', 'position_side': 0, 'order_business': 0, 'order_duration': 0, 'order_qualifier': 0, 'order_src': 0, 'position_src': 0, 'ord_rej_reason': 0, 'ord_rej_reason_detail': '', 'stop_price': 0.0, 'value': 0.0, 'percent': 0.0, 'target_volume': 0, 'target_value': 0.0, 'target_percent': 0.0}
{'strategy_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'account_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'cl_ord_id': '000000002', 'symbol': 'SHSE.600000', 'side': 1, 'position_effect': 1, 'order_type': 2, 'status': 3, 'price': 10.180000305175781, 'order_style': 1, 'volume': 100, 'filled_volume': 100, 'filled_vwap': 10.1810183052063, 'filled_amount': 1018.10183052063, 'created_at': datetime.datetime(2020, 9, 2, 9, 40, tzinfo=tzfile('PRC')), 'updated_at': datetime.datetime(2020, 9, 2, 9, 40, tzinfo=tzfile('PRC')), 'filled_commission': 0.101810183052063, 'account_name': '', 'order_id': '', 'ex_ord_id': '', 'algo_order_id': '', 'position_side': 0, 'order_business': 0, 'order_duration': 0, 'order_qualifier': 0, 'order_src': 0, 'position_src': 0, 'ord_rej_reason': 0, 'ord_rej_reason_detail': '', 'stop_price': 0.0, 'value': 0.0, 'percent': 0.0, 'target_volume': 0, 'target_value': 0.0, 'target_percent': 0.0}
{'strategy_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'account_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'cl_ord_id': '000000003', 'symbol': 'SHSE.600004', 'side': 1, 'position_effect': 1, 'order_type': 2, 'status': 3, 'price': 14.819999694824219, 'order_style': 1, 'volume': 100, 'filled_volume': 100, 'filled_vwap': 14.8214816947937, 'filled_amount': 1482.14816947937, 'created_at': datetime.datetime(2020, 9, 2, 9, 40, tzinfo=tzfile('PRC')), 'updated_at': datetime.datetime(2020, 9, 2, 9, 40, tzinfo=tzfile('PRC')), 'filled_commission': 0.148214816947937, 'account_name': '', 'order_id': '', 'ex_ord_id': '', 'algo_order_id': '', 'position_side': 0, 'order_business': 0, 'order_duration': 0, 'order_qualifier': 0, 'order_src': 0, 'position_src': 0, 'ord_rej_reason': 0, 'ord_rej_reason_detail': '', 'stop_price': 0.0, 'value': 0.0, 'percent': 0.0, 'target_volume': 0, 'target_value': 0.0, 'target_percent': 0.0}
```

**注意：**

**1.**每个 order 的 symbol 仅支持一个标的代码，若交易代码输入有误，终端会拒绝此单，并显示`委托代码不正确`。

**2.**若下单数量输入有误，终端会拒绝此单，并显示`委托量不正确`。`下单数量严格按照指定数量下单`，需注意股票买入最小单位为 100。

**3.**若仓位不足，终端会拒绝此单，`显示仓位不足`。应研究需要，`股票也支持卖空操作`。

**4.**Order_type 优先级高于 price,若指定 OrderType_Market 下市价单，则 price 参数失效。若 OrderTpye_Limit 限价单，仿真模式价格错误，终端拒绝此单，显示委托价格错误，`回测模式下对价格无限制`。

**5.**输入无效参数报 NameError 错误，缺少参数不报错，可能会出现下单被拒。

### order_cancel - 撤销委托

**函数原型:**

```
order_cancel(wait_cancel_orders)
```

**参数：**

| 参数名             | 类型         | 说明                                                                                                                                           |
| :----------------- | :----------- | :--------------------------------------------------------------------------------------------------------------------------------------------- |
| wait_cancel_orders | list\[dict\] | 传入单个字典. 或者 list 字典. 每个字典包含 key: cl_ord_id, account_id， 参见[委托](python_object_trade.md#Order - 委托对象 "Order---委托对象") |

**示例：**

```python
order_1 = {'cl_ord_id': order1['cl_ord_id'], 'account_id': order1['account_id']}
order_2 = {'cl_ord_id': order2['cl_ord_id'], 'account_id': order2['account_id']}
orders = [order_1, order_2]
order_cancel(wait_cancel_orders=orders)

```

### order_cancel_all - 撤销所有委托

**函数原型:**

```
order_cancel_all()
```

**示例：**

```python
order_cancel_all()
```

### order_close_all - 平当前所有可平持仓

**注意:**不支持市价委托类型的委托，会被柜台拒绝

**函数原型:**

```
order_close_all()
```

**示例：**

```python
order_close_all()
```

### get_unfinished_orders - 查询日内全部未结委托

**函数原型:**

```
get_unfinished_orders()
```

**返回值:**

| 类型          | 说明                                                                                 |
| :------------ | :----------------------------------------------------------------------------------- |
| list\[order\] | 委托对象列表，参见[委托](python_object_trade.md#Order - 委托对象 "Order---委托对象") |

**示例：**

```python
get_unfinished_orders()
```

**返回：**

```python
[{'strategy_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'account_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'cl_ord_id': '000000000', 'symbol': 'SHSE.600519', 'side': 1, 'position_effect': 1, 'position_side': 1, 'order_type': 2, 'status': 3, 'price': 1792.0, 'order_style': 1, 'volume': 100, 'value': 179200.0, 'percent': 8.96e-05, 'target_volume': 100, 'target_value': 179200.0, 'target_percent': 8.96e-05, 'filled_volume': 100, 'filled_vwap': 1792.1792, 'filled_amount': 179217.92, 'created_at': datetime.datetime(2020, 9, 1, 9, 40, tzinfo=tzfile('PRC')), 'updated_at': datetime.datetime(2020, 9, 1, 9, 40, tzinfo=tzfile('PRC')), 'filled_commission': 17.921792000000003, 'account_name': '', 'order_id': '', 'ex_ord_id': '', 'algo_order_id': '', 'order_business': 0, 'order_duration': 0, 'order_qualifier': 0, 'order_src': 0, 'position_src': 0, 'ord_rej_reason': 0, 'ord_rej_reason_detail': '', 'stop_price': 0.0}]
```

### get_orders - 查询日内全部委托

**函数原型:**

```
get_orders()
```

**返回值:**

| 类型          | 说明                                                                                 |
| :------------ | :----------------------------------------------------------------------------------- |
| list\[order\] | 委托对象列表，参见[委托](python_object_trade.md#Order - 委托对象 "Order---委托对象") |

**示例：**

```python
get_orders()
```

**返回：**

```
[{'strategy_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'account_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'cl_ord_id': '000000000', 'symbol': 'SHSE.600519', 'side': 1, 'position_effect': 1, 'position_side': 1, 'order_type': 2, 'status': 3, 'price': 1792.0, 'order_style': 1, 'volume': 100, 'value': 179200.0, 'percent': 8.96e-05, 'target_volume': 100, 'target_value': 179200.0, 'target_percent': 8.96e-05, 'filled_volume': 100, 'filled_vwap': 1792.1792, 'filled_amount': 179217.92, 'created_at': datetime.datetime(2020, 9, 1, 9, 40, tzinfo=tzfile('PRC')), 'updated_at': datetime.datetime(2020, 9, 1, 9, 40, tzinfo=tzfile('PRC')), 'filled_commission': 17.921792000000003, 'account_name': '', 'order_id': '', 'ex_ord_id': '', 'algo_order_id': '', 'order_business': 0, 'order_duration': 0, 'order_qualifier': 0, 'order_src': 0, 'position_src': 0, 'ord_rej_reason': 0, 'ord_rej_reason_detail': '', 'stop_price': 0.0}]
```

### get_execution_reports - 查询日内全部执行回报

**函数原型:**

```
get_execution_reports()
```

**返回值:**

| 类型            | 说明                                                                                          |
| :-------------- | :-------------------------------------------------------------------------------------------- |
| list\[execrpt\] | 回报对象列表， 参见[成交回报](python_object_trade.md#ExecRpt - 回报对象 "ExecRpt---回报对象") |

**示例：**

```python
get_execution_reports()
```

**返回：**

```python
[{'strategy_id': '004beb61-1282-11eb-9313-00ff5a669ee2', 'account_id': '3acc8b6e-af54-11e9-b2de-00163e0a4100', 'account_name': '3acc8b6e-af54-11e9-b2de-00163e0a4100', 'cl_ord_id': '49764a82-14fb-11eb-89df-00ff5a669ee2', 'order_id': '4a06f925-14fb-11eb-9e8a-00163e0a4100', 'exec_id': '573b108b-14fb-11eb-9e8a-00163e0a4100', 'symbol': 'SHSE.600714', 'position_effect': 1, 'side': 1, 'exec_type': 15, 'price': 5.579999923706055, 'volume': 900, 'amount': 5021.999931335449, 'created_at': datetime.datetime(2020, 10, 23, 14, 45, 29, 776756, tzinfo=tzfile('PRC')), 'commission': 5.0, 'cost': 5021.999931335449, 'ord_rej_reason': 0, 'ord_rej_reason_detail': ''}]

```

---

## 8. 交易查询函数

### context.account().positions() - 查询当前账户全部持仓

**原型：**

```
context.account(account_id=None).positions()
```

**参数：**

| 参数名     | 类型 | 说明                                                    |
| :--------- | :--- | :------------------------------------------------------ |
| account_id | str  | 账户信息，默认返回默认账户, 如多个账户需指定 account_id |

**返回值：**

| 类型           | 说明                                                                             |
| :------------- | :------------------------------------------------------------------------------- |
| list[position] | [持仓对象](python_object_trade.md#Position - 持仓对象 "Position - 持仓对象")列表 |

**注意：**没有持仓时，返回空列表

_示例-获取当前持仓：_

```python
# 所有持仓
Account_positions = context.account().positions()

```

**输出**

```
% 所有持仓输出
[{'account_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'symbol': 'SHSE.600419', 'side': 1, 'volume': 2200, 'volume_today': 100, 'vwap': 16.43391600830338, 'amount': 36154.61521826744, 'fpnl': -2362.6138754940007, 'cost': 36154.61521826744, 'available': 2200, 'available_today': 100, 'created_at': datetime.datetime(2020, 9, 1, 9, 40, tzinfo=tzfile('PRC')), 'updated_at': datetime.datetime(2020, 9, 30, 9, 40, tzinfo=tzfile('PRC')), 'account_name': '', 'vwap_diluted': 0.0, 'price': 0.0, 'order_frozen': 0, 'order_frozen_today': 0, 'available_now': 0, 'market_value': 0.0, 'last_price': 0.0, 'last_volume': 0, 'last_inout': 0, 'change_reason': 0, 'change_event_id': '', 'has_dividend': 0}, {'account_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'symbol': 'SHSE.600519', 'side': 1, 'volume': 1100, 'vwap': 1752.575242219682, 'amount': 1927832.7664416502, 'fpnl': -110302.84700805641, 'cost': 1927832.7664416502, 'available': 1100, 'created_at': datetime.datetime(2020, 9, 1, 9, 40, tzinfo=tzfile('PRC')), 'updated_at': datetime.datetime(2020, 9, 15, 9, 40, tzinfo=tzfile('PRC')), 'account_name': '', 'volume_today': 0, 'vwap_diluted': 0.0, 'price': 0.0, 'order_frozen': 0, 'order_frozen_today': 0, 'available_today': 0, 'available_now': 0, 'market_value': 0.0, 'last_price': 0.0, 'last_volume': 0, 'last_inout': 0, 'change_reason': 0, 'change_event_id': '', 'has_dividend': 0}]
```

### context.account().position(symbol, side) - 查询当前账户指定持仓

**参数：**

| 参数名 | 类型 | 说明                                                                                                        |
| :----- | :--- | :---------------------------------------------------------------------------------------------------------- |
| symbol | str  | 标的代码                                                                                                    |
| side   | int  | 持仓方向，取值参考[PositionSide](python_enum_constant.md#PositionSide - 持仓方向 "PositionSide - 持仓方向") |

**返回值：**

| 类型           | 说明                                                                             |
| :------------- | :------------------------------------------------------------------------------- |
| dict[position] | [持仓对象](python_object_trade.md#Position - 持仓对象 "Position - 持仓对象")列表 |

** 注意：** 当指定标的没有持仓时，返回 None
_示例-获取当前持仓：_

```python
# 指定持仓
Account_position = context.account().position(symbol='SHSE.600519',side = PositionSide_Long)
```

**输出**

```
# 指定持仓输出
{'account_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'symbol': 'SHSE.600519', 'side': 1, 'volume': 1100, 'vwap': 1752.575242219682, 'amount': 1927832.7664416502, 'fpnl': -110302.84700805641, 'cost': 1927832.7664416502, 'available': 1100, 'created_at': datetime.datetime(2020, 9, 1, 9, 40, tzinfo=tzfile('PRC')), 'updated_at': datetime.datetime(2020, 9, 15, 9, 40, tzinfo=tzfile('PRC')), 'account_name': '', 'volume_today': 0, 'vwap_diluted': 0.0, 'price': 0.0, 'order_frozen': 0, 'order_frozen_today': 0, 'available_today': 0, 'available_now': 0, 'market_value': 0.0, 'last_price': 0.0, 'last_volume': 0, 'last_inout': 0, 'change_reason': 0, 'change_event_id': '', 'has_dividend': 0}
```

### context.account().cash - 查询当前账户资金

**原型：**

```
context.account(account_id=None).cash
```

**参数：**

| 参数名     | 类型 | 说明                                                    |
| :--------- | :--- | :------------------------------------------------------ |
| account_id | str  | 账户信息，默认返回默认账户, 如多个账户需指定 account_id |

**返回值：**

| 类型       | 说明                                                                     |
| :--------- | :----------------------------------------------------------------------- |
| dict[cash] | [资金对象](python_object_trade.md#Cash - 资金对象 "Cash - 资金对象")列表 |

_示例-获取当前账户资金：_

```python
context.account().cash
```

**输出**

```json
{'account_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'nav': 1905248.2789094353, 'pnl': -94751.72109056474, 'fpnl': -94555.35135529494, 'frozen': 1963697.3526980684, 'available': 36106.277566661825, 'cum_inout': 2000000.0, 'cum_trade': 1963697.3526980684, 'cum_commission': 196.3697352698069, 'last_trade': 1536.1536610412597, 'last_commission': 0.153615366104126, 'created_at': datetime.datetime(2020, 9, 1, 8, 0, tzinfo=tzfile('PRC')), 'updated_at': datetime.datetime(2020, 9, 30, 9, 40, tzinfo=tzfile('PRC')), 'account_name': '', 'currency': 0, 'order_frozen': 0.0, 'balance': 0.0, 'market_value': 0.0, 'cum_pnl': 0.0, 'last_pnl': 0.0, 'last_inout': 0.0, 'change_reason': 0, 'change_event_id': ''}
```

---

## 9. 两融交易函数

### 两融 SDK

python 两融 SDK 包含在 gm3.0.126 版本及以上版本，不需要引入新库
融资融券暂时仅支持实盘委托，不支持仿真交易

---

### credit_buying_on_margin - 融资买入

**函数原型：**

```
credit_buying_on_margin(position_src, symbol, volume, price, order_type=OrderType_Limit, order_duration=OrderDuration_Unknown,
                            order_qualifier=OrderQualifier_Unknown, account_id='')
```

**参数：**

| 参数名          | 类型  | 说明                                                                                                                                                                                                                                                                                                                                                 |
| --------------- | ----- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| symbol          | str   | 标的代码                                                                                                                                                                                                                                                                                                                                             |
| volume          | int   | 数量                                                                                                                                                                                                                                                                                                                                                 |
| price           | float | 价格                                                                                                                                                                                                                                                                                                                                                 |
| position_src    | int   | 头寸来源 取值参考 [PositionSrc](https://www.myquant.cn/docs/python/python_enum_constant.html#2ca2b0893c0fd1fa:~:text=6%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%E9%94%99%E8%AF%AF-,PositionSrc%20%2D%20%E5%A4%B4%E5%AF%B8%E6%9D%A5%E6%BA%90(%E4%BB%85%E9%80%82%E7%94%A8%E8%9E%8D%E5%88%B8%E8%9E%8D%E5%88%B8) |
| order_type      | int   | 委托类型 取值参考 [OrderType](python_enum_constant.md#OrderType - 委托类型 "OrderType - 委托类型")                                                                                                                                                                                                                                                   |
| order_duration  | int   | 委托时间属性 取值参考 [OrderDuration](python_enum_constant.md#OrderDuration - 委托时间属性 "OrderDuration - 委托时间属性")                                                                                                                                                                                                                           |
| order_qualifier | int   | 委托成交属性 取值参考 [OrderQualifier](python_enum_constant.md#OrderQualifier - 委托成交属性 "OrderQualifier - 委托成交属性")                                                                                                                                                                                                                        |
| account_id      | str   | 账号 id，不填或留空，表示使用默认账号，否则使用指定账号                                                                                                                                                                                                                                                                                              |

**返回值：**

请参考 [order](python_object_trade.md#Order - 委托对象 "Order---委托对象") 返回值字段说明

**示例代码**

```
credit_buying_on_margin(position_src=PositionSrc_L1, symbol='SHSE.600000', volume=100, price=10.67)
```

**示例返回值**

```
strategy_id                          account_id                           cl_ord_id                            symbol      order_type status price volume created_at                                                              order_business account_name order_id ex_ord_id algo_order_id side position_effect position_side order_duration order_qualifier order_src ord_rej_reason ord_rej_reason_detail stop_price order_style value percent target_volume target_value target_percent filled_volume filled_vwap filled_amount filled_commission updated_at
------------------------------------ ------------------------------------ ------------------------------------ ----------- ---------- ------ ----- ------ ----------------------------------------------------------------------- -------------- ------------ -------- --------- ------------- ---- --------------- ------------- -------------- --------------- --------- -------------- --------------------- ---------- ----------- ----- ------- ------------- ------------ -------------- ------------- ----------- ------------- ----------------- ----------
3af55cb8-a7c5-11ea-b510-309c231d28bd 8f30e83f-a7c5-11ea-b510-309c231d28bd 2b853062-a7c9-11ea-b510-309c231d28bd SHSE.600000 1          10     10.67 100    datetime.datetime(2020, 6, 6, 15, 41, 44, 863549, tzinfo=tzfile('PRC')) 200                                                          0    0               0              0             0               0         0                                    0          0           0.0   0.0     0             0.0          0.0            0             0.0         0.0           0.0               None
```

### credit_short_selling - 融券卖出

**函数原型**

```
credit_short_selling(position_src, symbol, volume, price, order_type=OrderType_Limit, order_duration=OrderDuration_Unknown,
                         order_qualifier=OrderQualifier_Unknown, account_id='')
```

**参数：**

| 参数名          | 类型  | 说明                                                                                                                                                                                                                                                                                                                                                 |
| --------------- | ----- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| symbol          | str   | 标的代码                                                                                                                                                                                                                                                                                                                                             |
| volume          | int   | 数量                                                                                                                                                                                                                                                                                                                                                 |
| price           | float | 价格                                                                                                                                                                                                                                                                                                                                                 |
| position_src    | int   | 头寸来源 取值参考 [PositionSrc](https://www.myquant.cn/docs/python/python_enum_constant.html#2ca2b0893c0fd1fa:~:text=6%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%E9%94%99%E8%AF%AF-,PositionSrc%20%2D%20%E5%A4%B4%E5%AF%B8%E6%9D%A5%E6%BA%90(%E4%BB%85%E9%80%82%E7%94%A8%E8%9E%8D%E5%88%B8%E8%9E%8D%E5%88%B8) |
| order_type      | int   | 委托类型 取值参考 [OrderType](python_enum_constant.md#OrderType - 委托类型 "OrderType - 委托类型")                                                                                                                                                                                                                                                   |
| order_duration  | int   | 委托时间属性 取值参考 [OrderDuration](python_enum_constant.md#OrderDuration - 委托时间属性 "OrderDuration - 委托时间属性")                                                                                                                                                                                                                           |
| order_qualifier | int   | 委托成交属性 取值参考 [OrderQualifier](python_enum_constant.md#OrderQualifier - 委托成交属性 "OrderQualifier - 委托成交属性")                                                                                                                                                                                                                        |
| account_id      | str   | 账号 id，不填或留空，表示使用默认账号，否则使用指定账号                                                                                                                                                                                                                                                                                              |

**返回值：**

请参考 [order](python_object_trade.md#Order - 委托对象 "Order---委托对象") 返回值字段说明

**示例代码**

```
credit_short_selling(position_src=PositionSrc_L1, symbol='SHSE.600000', volume=100, price=10.67, order_type=OrderType_Limit,
                               order_duration=OrderDuration_Unknown,
                               order_qualifier=OrderQualifier_Unknown, account_id='')
```

**示例返回值**

```
strategy_id                          account_id                           cl_ord_id                            symbol      order_type status price volume created_at                                                              order_business account_name order_id ex_ord_id algo_order_id side position_effect position_side order_duration order_qualifier order_src ord_rej_reason ord_rej_reason_detail stop_price order_style value percent target_volume target_value target_percent filled_volume filled_vwap filled_amount filled_commission updated_at
------------------------------------ ------------------------------------ ------------------------------------ ----------- ---------- ------ ----- ------ ----------------------------------------------------------------------- -------------- ------------ -------- --------- ------------- ---- --------------- ------------- -------------- --------------- --------- -------------- --------------------- ---------- ----------- ----- ------- ------------- ------------ -------------- ------------- ----------- ------------- ----------------- ----------
3af55cb8-a7c5-11ea-b510-309c231d28bd 8f30e83f-a7c5-11ea-b510-309c231d28bd 2b853062-a7c9-11ea-b510-309c231d28bd SHSE.600000 1          10     10.67 100    datetime.datetime(2020, 6, 6, 15, 41, 44, 863549, tzinfo=tzfile('PRC')) 201                                                          0    0               0              0             0               0         0                                    0.0        0           0.0   0.0     0             0.0          0.0            0             0.0         0.0           0.0               None
```

### credit_repay_cash_directly - 直接还款

**函数原型：**

```
credit_repay_cash_directly(amount, account_id='')
```

**参数：**

| 参数名     | 类型  | 说明                                                    |
| ---------- | ----- | ------------------------------------------------------- |
| amount     | float | 还款金额                                                |
| account_id | str   | 账号 id，不填或留空，表示使用默认账号，否则使用指定账号 |

**返回值：`dict`
**

| 字段                | 类型  | 说明         |
| ------------------- | ----- | ------------ |
| actual_repay_amount | float | 实际还款金额 |
| account_id          | str   | 账号 id      |
| account_name        | str   | 账户名称     |

**示例代码：**

```
credit_repay_cash_directly(amount=10000.00, account_id='')
```

**示例返回值：**

```
actual_repay_amount account_id                           account_name
------------------- ------------------------------------ ------------
10000.0             8f30e83f-a7c5-11ea-b510-309c231d28bd 001515018318
```

### credit_repay_share_directly - 直接还券

**函数原型**

```
credit_repay_share_directly(symbol, volume, account_id='')
```

**参数：**

| 参数名     | 类型 | 说明                                                    |
| ---------- | ---- | ------------------------------------------------------- |
| symbol     | str  | 标的代码                                                |
| volume     | int  | 数量                                                    |
| account_id | str  | 账号 id，不填或留空，表示使用默认账号，否则使用指定账号 |

**返回值：`[dict]`**

请参考 [order](python_object_trade.md#Order - 委托对象 "Order---委托对象") 返回值字段说明

**示例代码**

```
credit_repay_share_directly(symbol='SHSE.600000', volume=100, account_id='')
```

**示例返回值**

```
strategy_id                          account_id                           cl_ord_id                            symbol      order_type status volume created_at                                                              order_business account_name order_id ex_ord_id algo_order_id side position_effect position_side order_duration order_qualifier order_src ord_rej_reason ord_rej_reason_detail price stop_price order_style value percent target_volume target_value target_percent filled_volume filled_vwap filled_amount filled_commission updated_at
------------------------------------ ------------------------------------ ------------------------------------ ----------- ---------- ------ ------ ----------------------------------------------------------------------- -------------- ------------ -------- --------- ------------- ---- --------------- ------------- -------------- --------------- --------- -------------- --------------------- ----- ---------- ----------- ----- ------- ------------- ------------ -------------- ------------- ----------- ------------- ----------------- ----------
3af55cb8-a7c5-11ea-b510-309c231d28bd 8f30e83f-a7c5-11ea-b510-309c231d28bd 2b86685e-a7c9-11ea-b510-309c231d28bd SHSE.600000 1          10     100    datetime.datetime(2020, 6, 6, 15, 41, 44, 871536, tzinfo=tzfile('PRC')) 204                                                          0    0               0             0              0               0         0                                    0.0   0.0        0           0.0   0.0     0             0.0          0.0            0             0.0         0.0           0.0               None
........ ......
```

### credit_get_collateral_instruments - 查询担保证券

查询担保证券，可做担保品股票列表

**函数原型：**

```
credit_get_collateral_instruments(account_id='', df=False)
```

**参数：**

| 参数名     | 类型 | 说明                                                     |
| ---------- | ---- | -------------------------------------------------------- |
| account_id | str  | 账号 id，不填或留空，表示使用默认账号，否则使用指定账号  |
| df         | bool | 是否返回`dataframe`格式数据。默认 False, 返回 list[dict] |

**返回值：**

| 字段        | 类型  | 说明   |
| ----------- | ----- | ------ |
| symbol      | str   | 标的   |
| pledge_rate | float | 折算率 |

**示例代码**

```
credit_get_collateral_instruments(account_id='', df=False)
```

**示例返回值**

```
symbol      pledge_rate
----------- -----------
SHSE.010107  0.9
SHSE.010303  0.9
..........   ...
```

### credit_get_borrowable_instruments - 查询可融标的证券

查询标的证券，可做融券标的股票列表

**函数原型：**

```
credit_get_borrowable_instruments(position_src, account_id='', df=False)
```

**参数：**

| 参数名       | 类型 | 说明                                                                                                                                                                                                                                                                                                                                                 |
| ------------ | ---- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| position_src | int  | 头寸来源 取值参考 [PositionSrc](https://www.myquant.cn/docs/python/python_enum_constant.html#2ca2b0893c0fd1fa:~:text=6%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%E9%94%99%E8%AF%AF-,PositionSrc%20%2D%20%E5%A4%B4%E5%AF%B8%E6%9D%A5%E6%BA%90(%E4%BB%85%E9%80%82%E7%94%A8%E8%9E%8D%E5%88%B8%E8%9E%8D%E5%88%B8) |
| account_id   | str  | 账号 id，不填或留空，表示使用默认账号，否则使用指定账号                                                                                                                                                                                                                                                                                              |
| df           | bool | 是否返回`dataframe`格式数据。默认 False, 返回 list[dict]                                                                                                                                                                                                                                                                                             |

**返回值：`list[dict]`**

| 字段                     | 类型  | 说明           |
| ------------------------ | ----- | -------------- |
| symbol                   | str   | 标的           |
| margin_rate_for_cash     | float | 融资保证金比率 |
| margin_rate_for_security | float | 融券保证金比率 |

**示例代码**

```
credit_get_borrowable_instruments(position_src=PositionSrc_L1, account_id='', df=False)
```

**示例返回值**

```
symbol      margin_rate_for_cash margin_rate_for_security
----------- -------------------- ------------------------
SHSE.510050  1.0                  0.6
SHSE.510160  1.0                  0.6
...........  ...                  ...
```

### credit_get_borrowable_instruments_positions - 查询券商融券账户头寸

查询券商融券账户头寸，可用融券的数量

**函数原型：**

```
credit_get_borrowable_instruments_positions(position_src, account_id='', df=False)
```

**参数：**

| 参数名       | 类型 | 说明                                                                                                                                                                                                                                                                                                                                                 |
| ------------ | ---- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| position_src | int  | 头寸来源 取值参考 [PositionSrc](https://www.myquant.cn/docs/python/python_enum_constant.html#2ca2b0893c0fd1fa:~:text=6%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%E9%94%99%E8%AF%AF-,PositionSrc%20%2D%20%E5%A4%B4%E5%AF%B8%E6%9D%A5%E6%BA%90(%E4%BB%85%E9%80%82%E7%94%A8%E8%9E%8D%E5%88%B8%E8%9E%8D%E5%88%B8) |
| account_id   | str  | 账号 id，不填或留空，表示使用默认账号，否则使用指定账号                                                                                                                                                                                                                                                                                              |
| df           | bool | 是否返回`dataframe`格式数据。默认 False, 返回 list[dict]                                                                                                                                                                                                                                                                                             |

**返回值：**
当 df = True 时， 返回`dataframe`
当 df = False 时， 返回`list[dict]`

| 字段      | 类型  | 说明         |
| --------- | ----- | ------------ |
| symbol    | str   | 标的         |
| balance   | float | 证券余额     |
| available | float | 证券可用金额 |

**示例代码**

```
credit_get_borrowable_instruments_positions(position_src=PositionSrc_L1, account_id='', df=False)
```

**示例返回值**

```
symbol      balance available
----------- ------- -----------
SHSE.600166  700.0   700.0
SHSE.688002  2000.0  2000.0
..........   ......  ......
```

### credit_get_contracts - 查询融资融券合约

**函数原型：**

```
credit_get_contracts(position_src, account_id='', df=False)
```

**参数：**

| 参数名       | 类型 | 说明                                                                                                                                                                                                                                                                                                                                                 |
| ------------ | ---- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| position_src | int  | 头寸来源 取值参考 [PositionSrc](https://www.myquant.cn/docs/python/python_enum_constant.html#2ca2b0893c0fd1fa:~:text=6%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%E9%94%99%E8%AF%AF-,PositionSrc%20%2D%20%E5%A4%B4%E5%AF%B8%E6%9D%A5%E6%BA%90(%E4%BB%85%E9%80%82%E7%94%A8%E8%9E%8D%E5%88%B8%E8%9E%8D%E5%88%B8) |
| account_id   | str  | 账号 id，不填或留空，表示使用默认账号，否则使用指定账号                                                                                                                                                                                                                                                                                              |
| df           | bool | 是否返回`dataframe`格式数据。默认 False, 返回 list[dict]                                                                                                                                                                                                                                                                                             |

**返回值：**
当 df = True 时， 返回`dataframe`
当 df = False 时， 返回`list[dict]`

| 字段             | 类型  | 说明                                     |
| ---------------- | ----- | ---------------------------------------- |
| symbol           | str   | 标的                                     |
| ordersno         | str   | 委 托 号                                 |
| creditdirect     | str   | 融资融券方向， '0'表示融资， '1'表示融券 |
| orderqty         | float | 委托数量                                 |
| matchqty         | float | 成交数量                                 |
| orderamt         | float | 委托金额                                 |
| orderfrzamt      | float | 委托冻结金额                             |
| matchamt         | float | 成交金额                                 |
| clearamt         | float | 清算金额                                 |
| lifestatus       | str   | 合约状态                                 |
| creditrepay      | float | T 日之前归还金额                         |
| creditrepayunfrz | float | T 日归还金额                             |
| fundremain       | float | 应还金额                                 |
| stkrepay         | float | T 日之前归还数量                         |
| stkrepayunfrz    | float | T 日归还数量                             |
| stkremain        | float | 应还证券数量                             |
| stkremainvalue   | float | 应还证券市值                             |
| fee              | float | 融资融券息、费                           |
| overduefee       | float | 逾期未偿还息、费                         |
| fee_repay        | float | 己偿还息、费                             |
| punifee          | float | 利息产生的罚息                           |
| punifee_repay    | float | 己偿还罚息                               |
| rights           | float | 未偿还权益金额                           |
| overduerights    | float | 逾期未偿还权益                           |
| rights_repay     | float | 己偿还权益                               |
| lastprice        | float | 最新价                                   |
| profitcost       | float | 浮动盈亏                                 |
| sno              | str   | 合约编号                                 |
| punidebts        | float | 逾期本金罚息                             |
| punidebts_repay  | float | 本金罚息偿还                             |
| punidebtsunfrz   | float | 逾期本金罚息                             |
| punifeeunfrz     | float | 逾期息费罚息                             |
| punirights       | float | 逾期权益罚息                             |
| punirights_repay | float | 权益罚息偿还                             |
| punirightsunfrz  | float | 逾期权益罚息                             |
| feeunfrz         | float | 实时偿还利息                             |
| overduefeeunfrz  | float | 实时偿还逾期利息                         |
| rightsqty        | float | 未偿还权益数量                           |
| overduerightsqty | float | 逾期未偿还权益数量                       |
| orderdate        | int   | 委托日期，时间戳类型                     |
| lastdate         | int   | 最后一次计算息费日期，时间戳类型         |
| closedate        | int   | 合约全部偿还日期，时间戳类型             |
| sysdate          | int   | 系统日期，时间戳类型                     |
| enddate          | int   | 负债截止日期，时间戳类型                 |
| oldenddate       | int   | 原始的负债截止日期，时间戳类型           |

**示例代码**

```
credit_get_contracts(position_src=PositionSrc_L1, account_id='', df=False)
```

**示例返回值**

```
symbol      ordersno creditdirect orderqty matchamt clearamt lifestatus enddate  fundremain fee   rights    profitcost sno      rightsqty orderdate matchqty orderamt orderfrzamt oldenddate creditrepay creditrepayunfrz stkrepay stkrepayunfrz stkremain stkremainvalue overduefee fee_repay punifee punifee_repay overduerights rights_repay lastprice sysdate lastdate closedate punidebts punidebts_repay punidebtsunfrz punifeeunfrz punirights punirights_repay punirightsunfrz feeunfrz overduefeeunfrz overduerightsqty
----------- -------- ------------ -------- -------- -------- ---------- -------- ---------- ----- --------- ---------- -------- --------- --------- -------- -------- ----------- ---------- ----------- ---------------- -------- ------------- --------- -------------- ---------- --------- ------- ------------- ------------- ------------ --------- ------- -------- --------- --------- --------------- -------------- ------------ ---------- ---------------- --------------- -------- --------------- ----------------
SZSE.159937 115906   0            59600.0  217957.2 217957.2 0          20200823 220666.32  32.69 220666.32 11112.52   15211131 59600.0   0         0.0      0.0      0.0         0          0.0         0.0              0.0      0.0           0.0       0.0            0.0        0.0       0.0     0.0           0.0           0.0          0.0       0.0     0.0      0.0       0.0       0.0             0.0            0.0          0.0        0.0              0.0             0.0      0.0             0.0
........... ......
```

### credit_get_cash - 查询融资融券资金

**函数原型：**

```
credit_get_cash(account_id='')
```

**参数：**

| 参数名     | 类型 | 说明                                                    |
| ---------- | ---- | ------------------------------------------------------- |
| account_id | str  | 账号 id，不填或留空，表示使用默认账号，否则使用指定账号 |

**返回值：`dict`**

| 字段                     | 类型  | 名称                                   |
| ------------------------ | ----- | -------------------------------------- |
| fundintrrate             | float | 融资利率                               |
| stkintrrate              | float | 融券利率                               |
| punishintrrate           | float | 罚息利率                               |
| creditstatus             | str   | 信用状态                               |
| marginrates              | float | 维持担保比例                           |
| realrate                 | float | 实时担保比例                           |
| asset                    | float | 总资产                                 |
| liability                | float | 总负债                                 |
| marginavl                | float | 保证金可用数                           |
| fundbal                  | float | 资金余额                               |
| fundavl                  | float | 资金可用数                             |
| dsaleamtbal              | float | 融券卖出所得资金                       |
| guaranteeout             | float | 可转出担保资产                         |
| gagemktavl               | float | 担保证券市值                           |
| fdealavl                 | float | 融资本金                               |
| ffee                     | float | 融资息费                               |
| ftotaldebts              | float | 融资负债合计                           |
| dealfmktavl              | float | 应付融券市值                           |
| dfee                     | float | 融券息费                               |
| dtotaldebts              | float | 融券负债合计                           |
| fcreditbal               | float | 融资授信额度                           |
| fcreditavl               | float | 融资可用额度                           |
| fcreditfrz               | float | 融资额度冻结                           |
| dcreditbal               | float | 融券授信额度                           |
| dcreditavl               | float | 融券授信额度                           |
| dcreditfrz               | float | 融券额度冻结                           |
| rights                   | float | 红利权益                               |
| serviceuncomerqrights    | float | 红利权益(在途)                         |
| rightsqty                | float | 红股权益                               |
| serviceuncomerqrightsqty | float | 红股权益(在途)                         |
| acreditbal               | float | 总额度                                 |
| acreditavl               | float | 总可用额度                             |
| acashcapital             | float | 所有现金资产（所有资产、包括融券卖出） |
| astkmktvalue             | float | 所有证券市值（包含融资买入、非担保品） |
| withdrawable             | float | 可取资金                               |
| netcapital               | float | 净资产                                 |
| fcreditpnl               | float | 融资盈亏                               |
| dcreditpnl               | float | 融券盈亏                               |
| fcreditmarginoccupied    | float | 融资占用保证金                         |
| dcreditmarginoccupied    | float | 融券占用保证金                         |
| collateralbuyableamt     | float | 可买担保品资金                         |
| repayableamt             | float | 可还款金额                             |
| dcreditcashavl           | float | 融券可用资金                           |

**示例代码**

```
credit_get_cash(account_id='')
```

**示例返回值**

```
marginrates realrate asset         liability  marginavl         fundbal       fundavl       guaranteeout gagemktavl  fdealavl   ffee   ftotaldebts dfee fcreditbal fcreditavl         dcreditbal dcreditavl acreditbal acreditavl  account_id                           account_name     rid                                  fundintrrate  stkintrrate punishintrrate creditstatus dsaleamtbal dealfmktavl dtotaldebts fcreditfrz dcreditfrz   rights    serviceuncomerqrights rightsqty serviceuncomerqrightsqty acashcapital astkmktvalue withdrawable netcapital fcreditpnl dcreditpnl fcreditmarginoccupied dcreditmarginoccupied collateralbuyableamt repayableamt dcreditcashavl
----------- -------- ------------- ---------- ----------------- ------------- ------------- ------------ ----------- ---------- ------ ----------- ---- ---------- ------------------ ---------- ---------- ---------- ----------- ------------------------------------ ---------------- ------------------------------------ ------------- ----------- -------------- ------------ ----------- ----------- ----------- ---------- ------------ --------- --------------------- --------- ------------------------ ------------ ------------ ------------ ---------- ---------- ---------- --------------------- --------------------- -------------------- ------------ --------------
229.5157    229.5157 1001926287.62 4356531.11 1994995956.360447 1002066280.62 2002149925.25 988838893.26 -4483562.29 4307241.23 668.89 4307910.12  1.28 8000000.0  3683189.8499999996 8000000.0  8000001.0  16000000.0 11683190.85 8f30e83f-a7c5-11ea-b510-309c231d28bd 001515018318     3978e606-0fc0-43ec-87b0-01887fa280c5 0.0           0.0         0.0                         0.0         0.0         0.0         0.0        0.0          0.0       0.0                   0.0       0.0                      0.0          0.0          0.0          0.0        0.0        0.0        0.0                   0.0                   0.0                  0.0          0.0
```

### credit_repay_share_by_buying_share - 买券还券

**函数原型**

```
credit_repay_share_by_buying_share(symbol, volume, price, order_type=OrderType_Limit,
                                       order_duration=OrderDuration_Unknown,
                                       order_qualifier=OrderQualifier_Unknown, account_id='')
```

**参数：**

| 参数名          | 类型  | 说明                                                    |
| --------------- | ----- | ------------------------------------------------------- |
| symbol          | str   | 标的代码                                                |
| volume          | int   | 数量                                                    |
| price           | float | 价格                                                    |
| order_type      | int   | 参见订单委托类型                                        |
| order_duration  | int   | 参见 委托时间属性                                       |
| order_qualifier | str   | 参见 委托成交属性                                       |
| account_id      | str   | 账号 id，不填或留空，表示使用默认账号，否则使用指定账号 |

**返回值：**

请参考 [order](python_object_trade.md#Order - 委托对象 "Order---委托对象") 返回值字段说明

**示例代码**

```
credit_repay_share_by_buying_share(symbol='SHSE.600000', volume=100, price=10.67, order_type=OrderType_Limit,
                                             order_duration=OrderDuration_Unknown,
                                             order_qualifier=OrderQualifier_Unknown,
                                             account_id='')
```

**示例返回值**

```
strategy_id                          account_id                           cl_ord_id                            symbol      order_type status price volume created_at                                                              order_business account_name order_id ex_ord_id algo_order_id side position_effect position_side order_duration order_qualifier order_src ord_rej_reason ord_rej_reason_detail stop_price order_style value percent target_volume target_value target_percent filled_volume filled_vwap filled_amount filled_commission updated_at
------------------------------------ ------------------------------------ ------------------------------------ ----------- ---------- ------ ----- ------ ----------------------------------------------------------------------- -------------- ------------ -------- --------- ------------- ---- --------------- ------------- -------------- --------------- --------- -------------- --------------------- ---------- ----------- ----- ------- ------------- ------------ -------------- ------------- ----------- ------------- ----------------- ----------
3af55cb8-a7c5-11ea-b510-309c231d28bd 8f30e83f-a7c5-11ea-b510-309c231d28bd 2b857e02-a7c9-11ea-b510-309c231d28bd SHSE.600000 1          10     10.67 100    datetime.datetime(2020, 6, 6, 15, 41, 44, 865536, tzinfo=tzfile('PRC')) 202                                                          0    0               0             0              0               0         0                                    0.0        0           0.0   0.0     0             0.0          0.0            0             0.0         0.0           0.0               None
```

### credit_repay_cash_by_selling_share - 卖券还款

**函数原型**

```
credit_repay_cash_by_selling_share(symbol, volume, price, order_type=OrderType_Limit,
                                       order_duration=OrderDuration_Unknown,
                                       order_qualifier=OrderQualifier_Unknown, account_id='')
```

**参数：**

| 参数名          | 类型  | 说明                                                    |
| --------------- | ----- | ------------------------------------------------------- |
| symbol          | str   | 标的代码                                                |
| volume          | int   | 数量                                                    |
| price           | float | 价格                                                    |
| order_type      | int   | 参见订单委托类型                                        |
| order_duration  | int   | 参见 委托时间属性                                       |
| order_qualifier | str   | 参见 委托成交属性                                       |
| account_id      | str   | 账号 id，不填或留空，表示使用默认账号，否则使用指定账号 |

**返回值：**

请参考 [order](python_object_trade.md#Order - 委托对象 "Order---委托对象") 返回值字段说明

**示例代码**

```
credit_repay_cash_by_selling_share(symbol='SHSE.600000', volume=100, price=10.67, order_type=OrderType_Limit,
                                             order_duration=OrderDuration_Unknown,
                                             order_qualifier=OrderQualifier_Unknown,
                                             account_id='')
```

**示例返回值**

```
strategy_id                          account_id                           cl_ord_id                            symbol      order_type status price volume created_at                                                              order_business account_name order_id ex_ord_id algo_order_id side position_effect position_side order_duration order_qualifier order_src ord_rej_reason ord_rej_reason_detail stop_price order_style value percent target_volume target_value target_percent filled_volume filled_vwap filled_amount filled_commission updated_at
------------------------------------ ------------------------------------ ------------------------------------ ----------- ---------- ------ ----- ------ ----------------------------------------------------------------------- -------------- ------------ -------- --------- ------------- ---- --------------- ------------- -------------- --------------- --------- -------------- --------------------- ---------- ----------- ----- ------- ------------- ------------ -------------- ------------- ----------- ------------- ----------------- ----------
3af55cb8-a7c5-11ea-b510-309c231d28bd 8f30e83f-a7c5-11ea-b510-309c231d28bd 2b85a50a-a7c9-11ea-b510-309c231d28bd SHSE.600000 1          10     10.67 100    datetime.datetime(2020, 6, 6, 15, 41, 44, 866535, tzinfo=tzfile('PRC')) 203                                                          0    0               0             0              0               0         0                                    0.0        0           0.0   0.0     0             0.0          0.0            0             0.0         0.0           0.0               None
```

### credit_buying_on_collateral - 担保品买入

**函数原型**

```
credit_buying_on_collateral(symbol, volume, price,
                                order_type=OrderType_Limit,
                                order_duration=OrderDuration_Unknown,
                                order_qualifier=OrderQualifier_Unknown, account_id='')
```

**参数：**

| 参数名          | 类型  | 说明                                                    |
| --------------- | ----- | ------------------------------------------------------- |
| symbol          | str   | 标的代码                                                |
| volume          | int   | 数量                                                    |
| price           | float | 价格                                                    |
| order_type      | int   | 参见订单委托类型                                        |
| order_duration  | int   | 参见 委托时间属性                                       |
| order_qualifier | str   | 参见 委托成交属性                                       |
| account_id      | str   | 账号 id，不填或留空，表示使用默认账号，否则使用指定账号 |

**返回值：`list[dict]`**

请参考 [order](python_object_trade.md#Order - 委托对象 "Order---委托对象") 返回值字段说明

**示例代码**

```
credit_buying_on_collateral(symbol='SHSE.600000', volume=100, price=10.67, order_type=OrderType_Limit,
                                             order_duration=OrderDuration_Unknown,
                                             order_qualifier=OrderQualifier_Unknown,
                                             account_id='')
```

**示例返回值**

```
strategy_id                          account_id                           cl_ord_id                            symbol      order_type status price volume created_at                                                              order_business account_name order_id ex_ord_id algo_order_id side position_effect position_side order_duration order_qualifier order_src ord_rej_reason ord_rej_reason_detail stop_price order_style value percent target_volume target_value target_percent filled_volume filled_vwap filled_amount filled_commission updated_at
------------------------------------ ------------------------------------ ------------------------------------ ----------- ---------- ------ ----- ------ ----------------------------------------------------------------------- -------------- ------------ -------- --------- ------------- ---- --------------- ------------- -------------- --------------- --------- -------------- --------------------- ---------- ----------- ----- ------- ------------- ------------ -------------- ------------- ----------- ------------- ----------------- ----------
3af55cb8-a7c5-11ea-b510-309c231d28bd 8f30e83f-a7c5-11ea-b510-309c231d28bd 2b861a31-a7c9-11ea-b510-309c231d28bd SHSE.600000 1          10     10.67 100    datetime.datetime(2020, 6, 6, 15, 41, 44, 869534, tzinfo=tzfile('PRC')) 207                                                          0    0               0             0              0               0         0                                    0.0        0           0.0   0.0     0             0.0          0.0            0             0.0         0.0           0.0               None

```

### credit_selling_on_collateral - 担保品卖出

**函数原型**

```
credit_selling_on_collateral(symbol, volume, price,
                                 order_type=OrderType_Limit,
                                 order_duration=OrderDuration_Unknown,
                                 order_qualifier=OrderQualifier_Unknown, account_id='')
```

**参数：**

| 参数名          | 类型  | 说明                                                    |
| --------------- | ----- | ------------------------------------------------------- |
| symbol          | str   | 标的代码                                                |
| volume          | int   | 数量                                                    |
| price           | float | 价格                                                    |
| order_type      | int   | 参见订单委托类型                                        |
| order_duration  | int   | 参见 委托时间属性                                       |
| order_qualifier | str   | 参见 委托成交属性                                       |
| account_id      | str   | 账号 id，不填或留空，表示使用默认账号，否则使用指定账号 |

**返回值：`list[dict]`**

请参考[order](python_object_trade.md#Order - 委托对象 "Order---委托对象") 返回值字段说明

**示例代码**

```
credit_selling_on_collateral(symbol='SHSE.600000', volume=100, price=10.67, order_type=OrderType_Limit,
                                             order_duration=OrderDuration_Unknown,
                                             order_qualifier=OrderQualifier_Unknown,
                                             account_id='')
```

**示例返回值**

```
strategy_id                          account_id                           cl_ord_id                            symbol      order_type status price volume created_at                                                              order_business account_name order_id ex_ord_id algo_order_id side position_effect position_side order_duration order_qualifier order_src ord_rej_reason ord_rej_reason_detail stop_price order_style value percent target_volume target_value target_percent filled_volume filled_vwap filled_amount filled_commission updated_at
------------------------------------ ------------------------------------ ------------------------------------ ----------- ---------- ------ ----- ------ ----------------------------------------------------------------------- -------------- ------------ -------- --------- ------------- ---- --------------- ------------- -------------- --------------- --------- -------------- --------------------- ---------- ----------- ----- ------- ------------- ------------ -------------- ------------- ----------- ------------- ----------------- ----------
3af55cb8-a7c5-11ea-b510-309c231d28bd 8f30e83f-a7c5-11ea-b510-309c231d28bd 2b861a31-a7c9-11ea-b510-309c231d28bd SHSE.600000 1          10     10.67 100    datetime.datetime(2020, 6, 6, 15, 41, 44, 869534, tzinfo=tzfile('PRC')) 208                                                          0    0               0             0              0               0         0                                    0.0        0           0.0   0.0     0             0.0          0.0            0             0.0         0.0           0.0               None
```

### credit_collateral_in - 担保品转入

**函数原型**

```
credit_collateral_in(symbol, volume, account_id='')
```

**参数：**

| 参数名     | 类型 | 说明                                                    |
| ---------- | ---- | ------------------------------------------------------- |
| symbol     | str  | 标的代码                                                |
| volume     | int  | 数量                                                    |
| account_id | str  | 账号 id，不填或留空，表示使用默认账号，否则使用指定账号 |

**返回值：`list[dict]`**

请参考 [order](python_object_trade.md#Order - 委托对象 "Order---委托对象") 返回值字段说明

**示例代码**

```
credit_collateral_in(symbol='SHSE.600000', volume=100, account_id='')
```

**示例返回值**

```
strategy_id                          account_id                           cl_ord_id                            symbol      order_type status volume created_at                                                              order_business account_name order_id ex_ord_id algo_order_id side position_effect position_side order_duration order_qualifier order_src ord_rej_reason ord_rej_reason_detail price stop_price order_style value percent target_volume target_value target_percent filled_volume filled_vwap filled_amount filled_commission updated_at
------------------------------------ ------------------------------------ ------------------------------------ ----------- ---------- ------ ------ ----------------------------------------------------------------------- -------------- ------------ -------- --------- ------------- ---- --------------- ------------- -------------- --------------- --------- -------------- --------------------- ----- ---------- ----------- ----- ------- ------------- ------------ -------------- ------------- ----------- ------------- ----------------- ----------
3af55cb8-a7c5-11ea-b510-309c231d28bd 8f30e83f-a7c5-11ea-b510-309c231d28bd 2b868f72-a7c9-11ea-b510-309c231d28bd SHSE.600000 1          10     100    datetime.datetime(2020, 6, 6, 15, 41, 44, 872536, tzinfo=tzfile('PRC')) 209                                                          0    0               0             0              0               0         0                                    0.0   0.0        0           0.0   0.0     0             0.0          0.0            0             0.0         0.0           0.0               None
...... ......
```

### credit_collateral_out - 担保品转出

**函数原型**

```
credit_collateral_out(symbol, volume, account_id='')
```

**参数：**

| 参数名     | 类型 | 说明                                                    |
| ---------- | ---- | ------------------------------------------------------- |
| symbol     | str  | 标的代码                                                |
| volume     | int  | 数量                                                    |
| account_id | str  | 账号 id，不填或留空，表示使用默认账号，否则使用指定账号 |

**返回值：`list[dict]`**

请参考 [order](python_object_trade.md#Order - 委托对象 "Order---委托对象") 返回值字段说明

**示例代码**

```
credit_collateral_out(symbol='SHSE.600000', volume=100, account_id='')
```

**示例返回值**

```
strategy_id                          account_id                           cl_ord_id                            symbol      order_type status volume created_at                                                              order_business account_name order_id ex_ord_id algo_order_id side position_effect position_side order_duration order_qualifier order_src ord_rej_reason ord_rej_reason_detail price stop_price order_style value percent target_volume target_value target_percent filled_volume filled_vwap filled_amount filled_commission updated_at
------------------------------------ ------------------------------------ ------------------------------------ ----------- ---------- ------ ------ ----------------------------------------------------------------------- -------------- ------------ -------- --------- ------------- ---- --------------- ------------- -------------- --------------- --------- -------------- --------------------- ----- ---------- ----------- ----- ------- ------------- ------------ -------------- ------------- ----------- ------------- ----------------- ----------
3af55cb8-a7c5-11ea-b510-309c231d28bd 8f30e83f-a7c5-11ea-b510-309c231d28bd 2b868f72-a7c9-11ea-b510-309c231d28bd SHSE.600000 1          10     100    datetime.datetime(2020, 6, 6, 15, 41, 44, 872536, tzinfo=tzfile('PRC')) 210                                                          0    0               0             0              0               0         0                                    0.0   0.0        0           0.0   0.0     0             0.0          0.0            0             0.0         0.0           0.0               None
...... ......
```

---

## 10. 算法交易函数

### 算法 SDK

python 算法 SDK 包含在 gm3.0.126 版本及以上版本，不需要引入新库
仅支持实时模式，部分券商版本可用

### algo_order 算法交易委托

委托算法母单

**函数原型:**

```python
algo_order(symbol, volume, side, order_type,position_effect, price, algo_name, algo_param)
```

**参数：**

| 参数            | 类型 | 说明                                                        |
| --------------- | ---- | ----------------------------------------------------------- |
| symbol          | str  | 标的代码                                                    |
| volume          | int  | 数量                                                        |
| side            | int  | OrderSide_Buy = 1 买入 OrderSide_Sell = 2 卖出              |
| order_type      | int  | OrderType_Limit = 1 限价委托，OrderType_Market = 2 市价委托 |
| position_effect | int  | PositionEffect_Open = 1 开仓 PositionEffect_Close = 2 平仓, |
| price           | int  | 基准价格（ATS-SMART 算法不生效）                            |
| algo_name       | str  | 算法名称，ATS-SMART、ZC-POV                                 |
| algo_param      | dict | 算法参数                                                    |

**返回值:**

| 类型          | 说明                                                                                 |
| :------------ | :----------------------------------------------------------------------------------- |
| list\[order\] | 委托对象列表，参见[委托](python_object_trade.md#Order - 委托对象 "Order---委托对象") |

**当 algo_name = 'ATS-SMART'时**
algo_param 的参数为

| 参数              | 类型 | 说明                                                                     |
| ----------------- | ---- | ------------------------------------------------------------------------ |
| start_time        | str  | 开始时间                                                                 |
| end_time_referred | str  | 结束参考时间(不能超过 14:55:00)                                          |
| time_end          | str  | 结束时间(不能超过 14:55:00)                                              |
| end_time_valid    | int  | 结束时间是否有效,如设为无效，则以收盘时间为结束时间, 1 为有效， 0 为无效 |
| stop_sell_when_DL | int  | 涨停时是否停止卖出， 1 为是，0 为否                                      |
| cancel_when_PL    | int  | 跌停时是否撤单, 1 为是， 0 为否                                          |
| min_trade_amount  | int  | 最小交易金额                                                             |

**示例：**

```python
# 下算法母单，设定母单的执行参数
algo_param = {'start_time': '09:00:00', 'end_time_referred':'14:55:00', 'end_time': '14:55:00', 'end_time_valid': 1, 'stop_sell_when_dl': 1,
              'cancel_when_pl': 0, 'min_trade_amount': 100000}
aorders = algo_order(symbol='SHSE.600000', volume=20000, side=OrderSide_Buy, order_type=OrderType_Limit,
                   position_effect=PositionEffect_Open, price=5, algo_name='ATS-SMART', algo_param=algo_param)
print(aorders)
```

**输出：**

```python
[{'strategy_id': '6f534238-2883-11eb-a8fe-fa163ef85f63', 'account_id': '927f9095-27e5-11eb-bb81-fa163ef85f63', 'account_name': '1001000002', 'cl_ord_id': '03f13690-2d64-11eb-9e36-fa163ef85f63', 'symbol': 'SHSE.600000', 'side': 1, 'position_effect': 1, 'order_type': 1, 'status': 10, 'price': 5.0, 'order_style': 1, 'volume': 20000, 'created_at': datetime.datetime(2020, 11, 23, 16, 15, 15, 105141, tzinfo=tzfile('PRC')), 'updated_at': datetime.datetime(2020, 11, 23, 16, 15, 15, 105141,tzinfo=tzfile('PRC')), 'algo_name': 'ATS-SMART', 'algo_param': 'start_time&&1606093200||end_time_referred&&1606114500||end_time&&1606114500||end_time_valid&&1||stop_sell_when_dl&&1||cancel_when_pl&&0||min_trade_amount&&100000', 'order_id': '', 'ex_ord_id': '', 'position_side': 0, 'order_business': 0, 'order_duration': 0, 'order_qualifier': 0, 'order_src': 0, 'position_src': 0, 'ord_rej_reason': 0, 'ord_rej_reason_detail': '', 'stop_price': 0.0, 'value': 0.0, 'percent': 0.0, 'target_volume': 0, 'target_value': 0.0, 'target_percent': 0.0, 'filled_volume': 0, 'filled_vwap': 0.0, 'filled_amount': 0.0, 'filled_commission': 0.0, 'algo_status': 0, 'algo_comment': ''}]
```

**当 algo_name = 'ZC-POV'时**
algo_param 的参数为

| 参数      | 类型  | 说明                                       |
| --------- | ----- | ------------------------------------------ |
| part_rate | float | 市场参与率（0~45），单位%，默认 30，即 30% |

**示例：**

```python
# 下算法母单，设定母单的执行参数
algo_param = {"participation_rate" : 15}
aorder = algo_order(symbol=symbol, volume=1000, side=OrderSide_Buy, order_type=OrderSide_Buy,
               position_effect=PositionEffect_Open, price=price, algo_name=algo_name, algo_param=algo_param)
print(aorder)
```

**输出：**

```python
[{'strategy_id': '6f534238-2883-11eb-a8fe-fa163ef85f63', 'account_id': '15b7afb1-e91d-11eb-953b-025041000001', 'account_name': 'b6b2819b-e864-11eb-b146-00163e0a4100', 'cl_ord_id': 'e0f4ca3f-f97a-11eb-acee-165afc004509', 'symbol': 'SHSE.600007', 'side': 1, 'position_effect': 1, 'order_type': 1, 'status': 10, 'price': 15.470000267028809, 'order_style': 1, 'volume': 1000, 'created_at': datetime.datetime(2021, 8, 10, 9, 32, 52, 39737, tzinfo=tzfile('PRC')), 'updated_at': datetime.datetime(2021, 8, 10, 9, 32, 52, 42738, tzinfo=tzfile('PRC')), 'algo_name': 'ZC-POV', 'algo_param': 'TimeStart&&1628559000||TimeEnd&&1628578800||PartRate&&0.150000||MinAmount&&1000', 'order_id': '', 'ex_ord_id': '', 'position_side': 0, 'order_business': 0, 'order_duration': 0, 'order_qualifier': 0, 'order_src': 0, 'position_src': 0, 'ord_rej_reason': 0, 'ord_rej_reason_detail': '', 'stop_price': 0.0, 'value': 0.0, 'percent': 0.0, 'target_volume': 0, 'target_value': 0.0, 'target_percent': 0.0, 'filled_volume': 0, 'filled_vwap': 0.0, 'filled_amount': 0.0, 'filled_commission': 0.0, 'algo_status': 0, 'algo_comment': '', 'properties': {}]
```

**注意:** 回测模式不支持算法单

### algo_order_cancel 撤销算法委托

撤销母单委托

**函数原型:**

```python
algo_order_cancel(wait_cancel_orders)
```

**参数：**

| 参数               | 类型 | 说明                                                                                  |
| ------------------ | ---- | ------------------------------------------------------------------------------------- |
| wait_cancel_orders | str  | 撤单算法委托. 传入单个字典. 或者 list 字典. 每个字典包含 key:cl_ord_id key:account_id |

cl_ord_id 为委托 id， account_id 为账户 id

**返回值:**

| 类型          | 说明                                                                                 |
| :------------ | :----------------------------------------------------------------------------------- |
| list\[order\] | 委托对象列表，参见[委托](python_object_trade.md#Order - 委托对象 "Order---委托对象") |

**示例：**

```python
aorders = get_algo_orders(account='')
wait_cancel_orders = [{'cl_ord_id': aorders[0]['cl_ord_id'], 'account_id': aorders[0]['account_id']}]
algo_order_cancel(wait_cancel_orders)
```

### get_algo_orders 查询算法委托

查询母单委托

**函数原型:**

```python
algo_order_cancel(account)
```

**参数：**

| 参数    | 类型 | 说明                       |
| ------- | ---- | -------------------------- |
| account | str  | account_id 默认帐号时为 '' |

**返回值:**

| 类型          | 说明                                                                                 |
| :------------ | :----------------------------------------------------------------------------------- |
| list\[order\] | 委托对象列表，参见[委托](python_object_trade.md#Order - 委托对象 "Order---委托对象") |

**示例：**

```python
get_algo_orders(account='')
```

**输出：**

```python
[{'strategy_id': '6f534238-2883-11eb-a8fe-fa163ef85f63', 'account_id': '927f9095-27e5-11eb-bb81-fa163ef85f63', 'account_name': '1001000002', 'cl_ord_id': 'fe0ec2d3-2d50-11eb-9e36-fa163ef85f63', 'symbol': 'SHSE.510300', 'side': 1, 'position_effect': 1, 'order_type': 1, 'status': 10, 'price': 5.0, 'order_style': 1, 'volume': 20000, 'created_at': datetime.datetime(2020, 11, 23, 13, 59, 4,794594, tzinfo=tzfile('PRC')), 'updated_at': datetime.datetime(2020, 11, 23, 13, 59, 4, 795571, tzinfo=tzfile('PRC')), 'algo_name': 'ATS-SMART', 'algo_param': 'start_time&&1606093200||end_time_referred&&1606114500||end_time&&1606114500||end_time_valid&&1||stop_sell_when_dl&&1||cancel_when_pl&&0||min_trade_amount&&100000', 'order_id': '', 'ex_ord_id': '', 'position_side': 0, 'order_business': 0, 'order_duration': 0, 'order_qualifier': 0, 'order_src': 0, 'position_src': 0, 'ord_rej_reason': 0, 'ord_rej_reason_detail': '', 'stop_price': 0.0, 'value': 0.0, 'percent': 0.0, 'target_volume': 0, 'target_value': 0.0, 'target_percent': 0.0, 'filled_volume': 0, 'filled_vwap': 0.0, 'filled_amount': 0.0, 'filled_commission': 0.0, 'algo_status': 0, 'algo_comment': ''}]
```

### algo_order_pause 暂停或重启或者撤销算法委托

**函数原型:**

```python
algo_order_pause(alorders)
```

**参数：**

| 参数     | 类型 | 说明                                                                                     |
| -------- | ---- | ---------------------------------------------------------------------------------------- |
| alorders | str  | 传入单个字典. 或者 list 字典. 每个字典包含 key:cl_ord_id, key:account_id key:algo_status |

cl_ord_id 为委托 id， account_id 为账户 id，algo_status 为算法单状态（1 - 重启 2 - 暂停 3 -暂停并撤子单）

**返回值:**

| 类型          | 说明                                                                                 |
| :------------ | :----------------------------------------------------------------------------------- |
| list\[order\] | 委托对象列表，参见[委托](python_object_trade.md#Order - 委托对象 "Order---委托对象") |

```python
aorders = get_algo_orders(account='')
# 暂停订单，修改订单结构的母单状态字段
alorders01 = [{'cl_ord_id': aorders[0]['cl_ord_id'], 'account_id': aorders[0]['account_id'], 'algo_status': 3}]
algo_order_pause(alorders01)
```

**注意：** ATS-SMART 算法暂不支持此接口

### get_algo_child_orders 查询算法委托的所有子单

**函数原型:**

```python
get_algo_child_orders(cl_ord_id, account='')
```

**参数：**

| 参数      | 类型 | 说明                                                     |
| --------- | ---- | -------------------------------------------------------- |
| cl_ord_id | str  | 传入单个字典. 或者 list 字典. 每个字典包含 key:cl_ord_id |
| account   | str  | account_id 默认帐号时为 ''                               |

**返回值:**

| 类型          | 说明                                                                                 |
| :------------ | :----------------------------------------------------------------------------------- |
| list\[order\] | 委托对象列表，参见[委托](python_object_trade.md#Order - 委托对象 "Order---委托对象") |

**示例：**

```python
aorders = get_algo_orders(account='')
child_order= get_algo_child_orders(aorders[0]['cl_ord_id'], account='')
print(child_order[0])
```

**输出：**

```python
[{'account_id': '17ceec74-2efb-11eb-b437-00ff5a669ee2', 'account_name': '0000001', 'cl_ord_id': '1606294231_9', 'order_id': '1606294231_9', 'symbol': 'SZSE.000001', 'side': 1, 'position_effect': 1, 'order_type': 1, 'status': 3, 'price': 19.06, 'volume': 100, 'filled_volume': 100, 'filled_vwap': 19.06, 'filled_amount': 1905.9999999999998, 'algo_order_id': '453b3064-2efb-11eb-b437-00ff5a669ee2', 'strategy_id': '', 'ex_ord_id': '', 'position_side': 0, 'order_business': 0, 'order_duration': 0, 'order_qualifier': 0, 'order_src': 0, 'ord_rej_reason': 0, 'ord_rej_reason_detail': '', 'stop_price': 0.0, 'order_style': 0, 'value': 0.0, 'percent': 0.0, 'target_volume': 0, 'target_value': 0.0, 'target_percent': 0.0, 'filled_commission': 0.0, 'created_at': None, 'updated_at': None}]
```

### on_algo_order_status 算法单状态事件

响应算法单状态更新事情，下算法单后状态更新时被触发

**函数原型:**

```python
on_algo_order_status(context, algo_order)
```

**参数：**

| 参数名     | 类型                                                                     | 说明   |
| :--------- | :----------------------------------------------------------------------- | :----- |
| context    | [context](python_concept.md#context - 上下文对象 "context---上下文对象") | 上下文 |
| algo_order | [order](python_object_trade.md#Order - 委托对象 "Order---委托对象")      | 委托   |

**示例：**

```python
def on_algo_order_status(context, algo_order):
	print(algo_order)

```

**输出：**

```python
{'strategy_id': '6f534238-2883-11eb-a8fe-fa163ef85f63', 'account_id': '927f9095-27e5-11eb-bb81-fa163ef85f63', 'account_name': '1001000002', 'cl_ord_id': '09baa735-2e01-11eb-ab6f-fa163ef85f63','symbol': 'SHSE.600000', 'side': 1, 'position_effect': 1,'order_type': 1, 'status':1, 'price': 5.0, 'order_style': 1, 'volume': 20000, 'created_at':datetime.datetime(2020,11, 24, 10, 59, 15, 800453, tzinfo=tzfile('PRC')), 'updated_at': datetime.datetime(2020, 11, 24, 10, 59, 17, 922523, tzinfo=tzfile('PRC')), 'algo_name': 'ATS-SMART', 'algo_param': 'start_time&&1606179600||end_time_referred&&1606200900||end_time&&1606200900||end_time_valid&&1|stop_sell_when_dl&&1||cancel_when_pl&&0||min_trade_amount&&100000', 'order_id': '', 'ex_ord_id':'', 'position_side': 0, 'order_business': 0, 'order_duration': 0, 'order_qualifier':0, 'order_src': 0, 'position_src': 0, 'ord_rej_reason': 0, 'ord_rej_reason_detail': '', 'stop_price': 0.0, 'value': 0.0, 'percent': 0.0, 'target_volume': 0, 'target_value': 0.0, 'target_percent': 0.0, 'filled_volume': 0, 'filled_vwap': 0.0, 'filled_amount': 0.0, 'filled_commission': 0.0, 'algo_status':0, 'algo_comment': ''}
```

---

## 11. 新股交易函数

### 新股 SDK

### ipo_buy - 新股申购

仅在**实盘**中可以使用

**函数原型:**

```
ipo_buy(symbol, volume, price, account_id='')
```

**参数：**

| 参数名     | 类型  | 说明                          |
| :--------- | :---- | :---------------------------- |
| symbol     | str   | 标的代码                      |
| volume     | int   | 申购数量                      |
| price      | float | 新股发行价                    |
| account_id | str   | 账户 ID，不指定则使用默认账户 |

返回值 `List[Dict]`

### ipo_get_quota - 查询新股申购额度

仅在**实盘**中可以使用

**函数原型:**

```
ipo_get_quota(account_id='')
```

**参数：**

| 参数名     | 类型 | 说明                          |
| :--------- | :--- | :---------------------------- |
| account_id | str  | 账户 ID，不指定则使用默认账户 |

**返回值:**

`List[Dict[str, Any]]`

| key   | value 类型 | 说明       |
| :---- | :--------- | :--------- |
| quota | float      | 可申购数量 |

### ipo_get_instruments - 查询当日新股清单

仅在**实盘**中可以使用

**函数原型:**

```
ipo_get_instruments(sec_type, account_id='', df=False)
```

**参数：**

| 参数名     | 类型 | 说明                               |
| :--------- | :--- | :--------------------------------- |
| sec_type   | int  | 标的类型，用以区别获取新股还是新债 |
| account_id | str  | 账户 ID，不指定则使用默认账户      |
| df         | bool | 是否返回 DataFrame                 |

**返回值:**

`List[Dict]`

| key     | value 类型 | 说明         |
| :------ | :--------- | :----------- |
| symbol  | str        | 标的代码     |
| price   | float      | 申购价格     |
| min_vol | int        | 申购最小数量 |
| max_vol | int        | 申购最大数量 |

### ipo_get_match_number - 查询配号

仅在**实盘**中可以使用

**函数原型:**

```
ipo_get_match_number(start_time, end_time, account_id='', df=False)
```

**参数：**

| 参数名     | 类型 | 说明                                |
| :--------- | :--- | :---------------------------------- |
| start_time | str  | 开始时间， (%Y-%m-%d %H:%M:%S 格式) |
| end_time   | str  | 结束时间， (%Y-%m-%d %H:%M:%S 格式) |
| account_id | str  | 账户 ID，不指定则使用默认账户       |
| df         | bool | 是否返回 DataFrame                  |

**返回值:**

`List[Dict]`

| key          | value 类型        | 说明     |
| :----------- | :---------------- | :------- |
| symbol       | str               | 标的代码 |
| order_id     | str               | 委托号   |
| volume       | int               | 成交数量 |
| match_number | str               | 申购配号 |
| order_at     | datetime.datetime | 委托日期 |
| match_at     | datetime.datetime | 配号日期 |

### ipo_get_lot_info - 中签查询

仅在**实盘**中可以使用

**函数原型:**

```
ipo_get_lot_info(account_id='', df=False)
```

**参数：**

| 参数名     | 类型 | 说明                          |
| :--------- | :--- | :---------------------------- |
| account_id | str  | 账户 ID，不指定则使用默认账户 |
| df         | bool | 是否返回 DataFrame            |

**返回值:**

`List[Dict]`

| key            | value 类型        | 说明       |
| :------------- | :---------------- | :--------- |
| symbol         | str               | 标的代码   |
| order_at       | datetime.datetime | 委托日期   |
| lot_at         | datetime.datetime | 中签日期   |
| lot_volume     | int               | 中签数量   |
| give_up_volume | int               | 放弃数量   |
| price          | float             | 中签价格   |
| amount         | float             | 中签金额   |
| pay_volume     | float             | 已缴款数量 |
| pay_amount     | float             | 已缴款金额 |

---

## 12. 基金交易函数

### 基金业务 SDK

### fund_etf_buy - ETF 申购

仅在**实盘**中可以使用

```
fund_etf_buy(symbol, volume, price, account_id='')
```

**参数：**

| 参数名     | 类型  | 说明                          |
| :--------- | :---- | :---------------------------- |
| symbol     | str   | 标的代码                      |
| volume     | int   | 申购数量                      |
| price      | float | 申购价格                      |
| account_id | str   | 账户 ID，不指定则使用默认账户 |

返回值 `List[Dict]`

### fund_etf_redemption - ETF 赎回

仅在**实盘**中可以使用

```
fund_etf_redemption(symbol, volume, price, account_id='')
```

**参数：**

| 参数名     | 类型  | 说明                          |
| :--------- | :---- | :---------------------------- |
| symbol     | str   | 标的代码                      |
| volume     | int   | 赎回数量                      |
| price      | float | 赎回价格                      |
| account_id | str   | 账户 ID，不指定则使用默认账户 |

返回值 `List[Dict]`

### fund_subscribing - 基金认购

仅在**实盘**中可以使用

```
fund_subscribing(symbol, volume, account_id='')
```

**参数：**

| 参数名     | 类型 | 说明                          |
| :--------- | :--- | :---------------------------- |
| symbol     | str  | 标的代码                      |
| volume     | int  | 认购数量                      |
| account_id | str  | 账户 ID，不指定则使用默认账户 |

返回值 `List[Dict]`

### fund_buy - 基金申购

仅在**实盘**中可以使用

```
fund_buy(symbol, volume, account_id='')
```

**参数：**

| 参数名     | 类型 | 说明                          |
| :--------- | :--- | :---------------------------- |
| symbol     | str  | 标的代码                      |
| volume     | int  | 申购数量                      |
| account_id | str  | 账户 ID，不指定则使用默认账户 |

返回值 `List[Dict]`

### fund_redemption - 基金赎回

仅在**实盘**中可以使用

```
fund_redemption(symbol, volume, account_id='')
```

**参数：**

| 参数名     | 类型 | 说明                          |
| :--------- | :--- | :---------------------------- |
| symbol     | str  | 标的代码                      |
| volume     | int  | 认购数量                      |
| account_id | str  | 账户 ID，不指定则使用默认账户 |

返回值 `List[Dict]`

---

## 13. 债券交易函数

### 债券业务 SDK

### bond_reverse_repurchase_agreement - 国债逆回购

仅在**实盘**中可以使用

```
bond_reverse_repurchase_agreement(symbol, volume, price, order_type=OrderType_Limit,
order_duration=OrderQualifier_Unknown, order_qualifier=OrderQualifier_Unknown, account_id='')
```

**参数：**

| 参数名          | 类型  | 说明                          |
| :-------------- | :---- | :---------------------------- |
| symbol          | str   | 标的代码                      |
| volume          | int   | 认购数量                      |
| price           | float | 价格                          |
| order_type      | int   | 委托类型                      |
| order_duration  | int   | 委托时间属性                  |
| order_qualifier | int   | 委托成交属性                  |
| account_id      | str   | 账户 ID，不指定则使用默认账户 |

返回值 `List[Dict]`

**注意：**逆回购 1 张为 100 元。上海市场最少交易 1000 张，深圳最少交易 10 张。且上海数量必须是 1000 张的整数倍，深圳数量必须是 10 张的整数倍，也即上海要 10 万元一个单位的买，深圳一千元一个单位的买。

### bond_convertible_call - 可转债转股

仅在**实盘**中可以使用

```
bond_convertible_call(symbol, volume, price=0.0, account_id='')
```

**参数：**

| 参数名     | 类型  | 说明                          |
| :--------- | :---- | :---------------------------- |
| symbol     | str   | 标的代码                      |
| volume     | int   | 认购数量                      |
| price      | float | 价格                          |
| account_id | str   | 账户 ID，不指定则使用默认账户 |

返回值 `List[Dict[Text, Any]]`

### bond_convertible_put - 可转债回售

仅在**实盘**中可以使用

```
bond_convertible_put(symbol, volume, price=0.0, account_id='')
```

**参数：**

| 参数名     | 类型  | 说明                          |
| :--------- | :---- | :---------------------------- |
| symbol     | str   | 标的代码                      |
| volume     | int   | 认购数量                      |
| price      | float | 价格                          |
| account_id | str   | 账户 ID，不指定则使用默认账户 |

返回值 `List[Dict[Text, Any]]`

### bond_convertible_put_cancel - 可转债回售撤销

仅在**实盘**中可以使用

```
bond_convertible_put_cancel(symbol, volume, account_id='')
```

**参数：**

| 参数名     | 类型 | 说明                          |
| :--------- | :--- | :---------------------------- |
| symbol     | str  | 标的代码                      |
| volume     | int  | 认购数量                      |
| account_id | str  | 账户 ID，不指定则使用默认账户 |

返回值 `List[Dict[Text, Any]]`

---

## 14. 交易事件

### on_order_status - 委托状态更新事件

响应委托状态更新事情，下单后及委托状态更新时被触发。
**注意：**
1、交易账户重连后，会重新推送一遍交易账户登录成功后查询回来的所有委托
2、撤单拒绝，会推送撤单委托的最终状态

**函数原型:**

```
on_order_status(context, order)
```

**参数：**

| 参数名  | 类型                                                                     | 说明   |
| :------ | :----------------------------------------------------------------------- | :----- |
| context | [context](python_concept.md#context - 上下文对象 "context---上下文对象") | 上下文 |
| order   | [order](python_object_trade.md#Order - 委托对象 "Order---委托对象")      | 委托   |

**示例：**

```python
def init(context):
	# 记录委托id
	context.cl_ord_id = {}
    order_list = get_orders()
    if order_list:
        context.cl_ord_id = {i['cl_ord_id']: {'status': i['status'], 'filled_volume': i['filled_volume']} for i in order_list}


def on_bar(context, bars):
	# 记录下单后对应的委托id，方便在on_order_status里追踪，实时模式下下单后会立刻返回10待报状态，其他状态需要通过on_order_status事件监控
	order = order_volume(symbol=symbol, volume=volume, side=OrderSide_Sell, order_type=OrderType_Limit,
                             position_effect=PositionEffect_CloseToday,
                             price=price_1)
	context.cl_ord_id[order[0]['cl_ord_id']] = {}
	context.cl_ord_id[order[0]['cl_ord_id']]['status'] = order[0]['status']
	context.cl_ord_id[order[0]['cl_ord_id']]['filled_volume'] = order[0]['filled_volume']


def on_order_status(context, order):
    # 过滤非此策略下单的委托和重复状态的委托
    if order.strategy_id == context.strategy_id and order.cl_ord_id in context.cl_ord_id.keys():
        if order.status != context.cl_ord_id[order.cl_ord_id]['status']:
            context.cl_ord_id[order.cl_ord_id]['status'] = order['status']
            context.cl_ord_id[order.cl_ord_id]['filled_volume'] = order['filled_volume']
        else:
			# 部分成交状态时，根据已成交量判断order是不是最新的
            if order.status == 2 and order.filled_volume != context.cl_ord_id[order.cl_ord_id]['filled_volume']:
                context.cl_ord_id[order.cl_ord_id]['filled_volume'] = order['filled_volume']
            else:
                return

	# 可在后面执行其他处理逻辑
	print(order)
```

**输出：**

```
{'strategy_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'account_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'cl_ord_id': '000000000', 'symbol': 'SHSE.600000', 'side': 1, 'position_effect': 1, 'position_side': 1, 'order_type': 1, 'status': 3, 'price': 11.0, 'order_style': 1, 'volume': 18181800, 'value': 200000000.0, 'percent': 0.1, 'target_volume': 18181800, 'target_value': 199999800.0, 'target_percent': 0.1, 'filled_volume': 18181800, 'filled_vwap': 11.0011, 'filled_amount': 200019799.98, 'created_at': datetime.datetime(2020, 9, 1, 9, 40, tzinfo=tzfile('PRC')), 'updated_at': datetime.datetime(2020, 9, 1, 9, 40, tzinfo=tzfile('PRC')), 'filled_commission': 20001.979998, 'account_name': '', 'order_id': '', 'ex_ord_id': '', 'algo_order_id': '', 'order_business': 0, 'order_duration': 0, 'order_qualifier': 0, 'order_src': 0, 'position_src': 0, 'ord_rej_reason': 0, 'ord_rej_reason_detail': '', 'stop_price': 0.0}

```

### on_execution_report - 委托执行回报事件

响应委托被执行事件，委托成交或者撤单拒绝后被触发。
**注意：**
1、交易账户重连后，会重新推送一遍交易账户登录成功后查询回来的所有执行回报
2、撤单拒绝后，会推送撤单拒绝执行回报，可以根据 exec_id 区分

**函数原型:**

```
on_execution_report(context, execrpt)
```

**参数：**

| 参数名  | 类型                                                                      | 说明   |
| :------ | :------------------------------------------------------------------------ | :----- |
| context | [context](python_concept.md#context - 上下文对象 "context---上下文对象")  | 上下文 |
| execrpt | [execrpt](python_object_trade.md#ExecRpt - 回报对象 "ExecRpt---回报对象") | 回报   |

**示例：**

```python
def init(context):
	# 记录成交id
    context.exec_id = []
    exec_rpt_list = get_execution_reports()

    if exec_rpt_list:
        context.exec_id = [i['exec_id'] for i in exec_rpt_list]


def on_execution_report(context, execrpt):
	# 过滤掉非此策略和成交类型不是15成交的回报
    if execrpt.exec_type == 15 and execrpt.exec_id not in context.exec_id and execrpt.strategy_id == context.strategy_id:
		context.exec_id.append(execrpt.exec_id)
		# 后面可以执行其他处理逻辑
		print(execrpt)

```

**输出：**

```
{'strategy_id': 'e41dec22-2d72-11eb-b043-00ff5a669ee2', 'cl_ord_id': '000000247', 'symbol': 'SHSE.600000', 'position_effect': 1, 'side': 1, 'exec_type': 15, 'price': 12.640000343322754, 'volume': 200, 'amount': 2528.000068664551, 'account_id': '', 'account_name': '', 'order_id': '', 'exec_id': '', 'order_business': 0, 'ord_rej_reason': 0, 'ord_rej_reason_detail': '', 'commission': 0.0, 'cost': 0.0, 'created_at': None}
```

### on_account_status - 交易账户状态更新事件

响应交易账户状态更新事件，交易账户状态变化时被触发。
**函数原型:**

```
def on_account_status(context, account):
    print(account)
```

**参数：**

| 参数名  | 类型                                                                                                                            | 说明                                                           |
| :------ | :------------------------------------------------------------------------------------------------------------------------------ | :------------------------------------------------------------- |
| context | [context](python_concept.md#context - 上下文对象 "context---上下文对象")                                                        | 上下文                                                         |
| account | object, 包含 account_id(账户 id), account_name(账户名),status([账户状态](python_enum_constant.md#AccountStatus - 交易账户状态)) | 交易账户状态对象，仅响应 已连接，已登录，已断开 和 错误 事件。 |

**示例：**

```python
def on_account_status(context, account):
    print(account)
```

**输出：**

```
{'account_id': '4946cc09-fefd-11ea-ac6a-52560acd7da0', 'account_name': '', 'status': {'state': 5, 'error': {'code': 0, 'type': '', 'info': ''}}}
```

---

## 15. 动态参数

动态参数仅在**仿真交易和实盘交易**下生效， 可在终端设置和修改。

动态参数通过策略调用接口实现策略和掘金界面参数交互， 在不停止策略运行的情况下，界面修改参数（移开光标，修改就会生效）会对策略里的指定变量做修改

![动态参数](http://www.myquant.cn/uploads/202010/attach_16408fc9e3c9fed6.png)

### add_parameter - 增加动态参数

**函数原型:**

```
add_parameter(key, value, min=0, max=0, name='', intro='', group='', readonly=False)
```

**参数：**

| 参数名   | 类型   | 说明           |
| :------- | :----- | :------------- |
| key      | str    | 参数的键       |
| value    | double | 参数的值       |
| min      | double | 最小值         |
| max      | double | 最大值         |
| name     | str    | 参数名称       |
| intro    | str    | 参数说明       |
| group    | str    | 参数的组       |
| readonly | bool   | 是否为只读参数 |

**返回值:**

`None`

**示例：**

```python
context.k_value = 80
add_parameter(key='k_value', value=context.k_value, min=0, max=100, name='k值阀值', intro='调整k值', group='1', readonly=False)
```

### set_parameter - 修改已经添加过的动态参数

**注意：**需要保持 key 键名和添加过的动态参数的 key 一致，否则不生效，无报错

**函数原型:**

```
set_parameter(key, value, min=0, max=0, name='', intro='', group='', readonly=False)
```

**参数：**

| 参数名   | 类型   | 说明           |
| :------- | :----- | :------------- |
| key      | str    | 参数的键       |
| value    | double | 参数的值       |
| min      | double | 最小值         |
| max      | double | 最大值         |
| name     | str    | 参数名称       |
| intro    | str    | 参数说明       |
| group    | str    | 参数的组       |
| readonly | bool   | 是否为只读参数 |

**返回值:**

`None`

**示例：**

```python
context.k_xl = 0.3
set_parameter(key='k_value', value=context.k_xl, min=0, max=1, name='k值斜率', intro='调整k值斜率', group='1', readonly=False)
```

### on_parameter - 动态参数修改事件推送

**函数原型:**

```
on_parameter(context, parameter)
```

**参数：**

| 参数名    | 类型                                                                     | 说明                     |
| :-------- | :----------------------------------------------------------------------- | :----------------------- |
| context   | [context](python_concept.md#context - 上下文对象 "context---上下文对象") | 上下文                   |
| parameter | dict                                                                     | 当前被推送的动态参数对象 |

**示例：**

```python
def on_parameter(context, parameter):
    print(parameter)
```

**输出：**

```
{'key': 'k_value', 'value': 80.0, 'max': 100.0, 'name': 'k值阀值', 'intro': '调整k值', 'group': '1', 'min': 0.0, 'readonly': False}

```

### context.parameters - 获取所有动态参数

返回数据类型为字典, key 为动态参数的 key, 值为动态参数对象

**示例：**

```python
print(context.parameters)
```

**输出：**

```
{'k_value': {'key': 'k_value', 'value': 80.0, 'max': 100.0, 'name': 'k值阀值', 'intro': 'k值阀值', 'group': '1', 'min': 0.0, 'readonly': False}, 'd_value': {'key': 'd_value', 'value': 20.0, 'max': 100.0, 'name': 'd值阀值', 'intro': 'd值阀值', 'group': '1', 'min': 0.0, 'readonly': False}}

```

---

## 16. 其他函数

### set_token - 设置 token

用户有时只需要提取数据, set_token 后就可以直接调用数据函数, 无需编写策略结构。如果 token 不合法, 访问需要身份验证的函数会抛出异常。

**token 位置参见终端-系统设置界面-密钥管理（token）**

**函数原型:**

```
set_token(token)
```

**参数：**

| 参数名 | 类型 | 说明     |
| :----- | :--- | :------- |
| token  | str  | 身份标识 |

**返回值:**

`None`

**示例：**

```python
set_token('your token')
history_data = history(symbol='SHSE.000300', frequency='1d', start_time='2010-07-28',  end_time='2017-07-30', df=True)
```

**注意：**
token 输入错误会报错“错误或无效的 token”。

### log - 日志函数

**函数原型:**

```
log(level, msg, source)
```

**参数：**

| 参数名 | 类型 | 说明                                         |
| :----- | :--- | :------------------------------------------- |
| level  | str  | 日志级别 `debug`, `info`, `warning`, `error` |
| msg    | str  | 信息                                         |
| source | str  | 来源                                         |

**返回值:**

`None`

**示例：**

```python
log(level='info', msg='平安银行信号触发', source='strategy')
```

**注意：**

**1.**log 函数仅支持**实时模式**，输出到终端策略日志处。

**2.**level 输入无效参数不会报错，终端日志无显示。

**3.**参数类型报 NameError 错误,缺少参数报 TypeError 错误。

**4.**重启终端日志记录会自动清除，需要记录日志到本地的，可以使用 Python 的 logging 库

### get_strerror - 查询错误码的错误描述信息

**函数原型:**

```
get_strerror(error_code)
```

**参数：**

| 参数名     | 类型 | 说明   |
| :--------- | :--- | :----- |
| error_code | int  | 错误码 |

全部 [错误码详细信息](python_err_code.md '错误码详细信息')

**返回值:**

错误原因描述信息字符串

**示例：**

```python
err = get_strerror(error_code=1010)
print(err)
```

**输出:**

```
b'\xe6\x97\xa0\xe6\xb3\x95\xe8\x8e\xb7\xe5\x8f\x96\xe6\x8e\x98\xe9\x87\x91\xe6\x9c\x8d\xe5\x8a\xa1\xe5\x99\xa8\xe5\x9c\xb0\xe5\x9d\x80\xe5\x88\x97\xe8\xa1\xa8'
```

**注意:**

error_code 值输入错误无报错，返回值为空。

### get_version - 查询 api 版本

**函数原型:**

```
get_version()
```

**返回值:**

字符串 当前 API 版本号

**示例：**

```python
version = get_version()
print(version)
```

**输出:**

```
3.0.127
```

---

## 17. 其他事件

### on_backtest_finished - 回测结束事件

描述：
在回测模式下，回测结束后会触发该事件，并返回回测得到的绩效指标对象

**函数原型:**

```
on_backtest_finished(context, indicator)
```

**参数：**

| 参数名    | 类型                                                                                    | 说明     |
| :-------- | :-------------------------------------------------------------------------------------- | :------- |
| context   | [context](python_concept.md#context - 上下文对象 "context---上下文对象")                | 上下文   |
| indicator | [indicator](python_object_trade.md#Indicator - 绩效指标对象 "Indicator---绩效指标对象") | 绩效指标 |

**示例：**

```python
def on_backtest_finished(context, indicator):
    print(indicator)
```

**返回：**

```
{'account_id': 'd7443a53-f65b-11ea-bb9d-484d7eaefe55', 'pnl_ratio': -0.007426408687162637, 'pnl_ratio_annual': -1.3553195854071813, 'sharp_ratio': -15.034348187048744, 'max_drawdown': 0.0009580714324989177, 'risk_ratio': 0.10010591267452242, 'open_count': 1, 'close_count': 1, 'lose_count': 1, 'calmar_ratio': -1414.6331259164358, 'win_count': 0, 'win_ratio': 0.0, 'created_at': None, 'updated_at': None}
```

### on_error - 错误事件

描述：
当发生异常情况，比如断网时、终端服务崩溃是会触发

**函数原型:**

```
on_error(context, code, info)
```

**参数：**

| 参数名  | 类型                                                                     | 说明                         |
| :------ | :----------------------------------------------------------------------- | :--------------------------- |
| context | [context](python_concept.md#context---上下文对象 'context---上下文对象') | 上下文                       |
| code    | int                                                                      | [错误码](python_err_code.md) |
| info    | str                                                                      | 错误信息                     |

**示例：**

```python
def on_error(context, code, info):
    print('code:{}, info:{}'.format(code, info))
    stop()
```

**返回：**

```
code:1201, info:实时行情服务连接断开
```

### on_market_data_connected - 实时行情网络连接成功事件

描述：
实时行情网络连接时触发，比如策略实时运行启动后会触发、行情断连又重连后会触发

**函数原型:**

```
on_market_data_connected(context)
```

**参数：**

| 参数名  | 类型                                                                     | 说明   |
| :------ | :----------------------------------------------------------------------- | :----- |
| context | [context](python_concept.md#context---上下文对象 'context---上下文对象') | 上下文 |

**示例：**

```python
def on_market_data_connected(context):
    print ('实时行情网络连接成功')
```

### on_trade_data_connected - 交易通道网络连接成功事件

描述：
目前监控 SDK 的交易和终端的链接情况，终端之后部分暂未做在内。账号连接情况可通过终端内账户连接指示灯查看

**函数原型:**

```
on_trade_data_connected(context)
```

**参数：**

| 参数名  | 类型                                                                     | 说明   |
| :------ | :----------------------------------------------------------------------- | :----- |
| context | [context](python_concept.md#context---上下文对象 'context---上下文对象') | 上下文 |

**示例：**

```python
def on_trade_data_connected(context):
    print ('交易通道网络连接')
```

### on_market_data_disconnected - 实时行情网络连接断开事件

**函数原型:**

描述：
实时行情网络断开时触发，比如策略实时运行行情断连会触发

```
on_market_data_disconnected(context)
```

**参数：**

| 参数名  | 类型                                                                     | 说明   |
| :------ | :----------------------------------------------------------------------- | :----- |
| context | [context](python_concept.md#context---上下文对象 'context---上下文对象') | 上下文 |

**示例：**

```python
def on_market_data_disconnected(context):
    print ('实时行情网络连接')
```

### on_trade_data_disconnected - 交易通道网络连接断开事件

描述：
目前监控 SDK 的交易和终端的链接情况，终端交易服务崩溃后会触发，终端之后部分暂未做在内。账号连接情况可通过终端内账户连接指示灯查看

**函数原型:**

```
on_trade_data_disconnected(context)
```

**参数：**

| 参数名  | 类型                                                                     | 说明   |
| :------ | :----------------------------------------------------------------------- | :----- |
| context | [context](python_concept.md#context---上下文对象 'context---上下文对象') | 上下文 |

**示例：**

```python
def on_trade_data_disconnected(context):
    print ('交易通道网络连接失败')
```
